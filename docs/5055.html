<html>
<head>
<title>Angular Video Conferencing with Agora.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Agora.io进行角度视频会议</h1>
<blockquote>原文：<a href="https://medium.com/swlh/angular-video-conferencing-with-agora-io-45905235eebb#2019-06-07">https://medium.com/swlh/angular-video-conferencing-with-agora-io-45905235eebb#2019-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="98e8" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用ngx-agora图书馆，不到10分钟就可以启动并运行。</h2></div><p id="9e1a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://github.com/drew-thompson/ngx-agora" rel="noopener ugc nofollow" target="_blank"><em class="ju">ngx-agora</em></a><em class="ju">——</em>agora . io的开源Angular库。</p><p id="d59f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://docs.agora.io/en/Video/API%20Reference/web/index.html" rel="noopener ugc nofollow" target="_blank"><em class="ju">agora . io docs</em></a><em class="ju">—</em>具有易用API的跨平台WebRTC</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es jv"><img src="../Images/cfe4ce86463d1f684c569cc0abff9035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9Iqrx7T8a0R1uisVWrduw.jpeg"/></div></div></figure><h2 id="fbb8" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">创建一个角度应用程序</h2><p id="bd83" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">让我们首先使用Angular CLI创建一个新的Angular应用程序，然后将Agora SDK集成到其中。</p><blockquote class="lh li lj"><p id="88f0" class="ix iy ju iz b ja jb ij jc jd je im jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">如果你没有使用过Angular CLI，它是一个强大的工具，可以生成任何有角度的东西。您可以使用命令<code class="du ln lo lp lq b">npm i -g @angular/cli</code>使用<a class="ae jt" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>进行全局安装。</p></blockquote><p id="ffd2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将通过运行命令<code class="du ln lo lp lq b">ng new angular-video</code>来调用我们的新应用<em class="ju"> angular-video </em>。运行令人惊叹的终端提示，以您喜欢的方式设置项目——在这个例子中，我将对routing说<em class="ju">不</em>,并将默认的项目样式表格式设置为<em class="ju"> scss </em>(因为谁还想要普通的css呢，对吗？).</p><p id="c284" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这应该会生成运行典型Angular演示所需的所有文件，在新项目文件夹中运行<code class="du ln lo lp lq b">ng serve -o</code>应该会打开每个人最喜欢的应用程序。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es lr"><img src="../Images/ea03da8ecff7f4af116206ab7eec8e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*zSadYT4_Qtqpaw1ZBrCw8w.png"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">Default Angular App</figcaption></figure><p id="93a8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们有了一个空白项目，让我们后退一步，准备好我们的Agora.io帐户进行测试！我们当前的目标是创建一个项目，并复制其唯一的<strong class="iz lw">应用程序ID </strong>，用于我们的应用程序。</p><h2 id="8150" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">创建Agora.io项目</h2><p id="ba3e" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">前往<a class="ae jt" href="https://sso.agora.io/en/signup" rel="noopener ugc nofollow" target="_blank">他们的注册页面</a>并创建一个免费账户——注意，他们目前需要通过短信进行账户验证，所以拿出你的手机。一旦您完成这一步并进入他们的控制面板用户界面，下面是您需要完成的步骤:</p><ol class=""><li id="7636" class="lx ly hi iz b ja jb jd je jg lz jk ma jo mb js mc md me mf bi translated">创建一个新项目(我称我的项目为<code class="du ln lo lp lq b">angular-video</code>)</li><li id="e933" class="lx ly hi iz b ja mg jd mh jg mi jk mj jo mk js mc md me mf bi translated">导航到<em class="ju">项目管理</em>选项卡，找到您的新项目</li></ol><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es ml"><img src="../Images/b9f47baf8dc067ecc111445e8eb6cc1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*B86J1KOTXZBu4hc71fcRtg.png"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">UI is subject to change</figcaption></figure><p id="c652" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.将项目的<strong class="iz lw">应用ID </strong>(未显示)复制到你的剪贴板，你很快就会需要它。好了，现在你有了一个独特的项目ID，让我们回到我们的角度项目和终端。</p><h2 id="c54b" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">整合ngx-agora图书馆</h2><p id="996c" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">让我们输入命令<code class="du ln lo lp lq b">ng add ngx-agora</code>，它将运行库的角度示意图，并帮助将其集成到您的项目中。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mm"><img src="../Images/10c7a89f366c03ecb5475fe79ad9fe72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*parzg-SniduqpWA80XrjzA.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Let’s make this easy</figcaption></figure><p id="ccd0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出现提示时，粘贴并提交上一步中的<strong class="iz lw">应用ID</strong>——这将在自动集成过程中使用。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mn"><img src="../Images/0dccc3883164b296f69228a5a200ad25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LjVuHsYqtYV8LY0L7junxA.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Let’s go with the latest version!</figcaption></figure><p id="6c56" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在发布时，版本<code class="du ln lo lp lq b">3.0.2</code>是最新的Agora SDK版本，但是如果它适合您的使用情况，您可以随意选择不同的版本。我将在这里选择<em class="ju">最新发布的</em>。</p><p id="e1c4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此时，schematics应该已经更新了您的项目，使用您提供的<strong class="iz lw"> APP ID </strong>来设置一个环境变量，并将<code class="du ln lo lp lq b">NgxAgoraModule</code>的导入添加到您的<code class="du ln lo lp lq b">app.module</code>中。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mo"><img src="../Images/d2fe933508c9aa2618d172868cc7c613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pk1vhxGGK9XdLcqTTn-RtQ.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Now we’re ready for development!</figcaption></figure><h2 id="0d2e" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">开始使用Agora.io的API</h2><p id="55e8" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">现在我们已经准备好开始使用Agora.io的SDK并开始视频聊天了！转到您的<code class="du ln lo lp lq b">app.component.ts</code>，将<code class="du ln lo lp lq b">NgxAgoraService</code>注入到您的组件构造函数中。让我们也实现<code class="du ln lo lp lq b">OnInit</code>并创建一个公共列表来跟踪远程用户id。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mp"><img src="../Images/21992af69145018e1c78e620c7334306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itvkLNlrRPf4-XJL1mwYEg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">DIY DI — now we can use the Agora API</figcaption></figure><p id="a616" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步是创建<code class="du ln lo lp lq b">client</code>对象，该对象提供将您的计算机连接到Agora服务器并最终连接到其他人的计算机的功能。</p><p id="62a5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在此阶段，您可以提供将要连接的电话会议的类型。Agora目前支持两种类型:</p><ol class=""><li id="821d" class="lx ly hi iz b ja jb jd je jg lz jk ma jo mb js mc md me mf bi translated"><code class="du ln lo lp lq b">rtc</code> —免费视频通话，每个参与者都可以自由交谈</li><li id="ad29" class="lx ly hi iz b ja mg jd mh jg mi jk mj jo mk js mc md me mf bi translated"><code class="du ln lo lp lq b">live</code> —广播格式，参与者各有一套<code class="du ln lo lp lq b">host</code>或<code class="du ln lo lp lq b">audience</code>角色</li></ol><p id="4fe4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，我们将关注于<code class="du ln lo lp lq b">rtc</code>，因此使用<code class="du ln lo lp lq b">NgxAgoraService</code>提供的<code class="du ln lo lp lq b">createClient</code>方法来设置一个本地<code class="du ln lo lp lq b">AgoraClient</code>对象，我们将使用该对象与Agora.io SDK进行交互。接下来，为客户机分配必要的事件处理程序，以响应WebRTC生命周期中的重要事件。</p><blockquote class="lh li lj"><p id="b1ce" class="ix iy ju iz b ja jb ij jc jd je im jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">在<code class="du ln lo lp lq b">client</code>创建后立即分配这些处理程序是很重要的，否则事件可能会在您监听它们之前就被触发<em class="hi">。</em></p></blockquote><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">Initialized the client and its event handlers</figcaption></figure><blockquote class="lh li lj"><p id="7fed" class="ix iy ju iz b ja jb ij jc jd je im jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">创建后，<code class="du ln lo lp lq b">NgxAgoraService</code>自动初始化<code class="du ln lo lp lq b">client</code>，使用库的<code class="du ln lo lp lq b">app.module.ts</code>导入中提供的<code class="du ln lo lp lq b">AppId</code>，客户端，但是<code class="du ln lo lp lq b">createClient</code>方法提供了用你自己的方法覆盖这个<code class="du ln lo lp lq b">init</code>调用的能力。</p></blockquote><h2 id="75b7" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">设置模板</h2><p id="5573" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">我们需要创建一个本地A/V流发送给远程用户，如果我们想在屏幕上显示该流，我们需要将其连接到我们的HTML模板。</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">We’ll add some light styling just to be fancy 💖</figcaption></figure><p id="5041" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Agora.io的SDK寻找一个带有指定<code class="du ln lo lp lq b">id</code>的<code class="du ln lo lp lq b">HTMLElement</code>来播放流，所以让我们在模板中放置一个<code class="du ln lo lp lq b">&lt;div&gt;</code>，将它的<code class="du ln lo lp lq b">id</code>绑定到组件中的一个变量<code class="du ln lo lp lq b">localCallId</code>。</p><p id="14b9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然您通常只有一个本地A/V流，但您可以与多个远程流进行交互，您可以对每个流执行相同的过程，以在客户端显示它。</p><p id="28b3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经准备好了模板，让我们开始创建我们的本地流并将其发布到服务器通道。</p><h2 id="81b2" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">创建并连接您的本地流</h2><p id="cbfa" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">回到<code class="du ln lo lp lq b">app.component.ts</code>，通过调用<code class="du ln lo lp lq b">NgxAgoraService</code>的<code class="du ln lo lp lq b">createStream</code>函数创建一个A/V流。这是你告诉Agora.io的SDK你想创建什么样的流，它是否有<code class="du ln lo lp lq b">audio</code>、<code class="du ln lo lp lq b">video</code>、<code class="du ln lo lp lq b">screen</code>，你想给它取什么名字。如<a class="ae jt" href="https://docs.agora.io/en/Video/API%20Reference/web/interfaces/agorartc.streamspec.html" rel="noopener ugc nofollow" target="_blank">文档</a>中所述，确保不要将<code class="du ln lo lp lq b">video</code>和<code class="du ln lo lp lq b">screen</code>同时包含为<code class="du ln lo lp lq b">true</code>。</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">Create a local stream and play it in the browser.</figcaption></figure><p id="d687" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建流后，将其分配给私有的<code class="du ln lo lp lq b">localStream</code>变量，您将需要分配事件处理程序(就像我们对<code class="du ln lo lp lq b">client</code>所做的那样)并初始化它——这是Agora.io SDK要求设备访问权限的地方。</p><p id="394f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">SDK在流的<code class="du ln lo lp lq b">init</code>函数中提供了回调，以及可以被监听的独立事件，您可以在这些事件中对拒绝媒体访问的用户做出响应。一旦本地流成功初始化，我们通过<a class="ae jt" href="https://docs.agora.io/en/Video/API%20Reference/web/interfaces/agorartc.stream.html#play" rel="noopener ugc nofollow" target="_blank"> play函数</a>指示SDK将我们流的输出连接到我们绑定到<code class="du ln lo lp lq b">localCallId</code>的<code class="du ln lo lp lq b">div</code>。此时，您应该能够在运行的应用程序中看到相机的输出。</p><h2 id="1027" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">加入通话并发布您的流</h2><p id="861a" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">此时，我们有:</p><ol class=""><li id="478a" class="lx ly hi iz b ja jb jd je jg lz jk ma jo mb js mc md me mf bi translated">本地A/V流，连接到我们的本地视频<code class="du ln lo lp lq b">&lt;div&gt;</code></li><li id="5de6" class="lx ly hi iz b ja mg jd mh jg mi jk mj jo mk js mc md me mf bi translated">一个带有事件监听器的<code class="du ln lo lp lq b">client</code>对象，准备对核心事件做出反应</li></ol><p id="13eb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是时候<em class="ju">加入</em>聊天室<em class="ju">发布</em>我们的信息流了。在我们将本地A/V流发布给一个调用之前，我们需要等待它初始化。保证我们准备好发布的最简单的方法是在对<code class="du ln lo lp lq b">localStream.init</code>的成功回调中调用我们对<code class="du ln lo lp lq b">join</code>和<code class="du ln lo lp lq b">publish</code>方法的调用。</p><p id="e404" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们<code class="du ln lo lp lq b">join</code>一个任意的聊天室，<code class="du ln lo lp lq b">foo-bar</code>，当第一个用户加入时，它会在我们的Agora.io项目下自动初始化。</p><blockquote class="lh li lj"><p id="0d97" class="ix iy ju iz b ja jb ij jc jd je im jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">Agora.io对<code class="du ln lo lp lq b"><em class="hi">join</em></code>方法有一些指导方针<a class="ae jt" href="https://docs.agora.io/en/Video/API%20Reference/web/interfaces/agorartc.streamspec.html" rel="noopener ugc nofollow" target="_blank">,所以请注意，每个<code class="du ln lo lp lq b"><em class="hi">streamID</em></code>都是一致的<code class="du ln lo lp lq b"><em class="hi">string</em></code>或<code class="du ln lo lp lq b"><em class="hi">number</em></code>,适用于您通话中的所有成员。</a></p></blockquote><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">Initialize your local stream, join a call, then publish to it.</figcaption></figure><h2 id="cbc1" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">与自己开始通话</h2><p id="78b6" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">此时，我们准备在两个标签页中打开<code class="du ln lo lp lq b">localhost:4200</code>，一个在匿名模式下，并查看结果。我们应该期待本地视频出现在右下角，更小，而远程视频在它后面是一整页的背景。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es ms"><img src="../Images/57010887a4617800fe5c30b223b0b61b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTpw2Yh9ufnml79Psg-9qA.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">It’s you! Looking healthy! 😄</figcaption></figure><p id="f44a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以看到本地和远程映像是如何相互镜像的，这在您与自己的通话中是意料之中的。</p><blockquote class="lh li lj"><p id="68ea" class="ix iy ju iz b ja jb ij jc jd je im jf lk jh ji jj ll jl jm jn lm jp jq jr js hb bi translated">在这样的测试中(有两个本地标签)，有时Agora.io SDK不会镜像视频流。如果发生这种情况，刷新页面，事情应该正常工作。</p></blockquote></div><div class="ab cl mt mu gp mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hb hc hd he hf"><p id="8d30" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以在Github 上的<a class="ae jt" href="https://github.com/drew-thompson/angular-video" rel="noopener ugc nofollow" target="_blank">资源库中查看该演示的完整源代码。</a></p></div></div>    
</body>
</html>