<html>
<head>
<title>How to add Search functionality to a Django REST Framework powered app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何向Django REST框架支持的应用程序添加搜索功能</h1>
<blockquote>原文：<a href="https://medium.com/swlh/searching-in-django-rest-framework-45aad62e7782?source=collection_archive---------1-----------------------#2019-07-07">https://medium.com/swlh/searching-in-django-rest-framework-45aad62e7782?source=collection_archive---------1-----------------------#2019-07-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="482e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">议程</h1><p id="f701" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将讨论如何使用查询参数在Django REST框架中完成搜索。</p><h1 id="295d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">设置</h1><p id="2dee" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们用Django民调模型作为参考。</p><figure class="kb kc kd ke fd kf"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="bb20" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">让我们添加以下序列化程序:</p><figure class="kb kc kd ke fd kf"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="4384" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">让我们添加以下视图:</p><figure class="kb kc kd ke fd kf"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="3068" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">让我们添加以下urlpattern:</p><figure class="kb kc kd ke fd kf"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="520c" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">对<code class="du kn ko kp kq b">/api/polls/questions/</code>的GET请求返回一个包含所有问题的列表。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kr"><img src="../Images/18c757c824ce8061e22d053e1ed5d758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvEaatJU25xc-Dd2FKiewA.png"/></div></div></figure><h1 id="5a67" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">搜索</h1><p id="4666" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">DRF提供了一个名为<code class="du kn ko kp kq b">SearchFilter</code>的过滤器，它可以根据名为<code class="du kn ko kp kq b">search</code>的查询参数过滤查询集。</p><p id="ead4" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">我们希望搜索在question_text中包含<code class="du kn ko kp kq b">Samsung</code>的问题。</p><p id="55d6" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">这需要在QuestionsAPIView上添加两个属性。他们是<code class="du kn ko kp kq b">search_fields</code>和<code class="du kn ko kp kq b">filter_backends</code>。让我们添加这些属性。</p><figure class="kb kc kd ke fd kf"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="ed91" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">用<code class="du kn ko kp kq b">search</code>查询参数<code class="du kn ko kp kq b">Samsung</code>发出GET请求。获取<code class="du kn ko kp kq b">/api/polls/questions/?search=Samsung</code>。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es ky"><img src="../Images/166093b73e5f1c5717c7b30a1a7bb447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbiiPZCH0m39WCekUD0Wpw.png"/></div></div></figure><p id="4428" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">响应中会返回其question_text中包含术语<code class="du kn ko kp kq b">Samsung</code>的问题。</p><p id="4c32" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">现在我们想找到由查尔斯撰写的问题。让我们用查询参数<em class="kz"> charles </em>发出另一个请求。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es la"><img src="../Images/6dda1e81fb73bdaf2031eadd6d5ddc1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkNhifZ16-gEB7tAvlMXyA.png"/></div></div></figure><p id="2a05" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">我们没有得到由<em class="kz"> charles </em>提出的问题，因为我们在<code class="du kn ko kp kq b">search_fields</code>中只有<code class="du kn ko kp kq b">question_text</code>。DRF只是在寻找<code class="du kn ko kp kq b">question_text</code>中的搜索查询参数。</p><p id="2950" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">如果我们想将搜索查询参数添加到<code class="du kn ko kp kq b">author</code>中，我们也需要将<code class="du kn ko kp kq b">author</code>添加到<code class="du kn ko kp kq b">search_fields</code>中。修改<code class="du kn ko kp kq b">search_fields</code>。</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="ab2a" class="lf ig hi kq b fi lg lh l li lj">search_fields = ['question_text', 'author']</span></pre><p id="87d6" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">再次发出api请求，您应该会看到<code class="du kn ko kp kq b">charles</code>编写的问题作为响应。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lk"><img src="../Images/1c005979f09fc18b3642b363220b385d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*psKEXnpVtIZ6qVsINn6kLA.png"/></div></div></figure><h1 id="617a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">关系搜索</h1><p id="7b0d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">问题和选择有很大关系。让我们创建一个带有相关选项的问题。</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="e078" class="lf ig hi kq b fi lg lh l li lj">In [1]: from polls.models import Question, Choice</span><span id="fcfb" class="lf ig hi kq b fi ll lh l li lj">In [2]: q = Question.objects.create(question_text='Who is your favorite GoT character?')</span><span id="0d8f" class="lf ig hi kq b fi ll lh l li lj">In [3]: Choice.objects.create(question=q, choice_text='Ned')<br/>Out[3]: &lt;Choice: Ned&gt;</span></pre><p id="2b25" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">当我们搜索一个特定的术语时，我们希望相关选项的choice_text也被考虑在内。在问题端点中搜索<code class="du kn ko kp kq b">Ned</code>。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lm"><img src="../Images/136ad0e48ee09f16493fe1893bba865c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyZdBPwmkwyjCVMoR_nvfg.png"/></div></div></figure><p id="9dff" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">我们没有得到任何结果。</p><p id="e3b9" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">因为我们希望考虑相关选项的choice_text，所以我们需要将<code class="du kn ko kp kq b">choice__choice_text</code>添加到<code class="du kn ko kp kq b">search_fields</code>。</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="853d" class="lf ig hi kq b fi lg lh l li lj">search_fields = ['question_text', 'author', 'choice__choice_text']</span></pre><p id="cece" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">再次搜索<code class="du kn ko kp kq b">Ned</code>，你应该会在返回的回复中看到相关的问题。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es ln"><img src="../Images/6bacf7a52be7042a2b7299b2d5041721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMUV8s4Gb3zBAePn_2Aj-w.png"/></div></div></figure><h1 id="6212" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">更严格的搜索</h1><p id="2499" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们把<code class="du kn ko kp kq b">search_fields</code>还原回<code class="du kn ko kp kq b">[‘question_text', ‘author’]</code>。</p><p id="48f6" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">在幕后，DRF默认使用<code class="du kn ko kp kq b">icontains</code>。搜索<code class="du kn ko kp kq b">GoT</code>。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lo"><img src="../Images/4d41c0ec70864c94bf9e266add9b8cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwwfZCAkLhtp_gUcxOhxaQ.png"/></div></div></figure><p id="c364" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">DRF基本上应用了以下过滤器:</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="f4a1" class="lf ig hi kq b fi lg lh l li lj">Q(question_text__icontains='GoT') | Q(author__icontains='GoT')</span></pre><p id="563a" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">您可能希望强制一个对象只在它以搜索的文本开始时才返回。在这种情况下，所需的滤波将是<code class="du kn ko kp kq b">istartswith</code>而不是<code class="du kn ko kp kq b">icontains</code>。</p><p id="f1eb" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">DRF <code class="du kn ko kp kq b">SearchFilter</code>也支持<code class="du kn ko kp kq b">istartswith</code>。我们需要将<code class="du kn ko kp kq b">^</code>添加到<code class="du kn ko kp kq b">istartswith</code>的字段中。将<code class="du kn ko kp kq b">search_fields</code>改为:</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="3b82" class="lf ig hi kq b fi lg lh l li lj">search_fields = ['^question_text', 'author']</span></pre><p id="0c3a" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">现在，搜索不会在响应中返回任何问题。</p><p id="53e7" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">搜索<code class="du kn ko kp kq b">Who</code>，你会看到这个问题的回复。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lk"><img src="../Images/620ddca6745e4bf297504050149c87e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qnV2fkkBBrnQeenAR6PU5A.png"/></div></div></figure><p id="a67d" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">引擎盖下的DRF在这种情况下执行以下过滤</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="46e7" class="lf ig hi kq b fi lg lh l li lj">Q(question_text__istartswith='Who') | Q(author__icontains='Who')</span></pre><p id="873a" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">可以通过在属性名称中添加<code class="du kn ko kp kq b">@ </code>来执行精确搜索。例:<code class="du kn ko kp kq b">search_fields=['@question_text', ‘@author']</code>。</p><h1 id="e8a6" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">搜索多个术语</h1><p id="a095" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们把<code class="du kn ko kp kq b">search_fields</code>还原回<code class="du kn ko kp kq b">[‘question_text', ‘author']</code>。</p><p id="74c4" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">DRF在搜索查询参数中支持多个术语。正如DRF文件所述:</p><pre class="kb kc kd ke fd lb kq lc ld aw le bi"><span id="a5a3" class="lf ig hi kq b fi lg lh l li lj">The search parameter may contain multiple search terms, which should be whitespace and/or comma separated. If multiple search terms are used then objects will be returned in the list only if all the provided terms are matched.</span></pre><p id="d80a" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">让我们在搜索参数中发送两个术语<code class="du kn ko kp kq b">Who</code>和<code class="du kn ko kp kq b">GoT</code>。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lm"><img src="../Images/658bd56ccae3b40b089637d1497593f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIYZjwkIAT4TDxrRXA4tjw.png"/></div></div></figure><p id="e8d4" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">因为这两个词都在问题<em class="kz">中你最喜欢的GoT角色是谁？</em>，所以列表中返回这个对象。</p><p id="508e" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">搜索术语<code class="du kn ko kp kq b">Who</code>和<code class="du kn ko kp kq b">Samsung</code>。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lp"><img src="../Images/925f576cc67b05f824b6e9a3fb783f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ed6oO5NKwQasfVcOx5I4yA.png"/></div></div></figure><p id="f53c" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">因为这两个术语没有出现在任何问题中，所以我们在响应中得到一个空列表。</p><h1 id="bb4e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我的其他帖子</h1><p id="ff91" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">以下是一些你可能会发现非常有用的帖子:</p><p id="74ac" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">DRF</p><ul class=""><li id="fb2d" class="lq lr hi jf b jg ki jk kj jo ls js lt jw lu ka lv lw lx ly bi translated">在DRF如何让搜索字段动态:<a class="ae lz" href="https://betterprogramming.pub/how-to-make-search-fields-dynamic-in-django-rest-framework-72922bfa1543" rel="noopener ugc nofollow" target="_blank">https://better programming . pub/how-to-make-search-fields-dynamic-in-django-rest-framework-72922 BFA 1543</a></li><li id="1cc1" class="lq lr hi jf b jg ma jk mb jo mc js md jw me ka lv lw lx ly bi translated">从DRF序列化程序中获得更多:<a class="ae lz" href="https://betterprogramming.pub/how-to-use-drf-serializers-effectively-dc58edc73998" rel="noopener ugc nofollow" target="_blank">https://better programming . pub/how-to-use-drf-serializer-effectively-DC 58 EDC 73998</a></li><li id="1c9b" class="lq lr hi jf b jg ma jk mb jo mc js md jw me ka lv lw lx ly bi translated">在写操作期间有效地使用DRF序列化器:<a class="ae lz" rel="noopener" href="/@raaj.akshar/how-to-effectively-use-django-rest-framework-serializers-during-write-operations-dd73b62c26b5">https://medium . com/@ raaj . AK shar/how-to-effectively-use-django-rest-framework-serializer-during-write-operations-DD 73 b 62 c 26 b 5</a></li></ul><p id="b4cc" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">姜戈</p><ul class=""><li id="39d0" class="lq lr hi jf b jg ki jk kj jo ls js lt jw lu ka lv lw lx ly bi translated">django annotations and aggregations cookbook:<a class="ae lz" href="https://betterprogramming.pub/django-annotations-and-aggregations-48685994d149" rel="noopener ugc nofollow" target="_blank">https://better programming . pub/django-annotations-and-aggregations-48685994 d149</a></li><li id="d7f9" class="lq lr hi jf b jg ma jk mb jo mc js md jw me ka lv lw lx ly bi translated">在Django应用程序中引入Pytest:<a class="ae lz" href="https://betterprogramming.pub/testing-a-django-application-with-pytest-3615df7e81f8" rel="noopener ugc nofollow" target="_blank">https://better programming . pub/testing-a-Django-application-with-Pytest-3615 df 7 e 81 f 8</a></li></ul><p id="edc2" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">熊猫</p><ul class=""><li id="fa9b" class="lq lr hi jf b jg ki jk kj jo ls js lt jw lu ka lv lw lx ly bi translated">建立对熊猫系列的坚实了解:<a class="ae lz" href="https://towardsdatascience.com/gaining-a-solid-understanding-of-pandas-series-893fb8f785aa" rel="noopener" target="_blank">https://towards data science . com/gaing-a-solid-understand-of-Pandas-series-893 fb8f 785 aa</a></li></ul><p id="2451" class="pw-post-body-paragraph jd je hi jf b jg ki ji jj jk kj jm jn jo kk jq jr js kl ju jv jw km jy jz ka hb bi translated">数据库</p><ul class=""><li id="bc88" class="lq lr hi jf b jg ki jk kj jo ls js lt jw lu ka lv lw lx ly bi translated">关于数据库死锁的推理:<a class="ae lz" href="https://levelup.gitconnected.com/understanding-why-a-database-deadlock-occurs-8bbd32be8026" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/understanding-why-a-database-deadlock-occurs-8 bbd 32 be 8026</a></li><li id="a8e3" class="lq lr hi jf b jg ma jk mb jo mc js md jw me ka lv lw lx ly bi translated">关系数据库的ACID保证通过实际例子:<a class="ae lz" href="https://levelup.gitconnected.com/understanding-acid-guarantees-through-practical-example-3fe806628580" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/understanding-ACID-guarantees-through-practical-example-3fe 806628580</a></li><li id="c177" class="lq lr hi jf b jg ma jk mb jo mc js md jw me ka lv lw lx ly bi translated">MySQL数据库的存储容量规划:<a class="ae lz" rel="noopener" href="/@raaj.akshar/mysql-disk-usage-analysis-cbf7597b2836">https://medium . com/@ raaj . AK shar/MySQL-disk-usage-analysis-CBF 7597 b283</a>6</li></ul></div></div>    
</body>
</html>