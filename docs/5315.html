<html>
<head>
<title>Get started with Amazon Alexa Skills Proactive Events API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亚马逊Alexa技能主动事件API入门</h1>
<blockquote>原文：<a href="https://medium.com/swlh/get-started-with-amazon-alexa-skills-proactive-events-api-5b082bcb282c?source=collection_archive---------1-----------------------#2019-06-10">https://medium.com/swlh/get-started-with-amazon-alexa-skills-proactive-events-api-5b082bcb282c?source=collection_archive---------1-----------------------#2019-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2dcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">亚马逊Alexa Skills是无服务器应用程序，允许人们通过语音或屏幕控制与支持Alexa的设备进行交互——语音和屏幕辅助。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/ec9ae8cf045f6fe411e8ad8de91eca9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*s6DvkoJG61cEBkNeiLu6ew.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Amazon Echo Dot</figcaption></figure><p id="abf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常期望用户开始交互，触发Alexa技能对命令或问题做出响应。这样，用户可以决定何时开始交互。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jp"><img src="../Images/e1376c5eea55883fb850a4590b298eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*psnxcbMgBNyl0kAs0-t6HA.gif"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Request-respond voice interaction</figcaption></figure><p id="6d88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，在某些情况下，用户必须定期请求更新或新的信息。在这种情况下，由Alexa设备发起的通知可能更好。<a class="ae jq" href="https://developer.amazon.com/docs/smapi/proactive-events-api.html" rel="noopener ugc nofollow" target="_blank">主动事件API </a>提供了这个选项。</p><p id="8557" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简短的<a class="ae jq" href="https://www.youtube.com/watch?v=jjPqY_UZwlA" rel="noopener ugc nofollow" target="_blank">视频演示</a>提供了关于Alexa和主动事件的快速介绍。</p><p id="54bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从主动事件API开始，我们需要创建一个简单的Alexa技能和AWS Lambda函数，它将在本文中用作游乐场。这篇<a class="ae jq" rel="noopener" href="/@sergeysmolnikov/create-simple-amazon-alexa-skill-with-backend-on-java-fcdbac05ed14">文章</a>和<a class="ae jq" href="https://www.youtube.com/watch?v=5rHIHUjuNRk" rel="noopener ugc nofollow" target="_blank">视频教程</a>或许可以作为指南。</p><h2 id="3427" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">设置ASK-CLI</h2><p id="ee0b" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">安装<a class="ae jq" href="https://developer.amazon.com/docs/smapi/quick-start-alexa-skills-kit-command-line-interface.html#install-initialize" rel="noopener ugc nofollow" target="_blank"> ASK CLI </a> — Alexa Skills Kit命令行工具。这是必要的，因为Alexa技能管理API (SMAPI)用于设置，SMAPI支持的一些功能在亚马逊开发者门户上不支持。<em class="kr">技能事件</em>功能就是其中之一，<em class="kr">它只能用ASK CLI </em>来管理，而不能用亚马逊开发者门户来管理。</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="367e" class="jr js hi kt b fi kx ky l kz la">sudo npm install -g ask-cli</span></pre><ul class=""><li id="58da" class="lb lc hi ih b ii ij im in iq ld iu le iy lf jc lg lh li lj bi translated">初始化ASK CLI。这将设置对API服务的访问。请在<a class="ae jq" href="https://developer.amazon.com/docs/smapi/manage-credentials-with-ask-cli.html" rel="noopener ugc nofollow" target="_blank">使用ASK CLI管理凭据</a>指南中找到更多详细信息。</li></ul><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="07c3" class="jr js hi kt b fi kx ky l kz la">ask init</span></pre><p id="1d0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在初始化过程中，会自动打开一个带有登录页面的浏览器。请按照<a class="ae jq" href="https://developer.amazon.com/docs/smapi/set-up-credentials-for-an-amazon-web-services-account.html" rel="noopener ugc nofollow" target="_blank">说明</a>填写要求的AWS访问密钥ID和AWS秘密访问密钥。</p><p id="5be7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<em class="kr"> ask init </em>的替代方法是使用管理员用户的AWS访问密钥ID和我们将使用的AWS秘密访问密钥来配置<a class="ae jq" href="https://developer.amazon.com/docs/smapi/quick-start-alexa-skills-kit-command-line-interface.html#install-initialize" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a></p><h2 id="a48f" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">向技能添加事件</h2><p id="90dd" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">使用ASK CLI时，需要将<a class="ae jq" href="https://developer.amazon.com/docs/smapi/proactive-events-api.html#onboard-smapi" rel="noopener ugc nofollow" target="_blank">主动事件添加到</a>技能清单中。<a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html" rel="noopener ugc nofollow" target="_blank">选择一个或多个事件模式</a>作为通知发送(它们具有不同的有效载荷结构和属性)。事件模式列表定期扩展，<a class="ae jq" href="https://alexa.uservoice.com/forums/906892-alexa-skills-developer-voice-and-vote/" rel="noopener ugc nofollow" target="_blank">请为遗漏的模式和功能投票</a>。当前可用的事件模式:</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="f71b" class="jr js hi kt b fi kx ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#weather-alert" rel="noopener ugc nofollow" target="_blank">AMAZON.WeatherAlert.Activated</a></span><span id="79d4" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#sports-event" rel="noopener ugc nofollow" target="_blank">AMAZON.SportsEvent.Updated</a></span><span id="758c" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#message-alert" rel="noopener ugc nofollow" target="_blank">AMAZON.MessageAlert.Activated</a></span><span id="a045" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#order-status" rel="noopener ugc nofollow" target="_blank">AMAZON.OrderStatus.Updated</a></span><span id="9deb" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#occasion" rel="noopener ugc nofollow" target="_blank">AMAZON.Occasion.Updated</a></span><span id="7c25" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#trash-collection-alert" rel="noopener ugc nofollow" target="_blank">AMAZON.TrashCollectionAlert.Activated</a></span><span id="7cb7" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#media-content" rel="noopener ugc nofollow" target="_blank">AMAZON.MediaContent.Available</a></span><span id="a802" class="jr js hi kt b fi lk ky l kz la"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#social-game-invite" rel="noopener ugc nofollow" target="_blank">AMAZON.SocialGameInvite.Available</a></span></pre><p id="bd59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以json文件<br/> <code class="du ll lm ln kt b">ask api get-skill -s skill_id &gt; skill.json</code>的形式获取技能清单</p><p id="273d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你最喜欢的文本编辑器中打开这个文件</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/3bcf3375ad8807399af8772b0f578d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*BzwstlF0zrYLVvNOebzunw.png"/></div></figure><p id="e512" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向<em class="kr">清单</em>部分添加<em class="kr"> notification.write </em>权限</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="f82a" class="jr js hi kt b fi kx ky l kz la">"permissions": [{"name": "alexa::devices:all:notifications:write"}],</span></pre><p id="14be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将选定的事件名称添加到<em class="kr">清单</em>部分。在这个例子中—选择了两个事件模式:<em class="kr"> AMAZON。OrderStatus .更新了</em>和<em class="kr">亚马逊。可用的媒体内容</em>。将Alexa Skill AWS Lambda函数ARN放到端点属性中(关于端点和Lambda函数的更多细节在本指南的中)</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/fda87541bc396144cc36fb362b10e16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ronkSCC7E36kz9Ap_sjBqQ.png"/></div></figure><p id="49ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仔细修改双引号字符，这些字符可能会被一些编辑器替换为类似的替代字符。</p><p id="549d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用正确的清单更新技能(将实际的<em class="kr"> skill_id </em>放到命令中)</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="501f" class="jr js hi kt b fi kx ky l kz la">ask api update-skill -s skill_id -f skill.json</span></pre><p id="f5ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查技能状态—如果更新正确，状态将包含<em class="kr">成功</em></p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="bde9" class="jr js hi kt b fi kx ky l kz la">ask api get-skill-status -s <!-- -->skill_id</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lr"><img src="../Images/71393d8a669c56958a00263f089fc19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*sjcLNbf7YJ7OuizO6twDpg.png"/></div></figure><h2 id="ecf1" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">技能客户端Id和客户端密码</h2><p id="1d15" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">Alexa技能的开发者控制台现在应该包含该技能的<em class="kr">客户端Id </em>和<em class="kr">客户端秘密</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ls"><img src="../Images/f3ec4b819baf976237e03cd805e0e817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6ocFoBXkEs-bvGwvkg1Jw.png"/></div></div></figure><p id="32a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开一个<em class="kr"> Alexa </em>手机应用(<a class="ae jq" href="https://itunes.apple.com/us/app/amazon-alexa/id944011620?mt=8" rel="noopener ugc nofollow" target="_blank"> iOS </a>、<a class="ae jq" href="https://play.google.com/store/apps/details?id=com.amazon.dee.app&amp;hl=en" rel="noopener ugc nofollow" target="_blank"> Android </a>)或<a class="ae jq" href="https://alexa.amazon.com/" rel="noopener ugc nofollow" target="_blank"> Alexa web-dashboard </a>。打开技能并启用它</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/9a0af50c7cb45f1733c73a31474860b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*ZLVdum0-5X4Y4ImFtpTMqg.png"/></div></figure><p id="d9ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Alexa技能现在应该有一个部分<em class="kr">了，这个技能需要权限才能通过<em class="kr"> Alexa通知</em>访问</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ly"><img src="../Images/a04526e8dc300c3fed9b95071a226dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_NCn0s-LTzSwGOCwCnnumg.png"/></div></div></figure><p id="b1f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<em class="kr">设置</em>按钮，点击<em class="kr">管理权限</em>按钮</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es lz"><img src="../Images/458462653ef7926ac1e635c7a87a0dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jR_GdKDx2yX9JnEbqOxxg.png"/></div></div></figure><p id="1139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<em class="kr">开关</em>允许通知，点击<em class="kr">保存权限</em>按钮保存更改</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ma"><img src="../Images/7115631bf85dd0afebdfd621b8a1518b.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*zLwAlq_YwaVvhUWHm-4LqQ.png"/></div></div></figure><p id="35cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在拥有该技能的Alexa设备可以接收技能清单中指定的主动事件。事件可以由常规的HTTP客户端发送。比如:<a class="ae jq" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>、<a class="ae jq" href="https://en.wikipedia.org/wiki/CURL" rel="noopener ugc nofollow" target="_blank"> cUrl </a>、IntelliJ IDEA<a class="ae jq" href="https://www.jetbrains.com/help/idea/http-client-in-product-code-editor.html" rel="noopener ugc nofollow" target="_blank">“HTTP客户端”——插件</a>等。</p><p id="495d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是对<a class="ae jq" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>客户端的测试。</p><h2 id="a44c" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">请求不记名令牌</h2><p id="43ea" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在<em class="kr"> Postman </em> —点击一个“<strong class="ih mb">+”</strong>选项卡，添加一个新的<em class="kr">请求选项卡</em>，选择<em class="kr"> POST </em>作为请求类型，输入不记名令牌API URL</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="6c01" class="jr js hi kt b fi kx ky l kz la"><a class="ae jq" href="https://api.amazon.com/auth/o2/token" rel="noopener ugc nofollow" target="_blank">https://api.amazon.com/auth/o2/token</a></span></pre><p id="5c94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开Headers选项卡，添加一个带有值的键<em class="kr"> Content-Type </em></p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="9834" class="jr js hi kt b fi kx ky l kz la">application/x-www-form-urlencoded</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/5921ad992a49e60649b56d7eacdc9ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVHazVEryjYv8M6ZqDLr8g.png"/></div></div></figure><p id="b48d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可选的<em class="kr">批量编辑</em>模式允许以文本形式填写键值对，<em class="kr">键值编辑</em>模式以表格形式填写键值对</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/8eabe2ed9d64bc1df50546273676ed02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1oPiDHl9nZQHLU5mv-NLzg.png"/></div></div></figure><p id="5e2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<em class="kr"> Body </em>选项卡，添加以下键值，选择选项<em class="kr"> x-www-form-urlencoded。</em>将实际<em class="kr">客户端id </em>和<em class="kr">客户端秘密</em>从<em class="kr">开发者控制台中取出，构建</em>选项卡<em class="kr">，权限</em>选项卡(如前所述)</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="cdaa" class="jr js hi kt b fi kx ky l kz la">Key:"grant_type"      Value:"client_credentials"<br/>Key:"client_id"       Value:"amzn1.application-oa2-client.a478..."<br/>Key:"client_secret"   Value:"ef1286b2..."<br/>Key:"scope"           Value:"alexa::proactive_events"</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/239df3a7108fa4c2de1af3cd85f0fb5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_rOaNhjVBUF_fe8CRHfGw.png"/></div></div></figure><p id="8e6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:键<em class="kr">作用域</em>的值包含<em class="kr">双分号</em>，当设置批量/文本编辑模式的请求时，这可能会混淆一些HTTP客户端。</p><p id="f6d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln kt b">{ "access_token”:”accessToken”, "expires_in":3600, "scope":"alexa::proactive_events", "token_type":"Bearer" }</code></p><p id="5bad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击带有<em class="kr"> Pretty/JSON </em>选项的<em class="kr"> Send </em>按钮——查看响应，其中应该包含<em class="kr"> access_token </em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/340a4a162ba60367ee7e4dfc838da8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MBm1it3_OqnwkfjjIkXjLg.png"/></div></div></figure><p id="fe4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该令牌将在3600秒后(一小时后)过期。在这段时间之后，新的请求将获得响应代码403 ( <em class="kr">未授权</em> ) —需要请求新的令牌来继续进一步的请求。</p><p id="dd52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个不记名令牌应该伴随每个对事件API的请求。这个API有三个区域的独立端点，以及开发和生产环境。对于开发环境端点，事件不会发送给真实客户，而是用于测试目的:</p><p id="b0e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">发展</em><br/><a class="ae jq" href="https://api.amazonalexa.com/v1/proactiveEvents/stages/development" rel="noopener ugc nofollow" target="_blank">https://api.amazonalexa.com/v1/proactiveEvents/<strong class="ih mb">阶段/发展</strong> </a> <strong class="ih mb"> </strong> <em class="kr">(北美)</em> <br/> <a class="ae jq" href="https://api.eu.amazonalexa.com/v1/proactiveEvents/stages/development" rel="noopener ugc nofollow" target="_blank"> https://api。<strong class="ih mb">欧盟。</strong>amazonalexa.com/v1/proactiveEvents/<strong class="ih mb">阶段/发展</strong> </a> <em class="kr">(欧洲)</em> <br/> <a class="ae jq" href="https://api.fe.amazonalexa.com/v1/proactiveEvents/stages/development" rel="noopener ugc nofollow" target="_blank"> https://api。<strong class="ih mb">铁。</strong>amazonalexa.com/v1/proactiveEvents/<strong class="ih mb">发展阶段</strong> </a> <em class="kr">(远东)</em></p><p id="5882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">制作</em><br/><a class="ae jq" href="https://api.amazonalexa.com/v1/proactiveEvents/" rel="noopener ugc nofollow" target="_blank">https://api.amazonalexa.com/v1/proactiveEvents/</a><em class="kr">(北美)</em> <br/> <a class="ae jq" href="https://api.eu.amazonalexa.com/v1/proactiveEvents/" rel="noopener ugc nofollow" target="_blank"> https://api。<strong class="ih mb">欧盟。</strong>amazonalexa.com/v1/proactiveEvents/</a><em class="kr">(欧洲)</em> <br/> <a class="ae jq" href="https://api.fe.amazonalexa.com/v1/proactiveEvents/" rel="noopener ugc nofollow" target="_blank"> https://api。<strong class="ih mb">铁。</strong>amazonalexa.com/v1/proactiveEvents/</a><em class="kr">【远东】</em></p><h2 id="5305" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">发送主动通知</h2><p id="5322" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在<em class="kr"> Postman </em>应用程序中—点击另一个“<strong class="ih mb">+”</strong>选项卡以添加新的<em class="kr">请求选项卡</em>，选择<em class="kr"> POST </em>作为请求类型，并输入开发事件API URL</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="0e89" class="jr js hi kt b fi kx ky l kz la"><a class="ae jq" href="https://api.amazonalexa.com/v1/proactiveEvents/stages/development" rel="noopener ugc nofollow" target="_blank">https://api.amazonalexa.com/v1/proactiveEvents/<strong class="kt mb">stages/development</strong></a></span></pre><p id="061d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开Headers选项卡，添加一个带有值的key <em class="kr"> Content-Type </em></p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="e5f8" class="jr js hi kt b fi kx ky l kz la">application/json</span></pre><p id="cbcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加另一个带值的密钥<em class="kr">授权</em></p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="8e67" class="jr js hi kt b fi kx ky l kz la">Bearer Atc|...</span></pre><p id="f8e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中"<em class="kr"> Atc|…" </em>是来自先前接收的来自承载令牌API的响应的<em class="kr">访问令牌</em>属性的值。</p><p id="b4cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:术语<em class="kr">持有者</em>和代币价值之间有一个空格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/1919a258fcd336b096067ad61511856a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2O74kGxxWX6L_ZFqMOy9aw.png"/></div></div></figure><p id="8ad4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<em class="kr"> Body </em>选项卡，添加事件的json-content，选中选项<em class="kr"> raw </em></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="8444" class="jr js hi kt b fi kx ky l kz la">{<br/>  . . .<br/>   "event":  {<br/>      "name": "<strong class="kt mb">AMAZON.MediaContent.Available</strong>",<br/>     . . .<br/>     "localizedAttributes": [<br/>      {<br/>        "locale": "en-US",<br/>        "providerName": "<strong class="kt mb">Alexa Events Example</strong>",<br/>        "contentName": "<strong class="kt mb">Some event</strong>"<br/>      }<br/>    ],<br/>   "relevantAudience": {<br/>    "type": "<strong class="kt mb">Multicast</strong>",<br/>    "payload": {}<br/>`   }<br/>}</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/85f3488eeed6393508b60c789da3d0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCyJXHuwMXxN1AY1cP00Nw.png"/></div></div></figure><p id="81fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个正文内容对应的是<a class="ae jq" href="https://developer.amazon.com/docs/smapi/schemas-for-proactive-events.html#media-content" rel="noopener ugc nofollow" target="_blank">亚马逊。MediaContent.Available </a>模式，在本例中，媒体相关事件为:</p><p id="a966" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">"<em class="kr">Alexa Events Example</em>"("<em class="kr">providerName</em>")通知"<em class="kr">Some Events</em>"("<em class="kr">content name</em>")的新"<em class="kr">插曲</em> " (" <em class="kr"> contentType </em>")将通过"<em class="kr"> air </em>"("方法")在2019年6月8日晚8点美国东部时间 " (" <em class="kr">开始时间<em class="kr"/></em></p><p id="d012" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本通知将于“2019年6月8日下午2 <em class="kr">时</em>”(“<em class="kr">到期时间</em>”)到期。</p><p id="01ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<em class="kr">发送</em>按钮。如果承载令牌和事件内容正确，则响应代码将为202 ( <em class="kr">接受</em>)，内容长度为零(无响应体)。打开Alexa设备会发出通知声音并开始闪烁。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es md"><img src="../Images/0add49038fcae3df50fa567032b5384f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRZBWqsFU_J9cP-WjceIzg.png"/></div></div></figure><p id="366e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要阅读通知，问“Alexa，我的通知是什么？”或者“Alexa，我错过了什么？”，此时收集的所有通知都将被宣布。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="me lq l"/></div></figure><p id="075c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，时间的发音不是针对Alexa设备时区的。我猜它对应于API区域或其配置的AWS Lambda函数，或者技能区域——我还没有确定地发现这一点。日期时间值应该采用ISO 8601格式，以“<em class="kr">Z</em>”(UTC)或时区转换周期结束</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="d22b" class="jr js hi kt b fi kx ky l kz la">“startTime”: “2019–06–10T00:00:00Z<br/>"startTime": "2019-06-10T05:00:00+05:00"</span></pre><p id="a111" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阅读通知后，它会在云中存档几个小时，然后自动删除。要阅读这些存档的通知——问Alexa:“Alexa，我的<em class="kr">旧</em>通知是什么？”</p><p id="1c8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以用“Alexa，删除我所有的通知”命令删除通知。</p><h2 id="775d" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">失败</h2><p id="84ef" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">如果请求有问题，响应代码将有4个**代码，响应正文将包含错误描述。此类问题的示例:</p><p id="c8df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置无效的“<em class="kr">到期时间</em>”。它应该是未来的至少5分钟，并且不超过当前时间之后的24小时:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/82137eb575637168410aaba3d5116f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*apK5EDFBMqvTc_RKxSp6jg.png"/></div></div></figure><p id="e9f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置的属性值无效，在事件架构中不受支持。查看“<em class="kr">消息</em>”值，其中包含与特定问题相关的信息。在值字符中"<em class="kr"> \n </em>"可以替换为<em class="kr">换行符</em>，"<em class="kr"> \ </em>"可以替换为<em class="kr">双引号</em>，这样可读性更好。但是即使没有这样的修正，问题也是可以解决的</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/96b1541d22cb590b4ae48cafeac900f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5eyLRha7pOKYap5Nn2USA.png"/></div></div></figure><p id="a03b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为Visual Studio代码中的一个更正示例，字符可以替换为正则表达式选项。修复新行:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/02380d5b55710e884e96d46a5459b881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgAzhTMmPfqzPP2zHB0baA.png"/></div></div></figure><p id="1b0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修复双引号</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/87deef2ba1077ec4bc2c84060c91f32e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSHNwDIYLSirF7tX5OcSzw.png"/></div></div></figure><p id="63d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用json-extension保存修改后的文件会增加一些亮点</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mf"><img src="../Images/cfcf0ee7a3e48b954b12a55bae3663b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgWTYBFRXR8cKUW6OrVRqw.png"/></div></div></figure><h2 id="9a94" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">活动受众选项</h2><p id="be3c" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">事件可以发送给所有特定技能用户(那些允许来自该技能的通知的用户)或特定用户，使用他们的<em class="kr">用户id </em>。属性“<em class="kr"> relevantAudience </em>”用值“<em class="kr">多播</em>”和“<em class="kr">单播</em>”控制该选项。</p><p id="f467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向所有用户发送事件(广播或组播):</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="ffbd" class="jr js hi kt b fi kx ky l kz la">"relevantAudience": {<br/>    "type": "<strong class="kt mb">Multicast</strong>",<br/>    "payload": {}<br/>   }</span></pre><p id="fe5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向特定用户发送事件:</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="e08b" class="jr js hi kt b fi kx ky l kz la">"relevantAudience": {<br/>    "type": "<strong class="kt mb">Unicast</strong>",<br/>    "payload": <!-- -->{ "user": "specific-user-Id"  }<br/>   }</span></pre><p id="18d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跟踪用户id—订阅事件，通知用户打开/关闭主动通知。要使技能的Lambda函数接收此事件，请将以下订阅部分添加到Alexa技能清单中(添加到"<em class="kr"> events </em>"属性中)，并使用ASK-CLI更新清单</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="5fd6" class="jr js hi kt b fi kx ky l kz la">"subscriptions": [<br/>  {<br/>    "eventName": "SKILL_PROACTIVE_SUBSCRIPTION_CHANGED"<br/>  }<br/>]</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/e3282fa92df89ad8fb49918c9bb0cbef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jurx8DBrvoALeh5qyZ0WSw.png"/></div></div></figure><p id="be18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用正确的清单更新技能(将实际的<em class="kr"> skill_id </em>放入命令中)</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="d87a" class="jr js hi kt b fi kx ky l kz la">ask api update-skill -s skill_id -f skill.json</span></pre><p id="70fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向Alexa Skill AWS Lambda函数添加一个请求处理程序来处理该事件(示例代码扩展了一个Lambda函数，在<a class="ae jq" rel="noopener" href="/@sergeysmolnikov/create-simple-amazon-alexa-skill-with-backend-on-java-fcdbac05ed14">本教程</a>中创建)</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="112a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将此处理程序的实例添加到SkillStreamHandler生成器中</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="6314" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建jar文件并上传到Lambda函数。打开一个Alexa移动应用程序或<a class="ae jq" href="https://alexa.amazon.com/" rel="noopener ugc nofollow" target="_blank"> Alexa web-dashboard </a>，打开技能，点击<em class="kr">设置</em>按钮，打开<em class="kr">打开</em>或关闭<em class="kr">关闭</em>开关<em class="kr">允许通知，点击<em class="kr">保存权限</em>按钮保存更改</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es ma"><img src="../Images/7115631bf85dd0afebdfd621b8a1518b.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*zLwAlq_YwaVvhUWHm-4LqQ.png"/></div></div></figure><p id="8f8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在CustomProactiveSubscriptionChangedRequestHandler中订阅主动事件请求。请求正文包含“<em class="kr">订阅</em>”作为“事件名称”列表:</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="1872" class="jr js hi kt b fi kx ky l kz la">proactiveSubscriptionChangedRequest.getBody().getSubscriptions()</span></pre><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="850e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">取消订阅CustomProactiveSubscriptionChangedRequestHandler中的主动事件请求。请求正文不存在</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="670b" class="jr js hi kt b fi kx ky l kz la">proactiveSubscriptionChangedRequest.getBody() == null</span></pre><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="b8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择“<em class="kr">用户标识</em>和事件名称列表来管理单个通知</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="f095" class="jr js hi kt b fi kx ky l kz la">String userId = input.getRequestEnvelope().getContext().getSystem().getUser().getUserId();<br/>//userId looks like "amzn1.ask.account.AFE2..."</span></pre><p id="2bf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并向特定用户发送通知，与“<em class="kr">单播</em>”“<em class="kr">相关受众</em></p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="2e12" class="jr js hi kt b fi kx ky l kz la">"relevantAudience": {<br/>   "type": "Unicast",<br/>   "payload": {"user": "amzn1.ask.account.AFE2..."}<br/> }</span></pre><h2 id="e313" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">可能的问题</h2><p id="6bf1" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">尝试向不允许技能通知的特定用户发送通知—返回错误:</p><p id="cdad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">"<em class="kr">找不到任何stage=development，skillId=amzn1.ask.skill.e2af…，topicId=AMAZON的订阅。可用的媒体内容</em></p><p id="10a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在响应消息中:"<em class="kr"> stage </em>"可以是"<em class="kr"> development </em>"或"<em class="kr"> live </em>"，对应的"<em class="kr"> skillId </em>"和一个事件模式名，事件已经为其发送。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mg"><img src="../Images/4e20aa04a4313070fa6a5d76705c56c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVtGmJl4_Gnxmugob8p5Ag.png"/></div></div></figure><p id="0bba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用有效的<em class="kr">无记名令牌和</em>正确的<em class="kr">用户标识</em>向特定用户发出有关事件的请求时，可能会出现以下问题，但此无记名令牌与为其生成的用户标识的技能不同。也许这个问题还有其他原因。</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="aa35" class="jr js hi kt b fi kx ky l kz la">{<br/> “type”: “Forbidden”,<br/> “message”: “No enablement for clientId: amzn1.application-oa2-client.d6ad..., userId: amzn1.ask.account.AFE...”<br/>}</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mh"><img src="../Images/4120ae79cc5975bd63b1bdb0e610767d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAxPgapByQj1IuEg5LEhRw.png"/></div></div></figure><p id="84ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当用户禁用技能时，不会发送ProactiveSubscriptionChanged事件。当该用户再次启用该技能时，将为该用户分配一个新的用户Id。因此，至少跟踪一个事件是有意义的。技能禁用”。还有关于激活/停用技能、启用/更改/禁用权限(包括接收主动通知的权限)的事件。为了让技能的Lambda函数接收这些事件，将下面的订阅部分添加到Alexa技能清单(添加到“<em class="kr">事件</em>”属性)中，并使用ASK-CLI更新清单</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="d3fb" class="jr js hi kt b fi kx ky l kz la">"subscriptions": [<br/>  {<br/>    "eventName": "SKILL_ENABLED"<br/>  },<br/>  {<br/>    "eventName": "SKILL_DISABLED"<br/>  },<br/>  {<br/>    "eventName": "SKILL_PERMISSION_ACCEPTED"<br/>  },<br/>  {<br/>    "eventName": "SKILL_PERMISSION_CHANGED"<br/>  }<br/>]</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/3192d33cd1aa8e6aa54b92a9eae43039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QZMSjeFJ5PdnmSPdDFpw5A.png"/></div></div></figure><p id="60a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">RequestHandlers类似于CustomProactiveSubscriptionChangedRequestHandler——它们都实现带有名称的接口，对应于事件名称(例如<em class="kr">PermissionAcceptedRequestHandler</em>),在<em class="kr">默认</em>方法实现中有样板代码</p><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="000f" class="jr js hi kt b fi kx ky l kz la">@Override<br/><strong class="kt mb">default boolean </strong>canHandle(HandlerInput handlerInput) {<br/>    <strong class="kt mb">if </strong>(handlerInput.getRequest() <strong class="kt mb">instanceof </strong>PermissionAcceptedRequest) {<br/>        <strong class="kt mb">return </strong>canHandle(handlerInput, (PermissionAcceptedRequest)handlerInput.getRequest());<br/>    }<br/>    <strong class="kt mb">return false</strong>;<br/>}<br/><br/>@Override<br/><strong class="kt mb">default </strong>Optional&lt;Response&gt; handle(HandlerInput handlerInput) {<br/>    <strong class="kt mb">return </strong>handle(handlerInput, (PermissionAcceptedRequest)handlerInput.getRequest());<br/>}</span></pre><p id="dbb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从技术上讲，来自这些处理程序的样板逻辑可以合并到一个处理程序中。</p><p id="2f1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些事件的最终技能表现如下</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/928498eac58158f4ce7abcd84af0ca29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSOFkYmMExM7cpaCqPPCqQ.png"/></div></div></figure><p id="6af2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jq" href="https://github.com/satr/aws-lambda-on-java-for-alexa-skill-proactive-events-api-example" rel="noopener ugc nofollow" target="_blank">代码</a>构建jar文件并上传到Lambda函数，连接到Alexa技能。这个函数有一个预构建的<a class="ae jq" href="https://github.com/satr/aws-lambda-on-java-for-alexa-skill-proactive-events-api-example/releases/tag/1.0" rel="noopener ugc nofollow" target="_blank">版本，带有jar文件</a>。在web-dashboard的移动应用程序中启用/禁用技能和打开/关闭通知设置，并查看Lambda功能的云监控日志以查看活动。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mi"><img src="../Images/e56f2b3b8bd0df3a75a325ff7681d698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvUBk2gU5frT89l5qJWn7A.png"/></div></div></figure><p id="0f4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jq" href="https://developer.amazon.com/docs/smapi/proactive-events-api.html#event-format" rel="noopener ugc nofollow" target="_blank">注意</a>:事件可能会无序到达，使用事件中的时间戳来正确记录客户的最新订阅状态。</p><h2 id="c7e5" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">语言和地区</h2><p id="0f31" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">为他们的后端创建Alexa技能和Lambda有不同地区的选项。AWS Lambda <a class="ae jq" href="https://developer.amazon.com/docs/smarthome/send-events-to-the-alexa-event-gateway.html#endpoints" rel="noopener ugc nofollow" target="_blank">应针对技能要求许可的每个地理区域进行配置</a>。例如，技能在美国和英国发送更改报告事件，则需要为北美和欧洲配置AWS Lambdas。出于培训和评估目的，更容易为美国语言制作技能，为<em class="kr">n . Virginia</em>(<em class="kr">US-east-1</em>)地区制作Lambda函数。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="er es mc"><img src="../Images/bca0c52f1a595ecb4234813dc8a77c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XTRNK_mOjDzkZ3nGI2Y_1Q.png"/></div></div></figure><h2 id="45d8" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">源代码</h2><p id="7316" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">发布于<a class="ae jq" href="https://github.com/satr/aws-lambda-on-java-for-alexa-skill-proactive-events-api-example" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。用jar文件预构建<a class="ae jq" href="https://github.com/satr/aws-lambda-on-java-for-alexa-skill-proactive-events-api-example/releases/tag/1.0" rel="noopener ugc nofollow" target="_blank">版本。</a></p><h2 id="71dd" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">参与API改进</h2><p id="e337" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">你可以在<a class="ae jq" href="https://alexa.uservoice.com/forums/906892-alexa-skills-developer-voice-and-vote/" rel="noopener ugc nofollow" target="_blank"> Alexa技能开发者论坛</a>上为功能和错过的事件类型投票。</p><p id="8fe3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文作为<a class="ae jq" href="https://www.youtube.com/watch?v=6Ul_ry2hq2w" rel="noopener ugc nofollow" target="_blank">视频教程</a>。简单Java ASK Proactive API工具包<a class="ae jq" href="https://github.com/satr/java-ask-proactive-api-kit" rel="noopener ugc nofollow" target="_blank">来源</a>。</p><p id="3d49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kr">亚马逊网络服务和AWS Lambda是Amazon.com公司或其附属公司在美国和/或其他国家的商标。</em></p></div></div>    
</body>
</html>