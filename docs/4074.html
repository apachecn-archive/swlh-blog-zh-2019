<html>
<head>
<title>Web (View) and UPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web(视图)和UPI</h1>
<blockquote>原文：<a href="https://medium.com/swlh/web-view-and-upi-7d3e8c346a2c#2019-05-28">https://medium.com/swlh/web-view-and-upi-7d3e8c346a2c#2019-05-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="b4e9" class="pw-subtitle-paragraph ig hh hi bd b ih ii ij ik il im in io ip iq ir is it iu iv iw ix dx translated"><em class="if">这篇文章探讨了手机上的网络和UPI应用程序之间的互通。</em></h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/0e965a8458eef971a3589d370de4817d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kns5jCp9fyKYR2v0-Jz9MA.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx"><em class="if">Web UPI</em></figcaption></figure><p id="edc5" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kk">TL；DR:这篇文章谈到了在你的android设备上，通过运行在webview中的网页/混合应用程序来定制UPI应用程序选择器。</em></p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="e44f" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae ks" href="https://play.google.com/store/apps/details?id=com.apuravchauhan.apuravupi" rel="noopener ugc nofollow" target="_blank">在playstore下载演示应用</a></p><p id="74cb" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae ks" href="https://github.com/apuravchauhan/web-upi" rel="noopener ugc nofollow" target="_blank"> Github源代码</a></p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="ccff" class="kt ku hi bd kv kw kx ky kz la lb lc ld ip le iq lf is lg it lh iv li iw lj lk bi translated">背景</h1><p id="ce09" class="pw-post-body-paragraph jo jp hi jq b jr ll ik jt ju lm in jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated"><strong class="jq lq">统一支付接口(UPI) </strong>在金融领域获得了越来越多的关注，随后开发人员和公司正在寻找方法来探索其在web上的用例。由于合众国际社要求验证您的手机号码，所以它只在您的手机操作系统上工作，而不是在网页/HTML/JS (android，iOS等)。</p><p id="5b74" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">希望将UPI整合到其网页中的公司仍然无法围绕UPI构建用户体验，因为他们无法在手机/ android上访问可用于处理UPI的应用。</p><p id="2959" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq lq">例如:</strong>假设我们希望在网页(HTML、JS等)上建立一种体验，允许客户在手机上选择可用的UPI应用程序，如Google Pay、PhonePe、Paytm、Airtel、Whatsapp等，并通过该应用程序启动支付。</p><h1 id="82f5" class="kt ku hi bd kv kw lr ky kz la ls lc ld ip lt iq lf is lu it lh iv lv iw lj lk bi translated">解决办法</h1><p id="8025" class="pw-post-body-paragraph jo jp hi jq b jr ll ik jt ju lm in jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">所有主流的移动操作系统(android、iOS等)都为你提供了通过JS添加一个桥接层的方法，允许你调用用本地语言编写的本地实用程序和函数。对于android，JS桥可以在内部将调用路由到本地Java api调用。(<em class="kk">这就是</em> <a class="ae ks" href="https://cordova.apache.org/" rel="noopener ugc nofollow" target="_blank"> <em class="kk">科尔多瓦</em> </a> <em class="kk">在幕后做的事情</em>)。</p><p id="cee0" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以在HTML/JS方面，可以把它想象成在javascript中暴露了一个全局jquery/angular/React变量，通过这个变量，你可以调用不同的方法，这些方法在内部调用本地方法。</p><h1 id="726c" class="kt ku hi bd kv kw lr ky kz la ls lc ld ip lt iq lf is lu it lh iv lv iw lj lk bi translated">这是如何工作的？</h1><p id="54ec" class="pw-post-body-paragraph jo jp hi jq b jr ll ik jt ju lm in jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">当你在android应用程序中通过webview打开HTML JS网页时，你实际上可以完全控制webview内部发生的任何通信。就像你的浏览器上的一个代理，可以跟踪你在网络视图中做的一切，就像一个迷你浏览器，你可以通过编程来操作(<strong class="jq lq">非常小心！</strong></p><h1 id="fb37" class="kt ku hi bd kv kw lr ky kz la ls lc ld ip lt iq lf is lu it lh iv lv iw lj lk bi translated">让我们编码</h1><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="684f" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">以上是我们的MainActivity.java。不要担心细节，(代码可在最后的下载部分获得)只要明白当你构建一个混合应用程序时，android应用程序将在幕后执行以下步骤:</p><ol class=""><li id="d709" class="ly lz hi jq b jr js ju jv jx ma kb mb kf mc kj md me mf mg bi translated">创建网络视图。(第19行)</li><li id="d97f" class="ly lz hi jq b jr mh ju mi jx mj kb mk kf ml kj md me mf mg bi translated">在webview中启用JS用法。(第22行)</li><li id="8b2a" class="ly lz hi jq b jr mh ju mi jx mj kb mk kf ml kj md me mf mg bi translated">注册一个全局javascript变量<strong class="jq lq"> "ApuSDK" </strong>名作为我们的JS接口。该变量指向具有方法实现的Java对象(WebAppInterface)。参见下面的要点。(第23行)</li><li id="fcad" class="ly lz hi jq b jr mh ju mi jx mj kb mk kf ml kj md me mf mg bi translated">加载你的html文件。(第29行)</li></ol><h2 id="7c22" class="mm ku hi bd kv mn mo mp kz mq mr ms ld jx mt mu lf kb mv mw lh kf mx my lj mz bi translated">下面是WebAppInterface的示例实现</h2><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lw lx l"/></div></figure><blockquote class="na nb nc"><p id="3cc7" class="jo jp kk jq b jr js ik jt ju jv in jw nd jy jz ka ne kc kd ke nf kg kh ki kj hb bi translated">可以看到用@JavascriptInterface注释的方法。这些方法可以通过HTML/JS，通过我们在前面的gist中定义的全局变量(“ApuSDK”)来调用。</p><p id="9904" class="jo jp kk jq b jr js ik jt ju jv in jw nd jy jz ka ne kc kd ke nf kg kh ki kj hb bi translated">用您的UPI句柄替换上面的第20行</p></blockquote><p id="855a" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的代码中，<strong class="jq lq"> upiHandlers </strong>方法将给出一个本地调用，以返回可以处理UPI支付的所有UPI应用程序的列表</p><p id="ef6e" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第二个方法<strong class="jq lq"> openUPIHandler </strong>从HTML/JS中获取关于打开哪个应用程序的两个参数，并转发对本地方法的调用以打开实际的应用程序。参见下面的要点(第33行和第48行)</p><h2 id="748b" class="mm ku hi bd kv mn mo mp kz mq mr ms ld jx mt mu lf kb mv mw lh kf mx my lj mz bi translated">下面的代码用于你的HTML网页</h2><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lw lx l"/></div></figure><blockquote class="na nb nc"><p id="9f24" class="jo jp kk jq b jr js ik jt ju jv in jw nd jy jz ka ne kc kd ke nf kg kh ki kj hb bi translated">结帐行33和48在上述要点。你可以看到我们使用全局变量<strong class="jq lq"> ApuSDK </strong>来调用java方法。虽然这看起来像是一个JS调用，但是在内部它将这个调用路由到前面定义的WebAppInterface.java要点中定义的java方法。</p></blockquote><p id="0c5c" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下面是最终目标:</p><div class="iz ja jb jc fd ab cb"><figure class="ng jd nh ni nj nk nl paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><img src="../Images/b9ba62c0a644f43a363ac418ef35cc47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*20s2F6pSKiVI5PF3P6Y-Lw.png"/></div></figure><figure class="ng jd nh ni nj nk nl paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><img src="../Images/a29f8cf20f404f47dbd24c94a51c5733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*tq5qL1Cl_2MHtjn3eJCJAg.jpeg"/></div><figcaption class="jk jl et er es jm jn bd b be z dx nm di nn no">Customised UPI app selection in HTML and JS (web view)</figcaption></figure></div><h1 id="8bb0" class="kt ku hi bd kv kw lr ky kz la ls lc ld ip lt iq lf is lu it lh iv lv iw lj lk bi translated">引人深思的事</h1><p id="399b" class="pw-post-body-paragraph jo jp hi jq b jr ll ik jt ju lm in jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">我们刚刚看到如何通过网页做到这一点。你们中的一些人一定想知道它对纯粹在网页上工作的人有什么用。这对于那些通过Cordova、Ionic、Phonegap等构建web技术(HTML /JS)混合应用程序的人来说很有用。</p><p id="4b18" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这些框架允许您添加插件来访问任何本机功能。上面在WebAppInterface.java展示的代码可以用在你的插件中，它可以让你直接在你的网页中访问android上的UPI应用程序。继续把它转换成一个cordova插件作为作业:)</p><p id="fcfc" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你需要任何进一步的帮助，请随时发微博给我@apuravchauhan。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h1 id="8259" class="kt ku hi bd kv kw kx ky kz la lb lc ld ip le iq lf is lg it lh iv li iw lj lk bi translated">[计] 下载</h1><p id="b157" class="pw-post-body-paragraph jo jp hi jq b jr ll ik jt ju lm in jw jx ln jz ka kb lo kd ke kf lp kh ki kj hb bi translated">本教程中使用的源代码是在<a class="ae ks" href="https://github.com/apuravchauhan/web-upi" rel="noopener ugc nofollow" target="_blank"> github </a>上开源的。播放、探索并分享您的反馈。</p><p id="2929" class="pw-post-body-paragraph jo jp hi jq b jr js ik jt ju jv in jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<a class="ae ks" href="https://play.google.com/store/apps/details?id=com.apuravchauhan.apuravupi" rel="noopener ugc nofollow" target="_blank"> playstore </a>上玩live app。</p></div></div>    
</body>
</html>