<html>
<head>
<title>Capture wpForms in Google Tag Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google标签管理器中捕获wpForms</h1>
<blockquote>原文：<a href="https://medium.com/swlh/capture-wpforms-in-google-tag-manager-21af6b51d1b7#2019-05-20">https://medium.com/swlh/capture-wpforms-in-google-tag-manager-21af6b51d1b7#2019-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2e31" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何使用Google标签管理器检测和捕获wpForm提交和数据</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/479cc8b9ff9bc408d01926fcc9fbcec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*-bM2ip0y3ATha1U2jbO78Q.jpeg"/></div></figure><p id="ac9f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">用Google Tag Manager捕获表单提交经常是一件痛苦的事情，因为GTM内置的表单触发器<a class="ae kb" href="https://www.simoahava.com/analytics/track-form-engagement-with-google-tag-manager/#2-why-the-form-trigger-doesn-t-always-work" rel="noopener ugc nofollow" target="_blank">并不适用于所有的表单</a>。</p><p id="1ce2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">不幸的是，这个触发器对最流行的WordPress表单插件之一<a class="ae kb" href="https://wpforms.com/" rel="noopener ugc nofollow" target="_blank"> wpForms </a>不起作用。然而，只需一点点javascript，我们就可以创建一个健壮的工作区，将wpForms提交发送到数据层，GTM可以在那里检测到它。</p><p id="b84c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kc">你可以在这里</em> 抓取javascript和GTM菜谱 <a class="ae kb" href="https://gist.github.com/kmclaugh/fad1431b1916f3776814f1a248f7a4b8" rel="noopener ugc nofollow" target="_blank"> <em class="kc"/></a></p><p id="3b28" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="https://slideruletech.com/subscribe/tech-tips/?mcsul=https://medium.com/swlh/capture-wpforms-in-google-tag-manager-21af6b51d1b7&amp;" rel="noopener ugc nofollow"> <em class="kc">订阅我的简讯</em> </a></p><h1 id="e09f" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">java描述语言</h1><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="10af" class="la ke hi kw b fi lb lc l ld le">// This code notifies Google Tag Manager when a wpForm is submitted<br/>document.addEventListener("DOMContentLoaded", function() {<br/>  var elementsArray = document.querySelectorAll('[id^="wpforms-form-"]');<br/>  elementsArray.forEach(function(elem) {<br/>    elem.addEventListener("submit", function(e) {<br/>      window.dataLayer = window.dataLayer || [];<br/>      window.dataLayer.push({<br/>        event: "wpFormSubmit",<br/>        wpFormElement: event.target<br/>      });<br/>    });<br/>  });<br/>});</span></pre><h1 id="fd7b" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">它是如何工作的</h1><p id="9b16" class="pw-post-body-paragraph jf jg hi jh b ji lf ij jk jl lg im jn jo lh jq jr js li ju jv jw lj jy jz ka hb bi translated">所有的wpForms都有一个<code class="du lk ll lm kw b">id="wpforms-form-XXXX"</code>，所以脚本首先找到页面上id以<code class="du lk ll lm kw b">"wpforms-form-"</code>开头的所有表单，并为每个表单添加一个事件监听器。</p><p id="3a44" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">事件监听器在每次提交表单时触发，并简单地将名为<code class="du lk ll lm kw b">"wpFormSubmit"</code>的<a class="ae kb" href="https://support.google.com/tagmanager/answer/7679219?hl=en" rel="noopener ugc nofollow" target="_blank"> <strong class="jh ln">自定义事件</strong> </a>与提交的表单元素一起推送到数据层(稍后将详细介绍)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/a7c4d1472c937713b980e3969795cec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N1AcDGrV3jnTHQcn.png"/></div></div></figure><h1 id="f6c9" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">怎么加</h1><p id="209c" class="pw-post-body-paragraph jf jg hi jh b ji lf ij jk jl lg im jn jo lh jq jr js li ju jv jw lj jy jz ka hb bi translated">如果可以的话，你应该使用像<a class="ae kb" href="https://wordpress.org/plugins/custom-css-js/" rel="noopener ugc nofollow" target="_blank">简单定制CSS和JS </a>这样的插件将脚本直接添加到你的WordPress站点的头部。这看起来是这样的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lt"><img src="../Images/34e54faf3527b17a40ad917b195f1fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z8g_KAlbyHOFPKbz.png"/></div></div></figure><p id="61df" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果你没有WordPress站点的管理员权限，或者由于某种原因不能将脚本直接添加到站点，你可以通过解开菜谱中的<strong class="jh ln"> wpForm Add Event Listener </strong>标签从GTM运行脚本:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lu"><img src="../Images/4918fe190adb7ee58fa53c81031feb4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqfFpoPJPl4US21619wfeQ.png"/></div></div></figure><h1 id="1fad" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">如何使用它</h1><p id="a72e" class="pw-post-body-paragraph jf jg hi jh b ji lf ij jk jl lg im jn jo lh jq jr js li ju jv jw lj jy jz ka hb bi translated">如上所述，脚本将一个<code class="du lk ll lm kw b">"wpFormSubmit"</code>事件和提交的表单元素推送到数据层。为了实际捕捉这些信息，例如，将它发送给Google Analytics，您必须创建一些GTM触发器、变量和标签(示例包含在<a class="ae kb" href="https://gist.github.com/kmclaugh/fad1431b1916f3776814f1a248f7a4b8#file-2-wpform-tag-manager-recipe" rel="noopener ugc nofollow" target="_blank">食谱</a>中)。</p><p id="cdef" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，您将创建一个在提交wpForm时触发的触发器。为此，创建一个<a class="ae kb" href="https://support.google.com/tagmanager/answer/7679219?hl=en" rel="noopener ugc nofollow" target="_blank"> <strong class="jh ln">自定义事件触发器</strong> </a>，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lv"><img src="../Images/b3dcc6d2bd76aa0859f269c1d543e9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NBfUF9lO44IhO_MU.png"/></div></div></figure><h1 id="dcef" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">捕获表单数据</h1><p id="a230" class="pw-post-body-paragraph jf jg hi jh b ji lf ij jk jl lg im jn jo lh jq jr js li ju jv jw lj jy jz ka hb bi translated">如果您只有一个wpForm，那么您可以在这里停下来，使用这个触发器来做您想做的任何事情。</p><p id="20c8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">但是如果您的站点上(或同一页面上)有多个wpForms，您可能希望捕获提交的表单的id。为此，首先必须在GTM中创建一个<a class="ae kb" href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/#5-data-layer-variable" rel="noopener ugc nofollow" target="_blank"> <strong class="jh ln">数据层变量</strong> </a>来访问脚本推送到数据层的<code class="du lk ll lm kw b">wpFormElement</code>，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lw"><img src="../Images/fcf3f91db45dfe8773560373a4ea8b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o9EfKDNNHq-Ixxi4.png"/></div></div></figure><p id="6a1f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">接下来，您将创建一个<a class="ae kb" href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/#4-custom-javascript" rel="noopener ugc nofollow" target="_blank"> <strong class="jh ln">自定义Javascript变量</strong> </a>，它从<strong class="jh ln"> wpFormElement </strong> <strong class="jh ln">数据层变量</strong>中提取表单id。看起来是这样的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lx"><img src="../Images/49646f722f78f533863bed3211d77a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k4Ia3P_1Zd_xg8oi.png"/></div></div></figure><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="85d5" class="la ke hi kw b fi lb lc l ld le">function() {<br/>  var wpFormId = {{wpFormElement}}.id;<br/>  return wpFormId ? wpFormId : undefined;<br/>}</span></pre><p id="26f8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">注意，我们的<strong class="jh ln"> wpFormElement </strong> <strong class="jh ln">数据层变量</strong>实际上是一个javascript对象，包含了所有提交的表单信息。所以我们可以使用如上所示的<a class="ae kb" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Property_accessors" rel="noopener ugc nofollow" target="_blank"> javascript点符号</a>来访问id。或者我们可以访问表单的动作，也使用点符号，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ly"><img src="../Images/4b0c6be6b4326342a50ce1edbf677de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GRoK7iiuEb_kaFXO.png"/></div></div></figure><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="539d" class="la ke hi kw b fi lb lc l ld le">function() {<br/>  var formAction = {{wpFormElement}}.action;<br/>  return formAction ? formAction : undefined;<br/>}</span></pre><p id="cdb5" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">或者我们甚至可以访问用户在表单中提交的值，如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/547c640cef90b21ba27f1a5973124081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FAvKdL4HRXkbQmmt.png"/></div></div></figure><pre class="iy iz ja jb fd kv kw kx ky aw kz bi"><span id="e210" class="la ke hi kw b fi lb lc l ld le">function() {<br/>  var field = {{wpFormElement}}.elements.item(0) //First element of form<br/>  return field ? field.value : undefined;<br/>}</span></pre><p id="7f38" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个变量将返回表单的第一个输入。例如，对于这种形式:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ma"><img src="../Images/5cfdd09e796f7046b1de0ee228e4fa2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/0*nJPMiefvg4b4PjDg.png"/></div></figure><p id="2057" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它将返回名字的值，即Kevin。</p><p id="ca65" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Simo Ahava在这里有一篇关于访问不同表单值的文章<a class="ae kb" href="https://www.simoahava.com/analytics/track-form-engagement-with-google-tag-manager/#5-capture-field-value" rel="noopener ugc nofollow" target="_blank">。只要把他的<code class="du lk ll lm kw b">"{{Form Element}}"</code>换成我们的<code class="du lk ll lm kw b">"{{wpFormElement}}"</code>就行了，应该是一样的。</a></p><p id="fe49" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">请记住，虽然您可以在GTM中捕获个人身份信息，但是您不能将这些信息发送到Google Analytics。</p><h1 id="27cf" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">将表单数据发送到Google Analytics</h1><p id="8899" class="pw-post-body-paragraph jf jg hi jh b ji lf ij jk jl lg im jn jo lh jq jr js li ju jv jw lj jy jz ka hb bi translated">现在您可以检测wpForm提交并将表单数据放入GTM变量中，您可以将这些信息发送到任何您喜欢的地方——Google Analytics、脸书等。大多数时候，你至少会想把它作为一个事件发送给Google Analytics。这就是我们想要的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mb"><img src="../Images/142410cbaff6b2a54d19ddf68bc3d376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eIdBkK9sn3nvvrG-.png"/></div></div></figure><h1 id="97c9" class="kd ke hi bd kf kg kh ki kj kk kl km kn io ko ip kp ir kq is kr iu ks iv kt ku bi translated">摘要</h1><p id="5ee0" class="pw-post-body-paragraph jf jg hi jh b ji lf ij jk jl lg im jn jo lh jq jr js li ju jv jw lj jy jz ka hb bi translated">你可以改进脚本和GTM方法，使其适用于GTM内置的表单触发器无法检测到的许多其他类型的WordPress表单插件。为此，您需要更改脚本的query selector“WP forms-form-”，以匹配插件使用的任何id模式。</p><p id="c789" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">由于很多网站使用WordPress，而且几乎每个人都想跟踪表单提交，我希望你会发现这个脚本既健壮又灵活。</p><p id="0b3a" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">和往常一样，请随意在下面留下评论，或者<a class="ae kb" href="https://slideruletech.com/contact/" rel="noopener ugc nofollow" target="_blank">联系</a>如果你需要在谷歌标签管理器中实现这个或任何其他东西的帮助。</p><p id="3c05" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kc">获取更多科技小技巧，</em> <a class="ae kb" href="https://slideruletech.com/subscribe/tech-tips/?mcsul=https://medium.com/swlh/capture-wpforms-in-google-tag-manager-21af6b51d1b7&amp;" rel="noopener ugc nofollow"> <em class="kc">订阅我的简讯</em> </a> <em class="kc">！</em></p></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><p id="c253" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kc">原载于2019年5月20日https://slideruletech.com</em><a class="ae kb" href="https://slideruletech.com/posts/capture-wpforms-in-gtm/" rel="noopener ugc nofollow" target="_blank"><em class="kc"/></a><em class="kc">。</em></p></div></div>    
</body>
</html>