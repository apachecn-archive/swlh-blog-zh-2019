# 一个页面上有多个 Angular 应用

> 原文：<https://medium.com/swlh/multiple-angular-apps-on-a-single-page-9f49bc863177>

# 问题是

试图将两个不同的角度应用程序放到一个 HTML 页面上。当您尝试这样做时，您会注意到您的第二个应用程序不会呈现。

我知道你们中的大多数人都在问为什么有人想这么做。Angular 是一个企业框架，旨在构建 SPA 而不是单独的小部件。我完全同意 SPA 设计是 Angular 的亮点，但并不是所有的企业都能够遵循这样的模式，或者升级到 SPA 并需要能够构建单独的小部件来替换现有的遗留小部件，直到他们能够完全升级到 SPA。

既然如此，让我们来看看如果你在一个页面上放两个应用程序会发生什么:

![](img/8a5933efd16b96af49a013e349ed4293.png)

Application 1 showing up because it is on top in the source

![](img/265633d6f5913611f0278c01a445256b.png)

Application 2 showing up because it is on top in the source

正如你所看到的，只有一个应用程序呈现(无论哪个应用程序的脚本在 html 中最先出现)。那么我们该如何解决这个问题？

# 解决方案 1

您可以在网上找到的一个解决方案是简单地将每个 Angular 应用程序包装在一个 iFrame 中。如果你像我一样，看到解决方案是 iFrame，你可能会不寒而栗(别担心，我会介绍一个更好的解决方案)。这在技术上是可行的，因为每个应用程序都运行在自己的沙盒环境中，因此不会导致任何其他应用程序出现问题。对于简单的应用程序来说，这是可行的，但是当事情变得更加复杂，你需要在应用程序中输入或输出数据时，这就成了一个大问题。您的应用程序也无法访问父窗口上的路由，最终成为一场通信噩梦。

# 解决方案 2

使用角元素。如果你没有使用过 Angular 元素，它们是一个很棒的工具，可以让你把 Angular 应用程序编译成 Web 组件。这允许一种更本地的 JS/HTML 方法。在本文中，我不会深入探讨如何创建有角度的元素，但是有很多关于这个主题的很好的资源。

我们使用这种方法有一段时间了，效果很好…直到它不起作用。问题变成了升级。因此，虽然事情在一段时间内会很好，但如果应用 1 升级了 Angular 或应用 2 依赖的另一个依赖项，并在其他应用升级之前部署(这是一个突破性的变化)，那么一个或两个应用就会停止在页面上工作。这是一个很大的问题，因为它只发生在运行时，而且没有办法知道一个应用程序是否有突破性的变化，除非你把两个都放到一个页面上。这使得我们的升级过程非常麻烦，需要协调发布，这违背了我们的 CI/CD 过程，并且没有很好地分离我们的关注点。因此，虽然这是一个可行的解决方案，但不是我们想要的解决方案。

# 解决方案 3

这让我寻找一个新的答案，支持 iFrames 的沙盒方法，但不能让应用程序像有角度的元素一样在页面上自然存在。挖掘了一段时间后，我无法找到这个问题的解决方案。那么，为什么这些应用程序只在最上面的一个可用时才出现呢？为了解决这个问题，我们必须深入了解 Angular 如何编译我们的文件。当我们看下引擎盖时，它只是使用 Webpack 来创建我们的包。了解这一点并深入研究后，我发现 Webpack 在窗口上创建了一个单独的命名空间对象。要看到这一点，请在任何装有 Angular 应用程序的页面上打开您的控制台，然后键入 *window.webpackJsonp。*一旦您看到，您将会看到 webpack 在此对象下命名的所有对象。这给了我尝试重命名输出的名称空间的想法。Angular 本身并没有给你这种能力，但幸运的是，在使用 Angular 元素之后，我能够使用工具 [Ngx Build Plus](https://github.com/manfredsteyer/ngx-build-plus) 。这是一个非常强大的工具，允许您为 Angular 构建过程配置 Webpack。

该工具适用于 Nrwl Nx 和常规角度应用。在本教程中，我们将研究如何在现有的独立 Angular 应用程序中实现。

要开始运行“npm install ngx-build-plus -D”

然后，您可以通过运行“ng add ngx-build-plus”来添加 build plus 作为项目构建器

我们现在已经设置了 Angular 的构建器来使用 ngx-build-plus，这意味着我们只需要配置我们的构建过程。

为此，我们只需要在我们的根级别添加一个文件，我们将这个文件命名为 webpack.extra.js

```
module.exports = {
   output: {
     jsonpFunction: 'namespacedName'
   }
}
```

用应用程序的唯一命名空间名称替换“命名空间名称”。对于这个例子，我使用了 webpackApplicationOne 和 webpackApplicationTwo

现在我们只需要用一个额外的参数“ng build—prod—extra-web pack-config web pack . extra . js”来运行我们的构建

现在，当我将我的两个应用程序合并成一个 index.html 并运行它时，我会得到:

![](img/06e0ccf5cd578b0f49b9dfdfe9b78226.png)

2 working apps on one page

我们可以看到我们的应用程序现在已经启动并运行了！这种方法有一些缺点和局限性。第一个是你可以用路由器做什么(有两个应用程序争夺相同的路由)。如果你只有一个可路由的应用程序，这应该不是一个问题。这也意味着您正在加载 Angular 和所有共享依赖项两次。这可能会降低性能，但通过一些在滚动或页面加载后加载应用程序的技巧，以及 Ivy 的新树摇动，希望您可以将每个较小的应用程序的加载时间缩短到可管理的更容易的时间。请随时评论和分享你的经验。

Nick Favero 是一个棱角分明的倡导者，他热爱它所提供的环境。他是 DHI 集团/Dice 的高级软件工程师，如果你正在寻找一份新的技术职业，在 Dice.com 找一份新的职业或者在 T2 DHI 找一份工作