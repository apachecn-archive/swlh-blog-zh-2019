<html>
<head>
<title>Managing Multiple GitHub Accounts on macOS Using a CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CLI管理macOS上的多个GitHub帐户</h1>
<blockquote>原文：<a href="https://medium.com/swlh/managing-multiple-github-accounts-on-macos-using-a-cli-2f5aa7941edd?source=collection_archive---------22-----------------------#2019-05-31">https://medium.com/swlh/managing-multiple-github-accounts-on-macos-using-a-cli-2f5aa7941edd?source=collection_archive---------22-----------------------#2019-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1bde1702704845551edca691827644e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1TUDCu9Gc7Vv4XGEClZkg.png"/></div></div></figure><p id="fcc4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为一名开发人员，您可能遇到过与使用多个GitHub帐户相关的问题。</p><p id="ccaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有几种方法可以解决这个问题。第一种方法是手动更新git配置，并从keychain中删除任何相关的密码。这种方法并不理想，因为每次你想换账户时都必须登录。当你不得不定期地在账户间切换时，这变得特别烦人。</p><p id="1da0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个主要方法是使用SSH。这种方法要好得多，因为您只需设置SSH配置，然后在git命令中使用正确的URL格式，就万事大吉了。</p><p id="5435" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我打算把这个方法更进一步，让使用多个GitHub账户成为一个梦想。为此，我将使用一个SSH配置和一个用NodeJS编写的自定义命令行界面。</p><h1 id="5922" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">设置SSH</h1><p id="360c" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们需要做的第一件事是创建几个SSH密钥。我们需要每个用户一个。对于本文，假设我们有两个帐户。</p><p id="5600" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将打开终端(或您使用的任何命令行应用程序)并将目录更改为我们的。ssh文件夹。的。ssh文件夹应该在您的根用户目录中。如果您还没有. ssh文件夹，那么您可以通过执行以下操作来创建它:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="f21c" class="la jp hi kw b fi lb lc l ld le">cd ~<br/>mkdir .ssh<br/>cd .ssh</span></pre><p id="b351" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要创建我们的密钥，为您想要管理的每个用户运行下面的命令一次。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="7e67" class="la jp hi kw b fi lb lc l ld le">ssh-keygen -t rsa -b 4096 -C "<a class="ae lf" href="mailto:your@email.com" rel="noopener ugc nofollow" target="_blank">your@email.com</a>"</span></pre><p id="3165" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在这里做的是使用<code class="du lg lh li kw b">ssh-keygen</code>命令生成rsa类型的公钥和私钥，大小为4096位，然后向其中添加包含我们的电子邮件的注释。</p><p id="c955" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您运行<code class="du lg lh li kw b">ssh-keygen</code>命令时，系统会提示您输入用于存储密钥的文件名。这个文件名需要是唯一的，在这个例子中使用您的GitHub用户名作为文件名。</p><p id="95ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">系统还会提示您输入密码。对于这个示例，我将把它留空。如果你想使用密码，并想知道更多，那么GitHub有一些关于这方面的文档。</p><p id="3794" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" href="https://help.github.com/en/articles/working-with-ssh-key-passphrases" rel="noopener ugc nofollow" target="_blank">https://help . github . com/en/articles/working-with-ssh-key-pass phrases</a></p><p id="d3e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你的密钥已经生成，运行<code class="du lg lh li kw b">ls</code>命令，这将允许你看到所有已经创建的密钥。对于每个用户，你应该有一个不带扩展名的，这是私钥，一个带. pub扩展名的，这是公钥。</p><p id="1018" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有了密钥，我们可以创建配置文件了。如果您的中还没有名为<code class="du lg lh li kw b">config</code>的文件。ssh文件夹，然后运行以下命令来创建它:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="0799" class="la jp hi kw b fi lb lc l ld le">touch config</span></pre><p id="cd3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在编辑器中打开该文件，并在其中键入以下内容:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="d39c" class="la jp hi kw b fi lb lc l ld le"># GitHub username<br/>Host github.com-username<br/>    HostName github.com<br/>    User git<br/>    IdentityFile ~/.ssh/{key}<br/>    IdentitiesOnly yes</span></pre><p id="b7a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将username替换为您的GitHub用户名，将<code class="du lg lh li kw b">{key}</code>替换为您提供的与该帐户相关的密钥的文件名。我们希望我们要管理的每个用户都有一个这样的块。</p><p id="d68f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你完成了，我们只需要再做一步，然后我们的SSH就设置好了。这一步是上传密钥到GitHub，登录你的每个账户，进入设置，然后SSH和GPG密钥。我们想要创建一个新的SSH密钥，所以单击new SSH key按钮。现在，您可以将您的公钥文件的内容粘贴到key字段中，并给它一个GitHub特定的标题。</p><p id="92a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成这项工作后，我们可以继续构建CLI。</p><h1 id="54c8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">构建CLI</h1><p id="b2dc" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在这个示例中，我将调用CLI git-config，但是您可以随意调用它。</p><p id="efcd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在某处创建一个以您的cli命名的文件夹，并导航到该文件夹。我们将把所有的代码放在这里。我们将首先运行<code class="du lg lh li kw b">npm init</code>来设置我们的package.json文件。浏览所有提示并输入您想要的值。一旦你完成了与<code class="du lg lh li kw b">npm init</code>打开文件，我们需要添加一件事给它。用您的入口点的值添加键bin，在我的例子中是<code class="du lg lh li kw b">"bin": "./index.js"</code>。</p><p id="bca1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还需要安装一些软件包来帮助我们的生活变得更容易。我们需要commander、数据存储和即时异步。Commander是一个可以让我们快速构建cli的包，data-store可以让我们存储git配置，prompt-async可以让我们轻松地在命令行中显示提示。运行以下命令来安装这些组件:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="40ef" class="la jp hi kw b fi lb lc l ld le">npm install commander data-store prompt-async --save</span></pre><p id="15d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦npm完成了软件包的安装，您应该有一个如下所示的package.json:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b0ff" class="la jp hi kw b fi lb lc l ld le">{<br/>  "name": "git-cli",<br/>  "version": "1.0.0",<br/>  "description": "CLI to help with managing multiple GitHub accounts",<br/>  "main": "index.js",<br/>  "bin": "./index.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>  "author": "Will Swan",<br/>  "license": "UNLICENSED",<br/>  "dependencies": {<br/>    "commander": "^2.20.0",<br/>    "data-store": "^3.1.0",<br/>    "prompt-async": "^0.9.9"<br/>  }<br/>}</span></pre><p id="576c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在已经准备好开始构建cli了。让我们从创建入口点文件开始。</p><h1 id="1b74" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">编写入口点</h1><p id="1d91" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在入口点文件中键入以下代码:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="a27f" class="la jp hi kw b fi lb lc l ld le">#!/usr/bin/env node</span><span id="8fa6" class="la jp hi kw b fi lj lc l ld le">// Packages<br/>const Program = require('commander');</span><span id="498f" class="la jp hi kw b fi lj lc l ld le">// Src<br/>const Config = require('./src/Config');<br/>const Push = require('./src/Push');<br/>const Clone = require('./src/Clone');</span><span id="1896" class="la jp hi kw b fi lj lc l ld le">// CLI details<br/>Program<br/>  .version('1.0.0')<br/>  .description('git-cli App');</span><span id="b6c9" class="la jp hi kw b fi lj lc l ld le">// Config command<br/>Program<br/>  .command('config &lt;name&gt;')<br/>  .description('Switch between configurations')<br/>  .action((name) =&gt; {<br/>    Config.handler(name);<br/>  }).parse(process.argv);</span><span id="8fc6" class="la jp hi kw b fi lj lc l ld le">// Push command<br/>Program<br/>  .command('push &lt;version&gt;')<br/>  .description('Push changes to GitHub')<br/>  .action((version) =&gt; {<br/>    Push.handler(version);<br/>  }).parse(process.argv)</span><span id="39bf" class="la jp hi kw b fi lj lc l ld le">// Clone command<br/>Program<br/>  .command('clone &lt;repoName&gt;')<br/>  .description('Clone a GitHub repo')<br/>  .action((repoName) =&gt; {<br/>    Clone.handler(repoName);<br/>  }).parse(process.argv);</span><span id="b75b" class="la jp hi kw b fi lj lc l ld le">// Parse arguments<br/>Program.parse(process.argv);</span></pre><p id="b1f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来看看这是怎么回事。</p><p id="a9dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从以下内容开始:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="08d0" class="la jp hi kw b fi lb lc l ld le">#!/usr/bin/env node</span></pre><p id="d582" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是使用节点运行cli所必需的。</p><p id="95e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们继续导入commander，我们还导入了三个源文件。这些文件将包含我们每个命令的代码。</p><p id="94f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们用一个版本和描述来设置cli。如果您运行help命令，那么这些应该会显示在命令行中。</p><p id="687b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们创建三个命令:配置、推送和克隆。所有这些命令都有一个必需的参数，在config命令中，这是<code class="du lg lh li kw b">&lt;name&gt;</code>。他们也有描述。运行help命令时，应该会显示说明。最后，它们都有一个动作，这是编写命令的所有逻辑的地方，在我们的例子中，我们调用源文件中的处理程序并传递参数。</p><p id="8f25" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们有一行解析所有传入的参数。</p><p id="5618" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目前，如果你试图运行它，它不会工作，你会得到一个bash错误，说命令没有找到。这是因为我们还没有创建任何符号链接，我们可以通过运行<code class="du lg lh li kw b">npm link</code>来完成。运行此命令后，您应该能够像访问任何其他命令一样访问cli。例如，如果我们运行:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="d427" class="la jp hi kw b fi lb lc l ld le">git-cli config TestName</span></pre><p id="c7b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这现在可以工作了，你会得到一个错误，因为我们还没有创建我们的源文件，但是命令会被找到。</p><p id="75db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们创建我们的<code class="du lg lh li kw b">src</code>文件夹，并添加我们的三个源文件。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b683" class="la jp hi kw b fi lb lc l ld le">mkdir src<br/>touch ./src/Config.js<br/>touch ./src/Push.js<br/>touch ./src/Clone.js</span></pre><h1 id="8b39" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">编写配置命令</h1><p id="fd13" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们将一点一点地查看我们的Config.js文件。首先，我们需要导入一些包。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="43d2" class="la jp hi kw b fi lb lc l ld le">// Packages<br/>const Prompt = require('prompt-async');<br/>const Store = require('data-store');<br/>const store = new Store({ path: '/Users/username/git-config.json'});<br/>const util = require('util');<br/>const exec = util.promisify(require('child_process').exec);</span></pre><p id="978a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们正在导入prompt-async和data-store。然后，我们通过创建一个新的store对象来设置我们的数据存储，并传入我们希望保存json文件的位置。我们将把它存储在我们的用户根目录中。这将允许我们从任何目录运行命令，并且仍然能够访问存储。</p><p id="8912" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们导入util。我们希望这样，这样我们就可以使用<code class="du lg lh li kw b">promisify</code>，因为我们希望能够使用异步await运行<code class="du lg lh li kw b">exec</code>。然后，我们进入import exec。</p><p id="c462" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来键入以下内容:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="cdaa" class="la jp hi kw b fi lb lc l ld le">// Available configs<br/>const configs = {<br/>  username1: {<br/>    name: 'username1',<br/>    email: '<a class="ae lf" href="mailto:emailforaccount@domain.com" rel="noopener ugc nofollow" target="_blank">emailforaccount@domain.com</a>'<br/>  },<br/>  username2: {<br/>    name: 'username2',<br/>    email: '<a class="ae lf" href="mailto:emailforaccount@domain.com" rel="noopener ugc nofollow" target="_blank">emailforaccount@domain.com</a>'<br/>  }<br/>};</span></pre><p id="e61d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此配置对象将保存我们所有可用的帐户，继续添加您想要管理的所有帐户。我们将在下一步中使用这个对象。</p><p id="56e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们编写我们的处理程序，键入以下内容:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="463b" class="la jp hi kw b fi lb lc l ld le">// Handler<br/>exports.handler = async (name) =&gt; {</span><span id="44e1" class="la jp hi kw b fi lj lc l ld le">  // Check configs<br/>  console.log('Checking configs...');<br/>  let config = {};<br/>  if (name === 'username1') {<br/>    config.name = configs.username1.name;<br/>    config.email = configs.username1.email;<br/>  } else if (name === 'username2') {<br/>    config.name = configs.username2.name;<br/>    config.email = configs.username2.email;<br/>  } else {<br/>    throw 'Please provide a valid config name';<br/>  }</span><span id="13a6" class="la jp hi kw b fi lj lc l ld le">  // Ask what repo we are working on<br/>  Prompt.start();</span><span id="4902" class="la jp hi kw b fi lj lc l ld le">  try {</span><span id="38f9" class="la jp hi kw b fi lj lc l ld le">    let response = await Prompt.get({<br/>      name: 'repoName',<br/>      description: 'What repo are you working on?',<br/>      required: true<br/>    });</span><span id="4fea" class="la jp hi kw b fi lj lc l ld le">    config.repo = response.repoName;</span><span id="337e" class="la jp hi kw b fi lj lc l ld le">    // Store config<br/>    store.set('git', config);</span><span id="1258" class="la jp hi kw b fi lj lc l ld le">    console.log('Configs checked');</span><span id="29e1" class="la jp hi kw b fi lj lc l ld le">    // Set git configs<br/>    await setGitConfigs(config);</span><span id="85b4" class="la jp hi kw b fi lj lc l ld le">    // Set remote url<br/>    await setRemoteURL(config);</span><span id="74de" class="la jp hi kw b fi lj lc l ld le">  } catch(err) {<br/>    throw err;<br/>  }</span><span id="5679" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="5fb1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在处理程序中做的第一件事是创建一个空的配置对象。然后，我们检查name参数是否对应于configs对象中定义的帐户之一。如果我们得到一个匹配，那么我们就把名字和电子邮件设置为空的配置对象。如果不匹配，那么我们抛出一个错误，告诉我们提供一个有效的配置名。</p><p id="87dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后，我们使用prompt-async显示一个提示，询问我们当前正在进行什么样的回购。一旦为提示符输入了一个值，我们就将该值设置为我们的config对象。我们的配置对象现在包含了我们需要的所有东西，所以我们使用<code class="du lg lh li kw b">store.set('key', 'data)</code>将它保存到我们的存储中。</p><p id="b7fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们继续调用两个函数，<code class="du lg lh li kw b">setGitConfigs()</code>和<code class="du lg lh li kw b">setRemoteURL()</code>。第一个函数用于设置本地和全局git配置，第二个函数用于设置git远程URL。</p><p id="1c85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们编写<code class="du lg lh li kw b">setGitConfigs()</code>函数:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="8d3a" class="la jp hi kw b fi lb lc l ld le">async function setGitConfigs(config) {</span><span id="3eb4" class="la jp hi kw b fi lj lc l ld le">  console.log('Setting local and global git configs...');</span><span id="5001" class="la jp hi kw b fi lj lc l ld le">  // Set global and local git configs<br/>  const { stdout, stderr } = await exec(`git config --global user.name ${config.name}; git config --global user.email ${config.email}; git config user.name ${config.name}; git config user.email ${config.email};`);</span><span id="bce2" class="la jp hi kw b fi lj lc l ld le">  if (stderr) {<br/>    throw stderr;<br/>  } else {<br/>    console.log('Local and global git configs set');<br/>  }</span><span id="fda6" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="83a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们使用exec运行设置git配置的命令，就像在命令行中一样。我们等待exec完成，然后检查stderr以查看是否有错误。</p><p id="78ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的<code class="du lg lh li kw b">setRemoteURL()</code>功能非常相似:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="d036" class="la jp hi kw b fi lb lc l ld le">async function setRemoteURL(config) {</span><span id="08f9" class="la jp hi kw b fi lj lc l ld le">  console.log('Setting remote url...');</span><span id="f4f8" class="la jp hi kw b fi lj lc l ld le">  // Set remote url<br/>  const { stdout, stderr } = await exec(`git remote set-url origin <a class="ae lf" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>-${config.name}:${config.name}/${config.repo}.git`);</span><span id="6006" class="la jp hi kw b fi lj lc l ld le">  if (stderr) {<br/>    throw stderr;<br/>  } else {<br/>    console.log('Remote url set');<br/>  }</span><span id="7339" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="3063" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是现在的配置命令。如果您现在运行<code class="du lg lh li kw b">git-cli config yourusername</code>，那么您应该会看到显示的日志，让我们知道发生了什么。如果您愿意，您可以检查git-config.json文件以确保配置被存储，您也可以运行<code class="du lg lh li kw b">git config user.name</code>来查看git配置是否已经被设置。</p><p id="e528" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的config命令需要注意的一点是，它只能在已经是git目录的目录中运行。这是因为我们正在运行git命令。然而，这不应该是一个问题，因为只有在git目录下工作时才需要运行这个命令。</p><h1 id="bb68" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">编写推送命令</h1><p id="c6e9" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们在Push.js文件中需要的包与我们在Config.js文件中需要的包是相同的，所以您可以复制它们。</p><p id="7946" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看如何编写处理程序:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="4c28" class="la jp hi kw b fi lb lc l ld le">// Handler<br/>exports.handler = async (version) =&gt; {</span><span id="e991" class="la jp hi kw b fi lj lc l ld le">  console.log('Checking config...');</span><span id="e87d" class="la jp hi kw b fi lj lc l ld le">  // Get the stored config<br/>  const config = store.get('git');</span><span id="db8c" class="la jp hi kw b fi lj lc l ld le">  // Display the username for this config<br/>  console.log('');<br/>  console.log(`Username: ${config.name}`);<br/>  console.log('');</span><span id="7ed9" class="la jp hi kw b fi lj lc l ld le">  // Ask if this config is correct<br/>  Prompt.start();</span><span id="b5fa" class="la jp hi kw b fi lj lc l ld le">  try {</span><span id="70b4" class="la jp hi kw b fi lj lc l ld le">    let response = await Prompt.get({<br/>      name: 'correct',<br/>      description: 'Is this the correct config? Y/n',<br/>      required: true<br/>    });</span><span id="e932" class="la jp hi kw b fi lj lc l ld le">    if (response.correct.toLowerCase() === 'y') {</span><span id="e0fc" class="la jp hi kw b fi lj lc l ld le">      console.log('Config checked');</span><span id="1b91" class="la jp hi kw b fi lj lc l ld le">      // Add files<br/>      await addFiles();</span><span id="1208" class="la jp hi kw b fi lj lc l ld le">      // Commit<br/>      await commitFiles(version);</span><span id="ff5b" class="la jp hi kw b fi lj lc l ld le">      // Push<br/>      await pushFiles();</span><span id="6658" class="la jp hi kw b fi lj lc l ld le">    } else {<br/>      throw 'Please use git-cli config &lt;name&gt; to set the correct config'<br/>    }</span><span id="17c3" class="la jp hi kw b fi lj lc l ld le">  } catch(err) {<br/>    throw err;<br/>  }</span><span id="1784" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="a9d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在这里做的第一件事是从git-config.json文件中获取存储的配置。然后，我们显示已保存配置的用户名。我们这样做是因为我们想要检查以确保存储的配置是正确的。</p><p id="0c77" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了执行这个检查，我们显示一个提示，询问这是否是正确的配置，如果答案是<code class="du lg lh li kw b">Y</code>，那么我们继续执行这个命令。如果答案不是<code class="du lg lh li kw b">Y</code>，那么我们抛出一个错误，要求我们使用config命令来设置正确的配置。</p><p id="11b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果继续这个命令，我们调用三个函数，<code class="du lg lh li kw b">addFiles()</code>、<code class="du lg lh li kw b">commitFiles()</code>和<code class="du lg lh li kw b">pushFiles()</code>。让我们来看看这些函数。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="7392" class="la jp hi kw b fi lb lc l ld le">async function addFiles() {</span><span id="c17d" class="la jp hi kw b fi lj lc l ld le">  console.log('Adding files...');</span><span id="ed3a" class="la jp hi kw b fi lj lc l ld le">  const { stdout, stderr } = await exec('git add -A');</span><span id="c29a" class="la jp hi kw b fi lj lc l ld le">  if (stderr) {<br/>    throw stderr;<br/>  } else {<br/>    console.log('Files added');<br/>  }</span><span id="0d0f" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="491e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的<code class="du lg lh li kw b">addFiles()</code>函数中，我们使用exec运行git命令来添加文件。对于这个例子，我刚刚设置了添加所有文件，如果你愿意，你可以添加一个额外的参数到push命令，允许你传递你想要添加的文件。然后，我们等待exec完成并检查是否有错误。</p><p id="42a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">提交功能非常相似:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="89d7" class="la jp hi kw b fi lb lc l ld le">async function commitFiles(version) {</span><span id="51a8" class="la jp hi kw b fi lj lc l ld le">   console.log(`Comitting version ${version}...`);</span><span id="6901" class="la jp hi kw b fi lj lc l ld le">   const { stdout, stderr } = await exec(`git commit -m "${version}"`);</span><span id="6b59" class="la jp hi kw b fi lj lc l ld le">  if (stderr) {<br/>    throw stderr;<br/>  } else {<br/>    console.log(`Version ${version} committed`);<br/>  }</span><span id="b492" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="000c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们运行git命令来提交文件，并使用version参数作为消息。</p><p id="4d7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后是推送功能:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="5263" class="la jp hi kw b fi lb lc l ld le">async function pushFiles() {</span><span id="cf5b" class="la jp hi kw b fi lj lc l ld le">  console.log('Pushing files');</span><span id="efff" class="la jp hi kw b fi lj lc l ld le">  const { stdout, stderr } = await exec('git push');<br/>  console.log('Files pushed');</span><span id="04ea" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="fed1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你会注意到这里我们不检查任何错误，这是因为无论成功与否,<code class="du lg lh li kw b">git push</code>都会输出到stderr。如果有错误，cli将退出，并显示错误。</p><p id="f1e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我们现在需要push命令的所有内容。如果您在git目录中运行<code class="du lg lh li kw b">git-cli push 1.0.0</code>，那么您的更改应该被推送到正确的帐户和正确的repo。</p><h1 id="ba81" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">编写克隆命令</h1><p id="22f6" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们的最后一个命令用于克隆repos。通常，如果克隆一个回购，您可能会复制回购URL并运行<code class="du lg lh li kw b">git clone</code>，如果该回购在不同的帐户中，则可能会要求您登录该帐户。该命令旨在通过允许您执行<code class="du lg lh li kw b">git-cli clone repo-name</code>来简化过程，只要您有正确的配置集，那么这应该会将repo克隆到您执行该命令的目录中，而不需要复制任何内容或输入任何其他详细信息。</p><p id="6af2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就像在Push.js中一样，我们对Clone.js的导入是相同的，所以你可以复制它们。</p><p id="a1ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们编写处理程序:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="8301" class="la jp hi kw b fi lb lc l ld le">// Handler<br/>exports.handler = async (repoName) =&gt; {</span><span id="6adc" class="la jp hi kw b fi lj lc l ld le">  console.log('Checking config');</span><span id="1477" class="la jp hi kw b fi lj lc l ld le">  // Get stored config<br/>  const config = store.get('git');</span><span id="89f5" class="la jp hi kw b fi lj lc l ld le">  // Display username for the stored config<br/>  console.log('');<br/>  console.log(`Username: ${config.name}`);<br/>  console.log('');</span><span id="25ad" class="la jp hi kw b fi lj lc l ld le">  // Ask if this correct config<br/>  Prompt.start();</span><span id="acd1" class="la jp hi kw b fi lj lc l ld le">  try {</span><span id="0025" class="la jp hi kw b fi lj lc l ld le">    let response = await Prompt.get({<br/>      name: 'correct',<br/>      description: 'Is this the correct config? Y/n',<br/>      required: true<br/>    });</span><span id="57d6" class="la jp hi kw b fi lj lc l ld le">    if (response.correct.toLowerCase() === 'y') {</span><span id="18e7" class="la jp hi kw b fi lj lc l ld le">      console.log('Config checked');<br/>      console.log('Cloning repo...');</span><span id="3afb" class="la jp hi kw b fi lj lc l ld le">      const { stdout, stderr } = await exec(`git clone <a class="ae lf" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>-${config.name}:${config.name}/${repoName}.git`);</span><span id="f2ec" class="la jp hi kw b fi lj lc l ld le">      if (stderr.includes('Cloning into')) {<br/>        console.log('Repo cloned');<br/>      } else {<br/>        throw stderr;<br/>      }</span><span id="8e8f" class="la jp hi kw b fi lj lc l ld le">    } else {<br/>      throw 'Please use git-cli config &lt;name&gt; to set the correct config';<br/>    }</span><span id="1629" class="la jp hi kw b fi lj lc l ld le">  } catch(err) {<br/>    throw err;<br/>  }</span><span id="10e9" class="la jp hi kw b fi lj lc l ld le">}</span></pre><p id="d257" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您会注意到我们的处理程序与Push.js中的非常相似。这是因为我们也想检查以确保我们在克隆命令中使用了正确的配置。</p><p id="9dc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">处理程序的不同之处在于，我们使用exec运行git命令来克隆repo，包括存储在我们的配置和repoName参数中的详细信息，而不是调用一些函数。</p><p id="ff7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">和<code class="du lg lh li kw b">git push</code>一样，<code class="du lg lh li kw b">git clone</code>也将所有内容输出到stderr。但是，在克隆时，我们可以通过检查stderr是否包含<code class="du lg lh li kw b">'Cloning into'</code>来检查是否有错误。</p><p id="026a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是克隆命令的全部内容。你现在应该可以运行<code class="du lg lh li kw b">git-cli clone repo-name</code>了。如果您使用的是正确的配置，并且该存储库存在，那么您将看到克隆的存储库。</p><h1 id="fddf" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="c242" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在，我们已经设置了SSH并构建了一个cli来帮助我们有效地管理我们的多个GitHub帐户。我经常需要切换GitHub用户和repos，自从创建我的cli以来，我一直在使用它，它加快了我的开发过程。我希望你会发现它同样有用。</p><p id="5b65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解更多关于构建cli和它是如何工作的，那么你可以看一个我上传的YouTube视频，里面详细介绍了一切。</p><p id="accf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" href="https://www.youtube.com/watch?v=rjELrXXF_os" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=rjELrXXF_os</a></p><p id="b10b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我也把cli放在GitHub上，供大家使用。我已经有了一些我想做的改进和特性。这些在我制作的时候会推送到GitHub。你也可以随意参与回购。我很高兴看到人们给它添加了什么。</p><p id="603b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" href="https://github.com/willptswan/git-cli" rel="noopener ugc nofollow" target="_blank">https://github.com/willptswan/git-cli</a></p></div></div>    
</body>
</html>