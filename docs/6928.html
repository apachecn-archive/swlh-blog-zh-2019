<html>
<head>
<title>Weirded out by Zoho CRM API Auth?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">被Zoho CRM API Auth搞怪？</h1>
<blockquote>原文：<a href="https://medium.com/swlh/weirded-out-by-zoho-crm-api-6e3fd637237d?source=collection_archive---------5-----------------------#2019-06-26">https://medium.com/swlh/weirded-out-by-zoho-crm-api-6e3fd637237d?source=collection_archive---------5-----------------------#2019-06-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="94d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，Zoho文档不是很有帮助，我已经绞尽脑汁试图让我的节点应用程序与Zoho APIs对话。我不知道是谁决定将OAuth用于他们的API访问，我确信这有令人信服的理由，但这对于现代水疗来说是一件痛苦的事情。这里是一个一步一步的为同道奋斗。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/84b694aae966ecd5e7432862bb6b6b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1KWLWBcLKVYLKYI0r1sYg.jpeg"/></div></div></figure><p id="be75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih jp">第一步:安装SDK </strong></p><p id="cf40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jq">我们不打算用官方的SDK，因为不管出于什么原因，Zoho认为世界上只有一个存储引擎。假设我们使用Node，我们甚至不需要运行MySQL来存储访问令牌——我们可以将它们保存在内存中。</em></p><pre class="je jf jg jh fd jr js jt ju aw jv bi"><span id="5189" class="jw jx hi js b fi jy jz l ka kb">yarn add @trifoia/zcrmsdk</span></pre><p id="0c4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih jp">第二步:API令牌呼啦圈</strong></p><p id="c600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">去<a class="ae kc" href="https://accounts.zoho.com/developerconsole" rel="noopener ugc nofollow" target="_blank">https://accounts.zoho.com/developerconsole</a>和<strong class="ih jp">注册一个新的app </strong>。(出于我们的目的，重定向URL可以是任意的，但是您需要在您的客户端设置中使用相同的URL)。</p><p id="91ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在需要生成一个<strong class="ih jp">授权令牌</strong>。点击新创建的应用程序的省略号菜单项，并选择自客户端。输入你需要的作用域(在这里看到全部<a class="ae kc" href="https://www.zoho.com/crm/help/developer/api/oauth-overview.html#scopes" rel="noopener ugc nofollow" target="_blank">https://www . zoho . com/CRM/help/developer/API/oauth-overview . html # scopes</a>，别忘了加上前缀ZohoCRM我认为<code class="du kd ke kf js b">ZohoCRM.modules.all</code>对于大多数目的来说应该足够了)，选择一个更长的到期时间，复制生成的代码。</p><p id="1535" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在授权令牌过期之前，您需要抓紧时间生成一个<strong class="ih jp"> referesh令牌</strong>。这是文档中真正神秘的部分，也是最令人悲伤的地方。他们所谓的<code class="du kd ke kf js b">refresh_token</code>是一个持久令牌，可以用来永久地生成访问令牌，即a-la API密钥。</p><p id="02b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用邮差或任何东西向:<a class="ae kc" href="https://accounts.zoho.com/oauth/v2/token?code=1000.1c67743213ac86712e380e165ce59210.449fbcbe21691400345a854f601aca17&amp;grant_type=authorization_code&amp;client_id=1000.IWIT4FP8NZMU989528SIY22IOJXBRH&amp;client_secret=72eb5825bb7a7f11ff04ac698718c5c3cf46661920&amp;redirect_uri=http://localhost:3000/callback&amp;response_type=code&amp;access_type=offline" rel="noopener ugc nofollow" target="_blank">https://accounts.zoho.com/oauth/v2/token?code=<strong class="ih jp">&lt;grant _ code&gt;</strong>&amp;grant _ type = authorization _ code&amp;client _ id =<strong class="ih jp">&lt;client _ id&gt;</strong>&amp;client _ secret =<strong class="ih jp">&lt;client _ secret&gt;</strong>&amp;redirect _ uri =<strong class="ih jp">&lt;redirect _ uri&gt;</strong>&amp;response _ type = code</a></p><p id="8603" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将收到一个带有JSON对象的响应，记下<strong class="ih jp"> refresh_token </strong>，我们将需要它来设置我们的客户端。</p><p id="af51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih jp">第三步:设置你的客户端</strong></p><p id="e014" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用的是express，但是您可以根据您使用的任何路由框架进行调整。</p><p id="772a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，首先您创建一个<code class="du kd ke kf js b">zoho.config.js</code>来导出您的配置。更多信息见<a class="ae kc" href="https://www.npmjs.com/package/@trifoia/zcrmsdk" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/@trifoia/zcrmsdk</a>。你可能会想用一些。env变量，忽略Zoho用。属性文件。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="a1ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih jp">第四步:进行API调用</strong></p><p id="1bc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在您可以导入您的配置并开始进行API调用。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="823b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个应该可以了。我希望这是有帮助的，你不要像我一样在Zoho的OAuth文档上浪费时间——它们不是为人们准备的，他们只需要通过API访问他们的Zoho CRM帐户，没有令牌交换、范围和OAuth带来的所有其他复杂性。</p></div></div>    
</body>
</html>