<html>
<head>
<title>Beginner’s Guide to Load Testing with k6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">k6负载测试初学者指南</h1>
<blockquote>原文：<a href="https://medium.com/swlh/beginners-guide-to-load-testing-with-k6-73d55ee23723?source=collection_archive---------1-----------------------#2019-06-19">https://medium.com/swlh/beginners-guide-to-load-testing-with-k6-73d55ee23723?source=collection_archive---------1-----------------------#2019-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="c039" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第2部分—绩效目标和k6指标</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/6098a40514c30b2b77338671d1f279da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGbRNYX0UqKvho2X0ROzAg.png"/></div></div></figure><p id="7724" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">性能测试是一组测试的总称，包括许多类型的测试，正如在本系列的第一部分中所讨论的。每种测试类型都试图回答一组问题，以使性能测试过程更加面向目标。这意味着仅仅运行测试是不够的，你必须有一套要达到的目标。</p><p id="ad8e" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">由于我们正在测试一个API或一个网站，以下目标可能是相关的，您可以从中选择一个或多个:</p><ul class=""><li id="bbd3" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated"><strong class="jl kp">并发</strong>:设定这个目标的系统，通常有一个终端用户的概念，当许多并发用户试图访问系统时，需要观察系统的行为。他们主要想测试在高用户负载下有多少请求失败/通过。这既包括许多并发用户，也包括每个用户同时请求多个资源。</li><li id="f7bd" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><strong class="jl kp">吞吐量</strong>:没有终端用户概念的系统，会设定这个目标来观察系统的整体表现，同时有大量的请求/响应进出系统。</li><li id="3541" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><strong class="jl kp">服务器响应时间</strong>:这个目标表示从客户机向服务器发出初始请求到服务器发回响应所花费的时间。</li><li id="ca5a" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><strong class="jl kp">回归测试</strong>:有时我们的目标不是给系统带来“沉重的负载”，而是更多地关注“正常负载”以及功能和回归测试，以了解变化会如何影响我们的系统性能，以及它是否仍然符合我们定义的SLA。</li></ul><p id="ff5f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">总体思路是从速度、可伸缩性、稳定性和弹性的角度来衡量系统或系统的系统在高负载下的表现。每一个都可以用这些目标来衡量。</p><ol class=""><li id="1c68" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kv km kn ko bi translated"><strong class="jl kp">速度<em class="kw"/></strong></li><li id="a437" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kv km kn ko bi translated"><strong class="jl kp">可伸缩性</strong>可以通过系统在负载增加时的可伸缩性来衡量，也可以通过衡量系统在此负载下是否能持续一段时间来衡量。</li><li id="11ee" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kv km kn ko bi translated"><strong class="jl kp">稳定性</strong>可以通过系统承受负载的能力来衡量，并查看它是否能够承受大量错误和事件，并且仍然保持响应和稳定。</li><li id="d0fc" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kv km kn ko bi translated"><strong class="jl kp">弹性</strong>可以通过系统在承受过多或过于频繁的负载并最终导致系统崩溃后，如何从崩溃和停机中恢复并响应请求来衡量。</li></ol><h2 id="54d9" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated">重新运行测试以验证结果</h2><p id="783e" class="pw-post-body-paragraph jj jk hi jl b jm ls ij jo jp lt im jr js lu ju jv jw lv jy jz ka lw kc kd ke hb bi translated">您可以重新运行测试，看看它们在不同的测试中是否保持几乎相同的结果，并比较这些测试，看看它们是否有偏差。</p><p id="7a01" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果它们几乎相同，您可以分析测试并得出您的结果，否则您应该查明它偏离的地方，并试图找到一种方法来防止它发生，如瓶颈。</p><h2 id="d872" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated"><strong class="ak"> k6和指标</strong></h2><p id="4a5d" class="pw-post-body-paragraph jj jk hi jl b jm ls ij jo jp lt im jr js lu ju jv jw lv jy jz ka lw kc kd ke hb bi translated">k6支持一组内置和定制的指标，可以用来衡量各种事情，或者实现上述目标，或者证明它们是错误的。可以用来定义自定义指标的指标有:<a class="ae kf" href="https://docs.k6.io/docs/counter-k6metrics" rel="noopener ugc nofollow" target="_blank">计数器</a>、<a class="ae kf" href="https://docs.k6.io/docs/gauge-k6metrics" rel="noopener ugc nofollow" target="_blank">计量器</a>、<a class="ae kf" href="https://docs.k6.io/docs/rate-k6metrics" rel="noopener ugc nofollow" target="_blank">速率</a>和<a class="ae kf" href="https://docs.k6.io/docs/trend-k6metrics" rel="noopener ugc nofollow" target="_blank">趋势</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/12f5ce88dd2eda259b1808a22e15ee0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vdPNtvMGfnuls5_7rG8mQ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 built-in metrics</figcaption></figure><p id="dc83" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">正如您可能已经在上面看到的，下表描述了所有测试中报告的内置指标:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 built-in metrics, <strong class="ak">Credits</strong>: <a class="ae kf" href="https://docs.k6.io/docs/result-metrics#section-built-in-metrics" rel="noopener ugc nofollow" target="_blank">https://docs.k6.io/docs/result-metrics#section-built-in-metrics</a></figcaption></figure><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 HTTP-specific built-in metrics, <strong class="ak">Credits</strong>: <a class="ae kf" href="https://docs.k6.io/docs/result-metrics#section-http-specific-built-in-metrics" rel="noopener ugc nofollow" target="_blank">https://docs.k6.io/docs/result-metrics#section-http-specific-built-in-metrics</a></figcaption></figure><h2 id="036d" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated">自定义(非内置)指标</h2><h2 id="6021" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated">1.计数器</h2><p id="16ff" class="pw-post-body-paragraph jj jk hi jl b jm ls ij jo jp lt im jr js lu ju jv jw lv jy jz ka lw kc kd ke hb bi translated">这是一个简单的累积计数器，可用于测量任何累积值，如测试期间的错误数。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 Counter metric</figcaption></figure><p id="174f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">正如您在上面的例子中看到的，它计算了测试返回的404个错误的数量。结果在下面的截图中显而易见:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/47345b06e703feab21cab81d3654af38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*caIiiiUAjcSD49mVuBGJfA.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx">Results of k6 Counter metric</figcaption></figure><p id="ab0f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">因为这是一本初学者指南，所以我尽量坚持使用简单的例子，但是您可以根据自己的具体情况对它们进行扩展和定制。</p><h2 id="e6f7" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated">2.测量</h2><p id="91da" class="pw-post-body-paragraph jj jk hi jl b jm ls ij jo jp lt im jr js lu ju jv jw lv jy jz ka lw kc kd ke hb bi translated">此指标允许您保留最后添加到其中的内容。这是一个简单的可重写的指标，保留了它最后的附加值。</p><p id="f60c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">该指标可用于保留任何测试项目的最后值，无论是响应时间、延迟还是任何其他用户定义的值。</p><p id="ba77" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">如果您运行下面的代码，您会看到它捕获了最新的错误代码，即404。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 Gauge metric</figcaption></figure><p id="9950" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">测试结果显示在下面的截图中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/09136c18d36079428a502e711260ca30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1cKpSpRMgjMy9wg_-eZ1Q.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx">Results of k6 Gauge metric</figcaption></figure><h2 id="a6db" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated">3.速度</h2><p id="c0bf" class="pw-post-body-paragraph jj jk hi jl b jm ls ij jo jp lt im jr js lu ju jv jw lv jy jz ka lw kc kd ke hb bi translated">这个内置指标将比率保持在非零值和零/假值之间。例如，如果您添加两个假值和一个真值，百分比将变为33%。</p><p id="e564" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">它可用于跟踪成功请求/响应的比率，并将它们与错误进行比较。</p><p id="1967" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在下面这段代码中，您可以看到我添加了<code class="du mf mg mh mi b">res.error_code</code>作为一种度量，以查看我将捕获多少错误。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 Rate metric</figcaption></figure><p id="4804" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">下面是测试的结果，100%错误。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/6ed212717a1052c8b88be94a253014c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OiuMqAnYlA_Ir-oLZK61xg.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx">Results of k6 Rate metric</figcaption></figure><h2 id="51c5" class="kx ky hi bd kz la lb lc ld le lf lg lh js li lj lk jw ll lm ln ka lo lp lq lr bi translated">4.趋势</h2><p id="8c11" class="pw-post-body-paragraph jj jk hi jl b jm ls ij jo jp lt im jr js lu ju jv jw lv jy jz ka lw kc kd ke hb bi translated">此指标允许您统计计算您的自定义值。它会给出最小值、最大值、平均值和百分位数，正如上面针对<code class="du mf mg mh mi b">http_req*</code>请求的截图所示。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">k6 Trend metric</figcaption></figure><p id="5a97" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">上述趋势指标示例显示了如何在不考虑等待时间的情况下计算发送和接收时间。结果如下所示:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/e7ee43eada55ad4fedcce858775d9797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ls79S9pcf_T5xKEPvh_qrA.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx">Results of k6 Trend metric</figcaption></figure><p id="834c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这一部分，我试图描述性能测试的目标，以及如何使用度量来实现这些目标。在接下来的部分中，我将尝试更深入地向您展示更多关于如何定义定制指标以及如何使用它们的细节。</p><p id="57de" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">既然您已经很好地掌握了性能目标和k6指标，那么您可以转到下一篇文章中的<a class="ae kf" rel="noopener" href="/swlh/beginners-guide-to-load-testing-with-k6-ff155885b6db">，在这篇文章中，我将向您展示如何编写和运行k6脚本。</a></p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><p id="75a5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><strong class="jl kp">穆斯塔法·莫拉迪安</strong> <br/> Sr. SWE @ <a class="ms mt ge" href="https://medium.com/u/7df2fe2c0bfd?source=post_page-----73d55ee23723--------------------------------" rel="noopener" target="_blank">负载冲击</a><br/><a class="ae kf" href="http://github.com/mostafa" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae kf" href="https://www.linkedin.com/in/mostafa-moradian/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kf" href="https://twitter.com/MosiMoradian" rel="noopener ugc nofollow" target="_blank">Twitter</a></p></div></div>    
</body>
</html>