<html>
<head>
<title>Combat toxicity online with the Perspective API and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Perspective API和React在线对抗毒性</h1>
<blockquote>原文：<a href="https://medium.com/swlh/combat-toxicity-online-with-the-perspective-api-and-react-f090f1727374#2019-05-27">https://medium.com/swlh/combat-toxicity-online-with-the-perspective-api-and-react-f090f1727374#2019-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/35a200b51397a3d7dedfaa5cb72095f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zoQiOyYGMSr1jiWGQ4tpNw.png"/></div></figure><p id="efc1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">不可否认，互联网拉近了数百万人的距离，但它也成为有毒和虐待行为的滋生地。本文将带您构建一个React应用程序，该应用程序尝试使用Perspective API来防止带有恶意的评论被发送。</p><h1 id="bcb8" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">什么是透视API？</h1><p id="7b46" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated"><a class="ae kn" href="https://www.perspectiveapi.com/#/home" rel="noopener ugc nofollow" target="_blank"> Perspective API </a>是一种使用机器学习的服务，试图确定评论或其他短文本片段的意图。它可以用于任何数量的用例，以帮助对抗毒性、滥用和其他不良行为。它支持许多类别，并报告用户的意图与该标准匹配的概率。</p><h1 id="b704" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">我们将要建造的</h1><p id="761b" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">为了探索透视图API是如何工作的，我们将使用React构建一个简单的注释表单。当用户提交评论时，在允许提交之前，它将首先使用透视图API检查意图。</p><p id="c924" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该应用程序将允许您指定您想要验证意图的阈值和类别-您可以尽可能严格！</p><p id="006e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将利用一些工具来帮助我们构建项目:</p><ul class=""><li id="d004" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated"><a class="ae kn" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">创建React应用</a>(引导应用)</li><li id="e9c0" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated"><a class="ae kn" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a> (HTTP请求)</li></ul><p id="48ee" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你可以查看一个完成项目的<a class="ae kn" href="https://tsnolan23.github.io/comment-toxicity-filter/" rel="noopener ugc nofollow" target="_blank">演示</a>，它与我们将要构建的项目相似。我们开始吧！</p><h1 id="667e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">要求:</h1><ul class=""><li id="5302" class="ko kp hi io b ip ki it kj ix lc jb ld jf le jj kt ku kv kw bi translated">对React有一些基本的了解</li><li id="9be8" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">已安装节点和NPM</li><li id="f23e" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">通过谷歌云平台的透视API的API键</li></ul><p id="16c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我不打算介绍如何通过GCP生成API密匙，因为这不是本文的主题，但是，有很多其他的在线资源可以提供。比如<a class="ae kn" href="https://support.google.com/googleapi/answer/6158841?hl=en" rel="noopener ugc nofollow" target="_blank">这个通过Google </a>，第四步，你要启用的API叫做Perspective。</p><h1 id="5b4e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">第1部分:引导应用程序</h1><p id="f059" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">首先，让我们通过用<code class="du lf lg lh li b">creat-react-app</code>创建一个新项目来启动并运行我们的应用程序。如果您以前没有使用过<code class="du lf lg lh li b">create-react-app</code>，您可以通过运行以下命令来安装它:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="a657" class="lr jl hi li b fi ls lt l lu lv">npm install -g create-react-app</span></pre><p id="c0c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">否则，您可以初始化一个新项目，进入目录并添加我们将需要的依赖项:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="7f8a" class="lr jl hi li b fi ls lt l lu lv">create-react-app comment-form-perspective</span><span id="5f32" class="lr jl hi li b fi lw lt l lu lv">cd comment-form-perspective</span><span id="6786" class="lr jl hi li b fi lw lt l lu lv">yarn add axios</span></pre><p id="10ca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，您可以通过运行<code class="du lf lg lh li b">yarn start</code>来启动开发环境。</p><h1 id="b3ab" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">第2部分:创建表单</h1><p id="dfb8" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">现在我们的应用程序已经启动并运行，我们可以开始构建表单了。让我们首先删除当前在<code class="du lf lg lh li b">src</code>目录中的所有文件(但是保留<code class="du lf lg lh li b">src</code>文件夹！).</p><p id="e1e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦这个文件夹被清空，在<code class="du lf lg lh li b">src</code>目录中创建一个<code class="du lf lg lh li b">index.js</code>和<code class="du lf lg lh li b">style.css</code>。然后在<code class="du lf lg lh li b">src</code>中创建一个名为<code class="du lf lg lh li b">components</code>的新目录，并在其中放置一个<code class="du lf lg lh li b">App.js</code>和<code class="du lf lg lh li b">CommentForm.js</code>文件。当所有这些都完成后，您应该有以下文件夹结构:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="51d2" class="lr jl hi li b fi ls lt l lu lv">.<br/>└── src<br/>    ├── index.js<br/>    ├── style.css<br/>    └── components<br/>        ├── App.js<br/>        └── CommentForm.js</span></pre><p id="6bdc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">深入研究<code class="du lf lg lh li b">src/components/CommentForm.js</code>，我们将创建用户将输入文本的实际评论表单。该表单将:</p><ol class=""><li id="c0ca" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj lx ku kv kw bi translated">利用<code class="du lf lg lh li b">useState</code>钩子将我们的注释保存在状态中，并给我们一个方法来更新它的值</li><li id="8acd" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lx ku kv kw bi translated">包含一个<code class="du lf lg lh li b">form</code>,它将使用一个通过<code class="du lf lg lh li b">prop</code>提供的回调函数将我们的注释发送到父节点，我们稍后将在那里使用它</li><li id="3cba" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lx ku kv kw bi translated">包含一个<code class="du lf lg lh li b">textarea</code>,它将是我们注释状态的受控输入</li><li id="89bc" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lx ku kv kw bi translated">包含一个<code class="du lf lg lh li b">button</code>提交表单</li></ol><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="0235" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经构建好了表单，让我们转到<code class="du lf lg lh li b">src/components/App.js</code>，我们希望:</p><ol class=""><li id="9d3e" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj lx ku kv kw bi translated">呈现我们刚刚构建的<code class="du lf lg lh li b">CommentForm</code>组件</li><li id="b784" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lx ku kv kw bi translated">处理表单提交和<code class="du lf lg lh li b">console.log</code>我们的评论</li><li id="620e" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj lx ku kv kw bi translated">创建一个占位符，我们将在后面的教程中使用透视执行毒性检查</li></ol><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="1af1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">很好，现在让我们使用<code class="du lf lg lh li b">src/index.js</code>文件在页面上实际初始化和呈现我们的应用程序。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="7eb3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就完成了表单本身的功能，但是在我们继续之前，让我们通过向<code class="du lf lg lh li b">src/style.css</code>文件添加一些CSS来使一切看起来更好一点。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="0594" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就是这样！这就完成了第一部分。此时，您应该有一个如下所示的表单，当您单击submit时，您会在控制台中看到您的评论值！</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es ma"><img src="../Images/f4c4de24c2e685f0feea96e193ca1223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*isjtfgUmbmygTjS9FVY_Ng.png"/></div></div></figure><h1 id="c8df" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">第3部分:验证用户的意图</h1><p id="529c" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">现在我们有了一个向父组件提交评论的表单。我们实际上可以利用透视图API来验证用户的意图。所以，让我们从修改<code class="du lf lg lh li b">src/components/App.js</code>文件开始，实际发出这个请求。我们需要:</p><ul class=""><li id="d863" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated">导入<code class="du lf lg lh li b">axios</code>库来发出http请求</li><li id="4afe" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">向透视图API发出一个<code class="du lf lg lh li b">POST</code>请求，将注释作为有效负载</li><li id="3dab" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">利用我们的API密钥(替换下面第9行的<code class="du lf lg lh li b">YOUR_API_KEY</code>)</li><li id="adf7" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">指定我们想要验证的任何意图</li></ul><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="06dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，在上面的代码片段中，我们使用<code class="du lf lg lh li b">axios</code>向透视图API发出一个<code class="du lf lg lh li b">POST</code>请求。在那个请求中，我们传递了<code class="du lf lg lh li b">comment</code>以及一组<code class="du lf lg lh li b">requestedAttributes</code>。那些<code class="du lf lg lh li b">requestedAttributes</code>是我们想要检查的意图。有几个比我定义的更多，所以你可以尝试不同的组合。</p><p id="ceac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您查看我们<code class="du lf lg lh li b">console.log</code>的响应，您会注意到，对于我们请求的每个意图，我们都会得到以下内容:</p><pre class="lj lk ll lm fd ln li lo lp aw lq bi"><span id="e6ea" class="lr jl hi li b fi ls lt l lu lv">{  <br/>   <strong class="li mf">"TOXICITY"</strong>:{  <br/>      <strong class="li mf">"spanScores"</strong>:[  <br/>         {  <br/>            <strong class="li mf">"begin"</strong>:0,<br/>            <strong class="li mf">"end"</strong>:14,<br/>            <strong class="li mf">"score"</strong>:{  <br/>               <strong class="li mf">"value"</strong>:0.018322915,<br/>               <strong class="li mf">"type"</strong>:"PROBABILITY"<br/>            }<br/>         }<br/>      ],<br/>      <strong class="li mf">"summaryScore"</strong>:{  <br/>         <strong class="li mf">"value"</strong>:0.018322915,<br/>         <strong class="li mf">"type"</strong>:"PROBABILITY"<br/>      }<br/>   }<br/>}</span></pre><p id="41fa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有了这个响应，我们可以映射出我们所要求的意图的概率，并将它们与我们认为合适的阈值进行比较。如果概率低于该阈值，您可以保存评论，但如果不是，您可以向用户提供反馈，说明应该进行调整！</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="8754" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，现在，一旦对透视图的请求完成，我们检查我们请求的每一个意图，如果它们中的任何一个超过了概率<code class="du lf lg lh li b">0.75</code>，我们将注释标记为无效。您可以将阈值修改为您想要任何值！</p><p id="6c5a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在函数的<code class="du lf lg lh li b">then</code>部分，您可以随心所欲地使用结果。您可以为每个类别设置单独的阈值，将数据发送到服务器，可能性是无限的！</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="297c" class="jk jl hi bd jm jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh bi translated">摘要</h1><p id="f0a1" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">这是一个相当人为的例子，因为它只是记录意图是否有效，但是这个概念可以用于任何数量的用例，从前端验证到授权审核工具。</p><p id="18bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您还会注意到，一些查询的意图概率可能与您的预期不符。记住它用的是机器学习，所以随着时间的推移会越来越好！</p><p id="305b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你有任何允许用户评论的网站，并且正在与一些有害行为作斗争，你可能会考虑实现类似的东西！</p><p id="4a8a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这里你可以再次看到这个<a class="ae kn" href="https://github.com/tsnolan23/comment-toxicity-filter" rel="noopener ugc nofollow" target="_blank">的工作演示。</a></p></div></div>    
</body>
</html>