<html>
<head>
<title>Rebuilding my blog as a static site with Hugo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Hugo把我的博客重建成一个静态网站</h1>
<blockquote>原文：<a href="https://medium.com/swlh/rebuilding-my-blog-as-a-static-site-with-hugo-988e6bf6c07f?source=collection_archive---------23-----------------------#2019-07-08">https://medium.com/swlh/rebuilding-my-blog-as-a-static-site-with-hugo-988e6bf6c07f?source=collection_archive---------23-----------------------#2019-07-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7e9df7ddae198f7ff1c4bbd20a54a8bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3iaqEYswemWsaGT5qoY_w.jpeg"/></div></div></figure><p id="993e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的博客始于2010年，从那时起就基于Wordpress。这是有意义的，因为Wordpress基本上是最容易使用的网络软件，它允许你在几分钟内开始你的博客。几年过去了，现在我决定彻底抛弃Wordpress。跟随我从Wordpress到用<a class="ae jo" href="https://gohugo.io/" rel="noopener ugc nofollow" target="_blank"> Hugo </a>建立的静态网站的旅程。</p><h1 id="26d7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么我为了Hugo抛弃了Wordpress</h1><p id="a92a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在过去，Wordpress非常容易设置。安装了一个好看的主题，我准备发表一些文章。与此同时，围绕系统的经济发生了很大的变化，曾经用来管理你的博客的软件变成了CMS。2014年，我开了一个英文版的博客。它最初是通过博客网络创建的。后来我变得雄心勃勃，我想管理我的内容的方式与网络不兼容，所以我把网络分成两个独立的博客子目录。</p><p id="7da0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗯，成功了。算是吧。但是这很难管理，而且对Wordpress作为一个软件越来越大的兴趣吸引了越来越多的黑客。尽管没有被黑客攻击，我还是害怕在将来发现我的博客里有恶意软件或类似的东西。一年前，我完全关闭了评论。大量的垃圾评论花了太多的时间来调节。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/f01212a9677645b0b874825770b985cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*-nYdNz91LPiqI2v0haitSg.jpeg"/></div></figure><p id="8a91" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安全性是保持博客运行的主要因素之一，维护量也很大，所以我开始考虑其他解决方案。我有博客文章，没有动态内容，一旦访问者打开网站就会改变。那我为什么需要一个动态网站呢？很快我跳上了静态网站生成的列车，仅仅几个星期后我的作品集<a class="ae jo" href="https://kovah.de/" rel="noopener ugc nofollow" target="_blank"> kovah.de </a>就被部署成了一个基于Hugo的静态网站。</p><h1 id="cb53" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">哲基尔，盖茨比，雨果，Next.js？！</h1><p id="e7da" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">静态站点生成是最近的一件大事。有几个系统可供你使用，从good 'ol Jekyll到Gatsby和基于React的站点的Next.js等特殊解决方案，再到Gatsby和Hugo等现代生成器。如果你有兴趣，<a class="ae jo" href="https://www.staticgen.com/" rel="noopener ugc nofollow" target="_blank">staticgen.com</a>可能会为你提供更多的资源。</p><p id="3f40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么，我现在用哪个系统呢？我已经和Jekyll合作过了，但是这个系统看起来对ma multi-lang博客系统来说有点太复杂了。Next.js和Gatsby不适合我，因为我不想用React做一个简单的博客。这就是为什么我想给Hugo一个尝试，作为剩下的最后一个更大的框架之一。知道吗？即使有一些小问题，我对这个系统非常满意。</p><h1 id="c6c7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于我的Hugo设置的详细信息</h1><p id="c8e7" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Hugo入门还是挺容易的。安装它，生成一个新网站，创建第一个内容，瞧，你有一个网站运行，在10分钟内完成。接下来是有趣的部分:配置、本地化、设置布局和结构，以及添加前端。</p><h1 id="78ab" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">基本配置和本地化</h1><p id="5045" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">老实说，站点配置文件并不是很长，也没有太多要说的。设置网站标题、基本URL和其他各种设置，如分页数量。</p><p id="0eaa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文档直接介绍了如何设置不同的语言，我只花了几个小时就把博客配置成了我想要的样子。这是语言配置:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="2ada" class="lc jq hi ky b fi ld le l lf lg">DefaultContentLanguage = "en"<br/>defaultContentLanguageInSubdir = true</span><span id="439d" class="lc jq hi ky b fi lh le l lf lg">[languages]<br/>[languages.en]<br/>  contentDir = "content/en"<br/>  languageName = "EN"<br/>  languageCode = "en-us"<br/>  weight = 1</span><span id="01b3" class="lc jq hi ky b fi lh le l lf lg">[languages.de]<br/>  contentDir = "content/de"<br/>  languageName = "DE"<br/>  languageCode = "de-de"<br/>  weight = 2</span></pre><p id="6302" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我认为这是不言自明的。这里唯一不同寻常的设置是<code class="du li lj lk ky b">defaultContentLanguageInSubdir = true</code>，它将所有指向根目录<code class="du li lj lk ky b">https://blog.kovah.de/</code>的icoming请求重定向到<code class="du li lj lk ky b">https://blog.kovah.de/en/</code>，就像旧的Wordpress设置一样。感谢Hugo dev实现了这个特殊的设置！</p><h1 id="cb03" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">保持简单，没有主题</h1><p id="717b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">创建你的第一个Hugo站点的第一步是拉一个主题并在你的配置中启用它。然而，在尝试了一下我的作品集后，我放弃了整个主题结构。事情是这样的，你可以只使用基本的<code class="du li lj lk ky b">layouts</code>文件夹来配置和构建整个站点结构，没有任何主题。主题实际上只有在你想使用外部主题或者重用另一个站点的现有主题时才有用。</p><p id="79d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抛弃主题使得整个布局过程变得更加容易，因为现在你只需要查看一个目录。索引页、类别页和单篇文章的所有基本布局、所有部分和所有短代码都位于布局文件夹中。</p><h1 id="705c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">前端资产和静态文件</h1><p id="4c97" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果你认识Laravel，你可能已经和Laravel Mix合作过了。它基本上是Webpack和所有这些复杂的模块捆绑资产编译东西的包装器。我用Laravel Mix替换了我的旧的基于Grunt的资产工作流，因为它更简单，需要的配置更少。为了让它与Hugo和内置的资产处理一起工作，我设置了以下目录结构:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="662c" class="lc jq hi ky b fi ld le l lf lg">/<br/>├─ assets<br/>│ ├─ dist<br/>│ ├─ scripts<br/>│ └─ styles<br/>├─ ...</span></pre><p id="6ce9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里没有魔法发生:“脚本”包含所有的基本脚本(如果我有的话)和“样式”所有的Scss文件。Laravel Mix负责管理资产，并将缩小和优化的资产放入“assets/dist”目录。我通过丢下“assetDir =”告诉Hugo我的资产的位置。/assets/dist " '添加到配置文件中。</p><p id="9d64" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Hugo提供的一个简洁的特性是资产指纹。我没有用Laravel Mix对资产进行指纹识别，也没有试图将这些信息输入Hugo，而是让Hugo为我生成一切。为此，我使用了以下代码，例如用于样式文件的代码:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="147a" class="lc jq hi ky b fi ld le l lf lg">{{ $appcss := resources.Get "app.css" | fingerprint }}<br/>&lt;link rel="stylesheet" href="{{ $appcss.Permalink | relURL }}"&gt;</span></pre><p id="42bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du li lj lk ky b">$appcss := resources.Get "app.css" | fingerprint</code>告诉Hugo在资源目录中搜索<code class="du li lj lk ky b">app.css</code>文件，然后对其进行指纹识别。链接中的代码只是告诉Hugo输出资产文件的相对URL。<br/>结果是这样的:<code class="du li lj lk ky b">&lt;link rel="stylesheet" href="/app.49b14501b[...]a621f4b.css"&gt;</code></p><p id="9ae6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以对Prism.js资产使用相同的技术，该资产基于post front matter标志有条件地输出:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="c42d" class="lc jq hi ky b fi ld le l lf lg">{{ with .Params.hascode }}<br/>  {{ if . }}<br/>    {{ $highlightjs := resources.Get "highlighter.js" | fingerprint }}<br/>    &lt;script src="{{ $highlightjs.Permalink | relURL }}"&gt;&lt;/script&gt;<br/>  {{ end }}<br/>{{ end }}</span></pre><h1 id="733c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">语法突出显示的问题</h1><p id="68da" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我真的想使用内置的语法高亮。我真的很想，也尝试了。不幸的是，Chroma，这个用来用语法高亮显示代码块的库，不支持这样的内联PHP:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="9e7a" class="lc jq hi ky b fi ld le l lf lg">```php<br/>$some_variable = $a + $b;<br/>```</span></pre><p id="93d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的博客上有很多代码，很多PHP，用一行<code class="du li lj lk ky b">&lt;?php</code>开始像上面这样的一行程序没有任何意义。支持者告诉我Chroma不支持它，我必须使用Pygments。Pygments是旧的代码解析器，比Chroma慢，需要安装在Hugo使用的路径中。由于我不想尝试，我现在使用我的Wordpress博客上的Prism.js，它工作起来没有任何问题。也许我以后会给Pygments一个尝试，但现在10kb的JS不会伤害任何人，事实上它只在需要时加载，通过在帖子前面使用一个<code class="du li lj lk ky b">hascode: true</code>标志。</p><h1 id="0aed" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">各种元素的一些短代码</h1><p id="6d81" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">因为我在帖子中有几个非标准降价的元素，所以我为它们创建了一些短代码。短代码的工作方式和Wordpress完全一样，但是更容易设置。</p><p id="db7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了阻止Hugo渲染实际的短代码，我必须在花括号和小于号之间添加空格。要使用短代码，可以这样写:{{ &lt;短代码&gt; }} </p><h2 id="e0e0" class="lc jq hi bd jr lm ln lo jv lp lq lr jz jb ls lt kd jf lu lv kh jj lw lx kl ly bi translated">图像短码</h2><p id="32ef" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我没有任何脚本，所以图像不是懒惰加载。然而，我想提供基于视口大小的响应图像。由于Hugo通常将图片与相应的帖子捆绑在一起，您可以这样做:</p><p id="428a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lz">内线</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="342d" class="lc jq hi ky b fi ld le l lf lg">{{ &lt; image img="cms-cant-be-hacked.jpg" alt="Your CMS can't be hacked if you don't have one" modifier="right" &gt; }}</span></pre><p id="b8d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lz">短码</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="7546" class="lc jq hi ky b fi ld le l lf lg">{{ $original := .Page.Resources.GetMatch (.Get "img") }}<br/>{{ $image := $original.Resize "1000x" }}<br/>{{ $small_image := $original.Resize "500x" }}<br/>&lt;figure{{ with .Get "modifier"}} class="figure--{{.}}"{{ end }}&gt;<br/>  &lt;picture&gt;<br/>    &lt;source srcset='{{ $small_image.RelPermalink }}' media="(max-width: 500px)"/&gt;<br/>    &lt;source srcset='{{ $image.RelPermalink }}' media="(max-width: 1000px)"/&gt;<br/>    &lt;img src='{{ $original.RelPermalink }}'<br/>        width="{{ $original.Width }}" height="{{ $original.Height }}"<br/>        {{ with .Get "alt"}}alt="{{.}}"{{ end }}/&gt;<br/>  &lt;/picture&gt;<br/>  {{ with .Get "caption"}}&lt;figcaption&gt;{{ . }}&lt;/figcaption&gt;{{ end }}<br/>&lt;/figure&gt;</span></pre><p id="fd18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lz">结果</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="c9d9" class="lc jq hi ky b fi ld le l lf lg">&lt;figure class="figure--right"&gt;<br/>  &lt;picture&gt;<br/>    &lt;source srcset="/en/2019/static-blog-hugo/cms-cant-be[...]0x0_resize_q85_box.jpg" media="(max-width: 500px)"&gt;<br/>    &lt;source srcset="/en/2019/static-blog-hugo/cms-cant-be[...]00x0_resize_q85_box.jpg" media="(max-width: 1000px)"&gt;<br/>    &lt;img src="/en/2019/static-blog-hugo/cms-cant-be-hacked.jpg" alt="Your CMS can't be hacked if you don't have one" width="546" height="492"&gt;<br/>  &lt;/picture&gt;<br/>&lt;/figure&gt;</span></pre><h2 id="7d42" class="lc jq hi bd jr lm ln lo jv lp lq lr jz jb ls lt kd jf lu lv kh jj lw lx kl ly bi translated">警告框</h2><p id="349a" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">非常有用，目前用于链接到翻译，警告框呈现HTML divs。关键是:你可以将HTML或Markdown传递给shortcode，两者都能完美呈现。</p><p id="5ef1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lz">内线</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="0214" class="lc jq hi ky b fi ld le l lf lg">{{ &lt; alert type="info" &gt; }}<br/>This will be rendered as [HTML](#).<br/>{{ &lt;/ alert &gt; }}</span></pre><p id="1eba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lz">简称</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="7407" class="lc jq hi ky b fi ld le l lf lg">&lt;div class='alert{{ with (.Get "type") }} alert--{{ . }}{{ end }}'&gt;<br/>  {{ .Inner | markdownify }}<br/>&lt;/div&gt;</span></pre><p id="57e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lz">结果</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="c6f8" class="lc jq hi ky b fi ld le l lf lg">&lt;div class="alert alert--info"&gt;<br/>  This will be rendered as &lt;a href="#"&gt;HTML&lt;/a&gt;.<br/>&lt;/div&gt;</span></pre><p id="ccb9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解更多关于短码的知识以及你可以用它们做什么，看看<a class="ae jo" href="https://gohugo.io/content-management/shortcodes/" rel="noopener ugc nofollow" target="_blank"> Hugo文档</a>。</p><h1 id="50c5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">部署:几个命令，没有数据库的麻烦</h1><p id="a06b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">最后但同样重要的是:部署。当我推到主分支时，我使用Gitlab CI来运行自动化部署。然后Gitlab基本上运行以下步骤:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="9327" class="lc jq hi ky b fi ld le l lf lg"># Install dependencies for Laravel Mix and build the minified assets<br/>npm install<br/>npm run production</span><span id="515f" class="lc jq hi ky b fi lh le l lf lg"># Build the blog which generates everything in the /public directory<br/>hugo</span><span id="4bf0" class="lc jq hi ky b fi lh le l lf lg"># Deploy that to the server<br/>scp -r public user@server:/var/www/blog/</span></pre><p id="a699" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样。公共目录包含运行博客所需的一切。</p><h1 id="efe3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结果是:一个苗条，快速和低维护的博客</h1><p id="ae74" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">老实说，我花了一些时间来熟悉Hugo，因为这是我第一次使用如此复杂的静态站点设置。不管怎样，我对结果很满意。加上作为web服务器的nginx和作为CDN的Cloudflare，我能够将TTFB削减一半，并将页面大小(包括HTML和资产，不包括图像)减少大约30%-40%。该页面现在大约有100-120 kb大，加载时间大约为400-800毫秒(这已经包括基于Fathom的匿名页面跟踪！).灯塔以100分的满分证明了我为精简博客所做的努力。</p></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="51c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ll">本文首发于</em><a class="ae jo" href="https://blog.kovah.de/en/2019/static-blog-with-hugo/" rel="noopener ugc nofollow" target="_blank"><em class="ll">blog . kovah . de</em></a></p></div></div>    
</body>
</html>