<html>
<head>
<title>Dynamic Data Visualizations With Vue.js and D3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue.js和D3实现动态数据可视化</h1>
<blockquote>原文：<a href="https://medium.com/swlh/modular-data-visualizations-with-vue-js-and-d3-87b37392a589?source=collection_archive---------10-----------------------#2019-06-27">https://medium.com/swlh/modular-data-visualizations-with-vue-js-and-d3-87b37392a589?source=collection_archive---------10-----------------------#2019-06-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="e198" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">背景</h1><p id="4a90" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="https://codesandbox.io/s/d3-bar-chart-vuejs-okz1r?fontsize=14" rel="noopener ugc nofollow" target="_blank">源代码</a></p><p id="877d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在2019年，几乎没有理由在投入之前给出<a class="ae kb" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue.js </a>背景故事；它的<a class="ae kb" href="https://trends.builtwith.com/javascript/Vue" rel="noopener ugc nofollow" target="_blank">空前的受欢迎程度</a>已经让它在网络开发者中成为一个“家喻户晓”的名字，这不无道理。Vue在帮助创建网络应用方面做了很多伟大的事情，但它最出名的可能不是“核心”技术本身，而是它创造的<a class="ae kb" href="https://2018.stateofjs.com/front-end-frameworks/overview/overview" rel="noopener ugc nofollow" target="_blank">开发者体验</a>。</p><p id="533f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">易读性和易访问性是开发人员体验关键部分。由于Vue语法和模块化结构，能够更快地阅读和理解代码，这使得工作更容易理解，并减少了挫折感。由于这种优势，Vue是与丰富/复杂库结合的理想框架。利用Vue的易读性和模块化，人们可以通过将它分解成更小的、可重用的片段，并用惯用的Vue风格包装固执己见的语法，来简化这样一个库的接口。</p><p id="3b3e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在我们例子中，最丰富的库是<a class="ae kb" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3 </a>。D3是近年来最重要的JavaScript数据可视化库之一，在创建者Mike Bostock的带领下，开发仍然很强劲。D3与许多其他库的不同之处在于无限定制的能力。它的低级API提供了对原生SVG元素的直接控制，但也带来了高学习曲线的代价。由于这种范式，我们将把D3和Vue结合在一起——使用Vue的动态数据绑定、清晰的语法和模块化结构来发挥D3的最佳性能。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kh"><img src="../Images/3946a6484be532ef2e54f9061913b0bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*GJR5a7cVUjMocWmuHd_8Yg.gif"/></div><figcaption class="kp kq et er es kr ks bd b be z dx">The animated bar chart we’re going to build</figcaption></figure><h1 id="f6bd" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">该项目</h1><p id="19fe" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将使用D3和Vue构建一个<a class="ae kb" href="https://okz1r.codesandbox.io/" rel="noopener ugc nofollow" target="_blank">基本条形图组件</a>。有大量<a class="ae kb" href="https://bl.ocks.org/caravinden/d04238c4c9770020ff6867ee92c7dac1" rel="noopener ugc nofollow" target="_blank">优秀的指南</a>可以帮助我们在普通D3中做到这一点，但是我们将会把重点放在尝试编写惯用Vue而不是惯用D3上。该项目的完整代码可以在CodeSandbox 上找到<a class="ae kb" href="https://codesandbox.io/s/d3-bar-chart-vuejs-okz1r?fontsize=14" rel="noopener ugc nofollow" target="_blank">，并且将在指南的其余部分被引用。</a></p><h2 id="ce54" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">建立</h2><p id="4795" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，我们需要安装项目的依赖项。我们可以通过<code class="du lh li lj lk b">npm i d3</code>简单地安装和使用所有的D3，但是这会降低我们没有使用的所有模块的应用程序的速度，尤其是更重的<code class="du lh li lj lk b">d3-geo</code>模块。相反，我们将只安装我们需要的D3模块。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ll"><img src="../Images/2fdc58e2f0e928cb10ac35eaf28f7d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJ9rHUsGjx4s_DObu8P4Ow.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The dependencies to install in your project</figcaption></figure><p id="bf75" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">下一步将是创建我们的<code class="du lh li lj lk b">BarChart.vue</code>文件，并提供我们的<code class="du lh li lj lk b">App.vue</code>或其他父组件来呈现条形图。在本指南中，为了方便起见，数据将被定义在父<code class="du lh li lj lk b">App.vue</code>文件中，但是在其他应用中，您可能希望通过<a class="ae kb" href="https://vuex.vuejs.org/guide/" rel="noopener ugc nofollow" target="_blank"> Vuex </a>来处理获取/设置数据，尤其是当您从文件或其他外部来源加载数据时。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es lq"><img src="../Images/0a3ac12935bc9123f2123e2d51f3a2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*D2gXFda-eyfS5AgTAA0QFA.png"/></div><figcaption class="kp kq et er es kr ks bd b be z dx">Project File Structure</figcaption></figure><h2 id="49b9" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">应用程序组件</h2><p id="af9a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们还将先发制人地将一些<a class="ae kb" href="https://vuejs.org/v2/guide/components-props.html" rel="noopener ugc nofollow" target="_blank">道具</a>传递给我们的条形图组件。第一个支柱是数据数组本身，但是另外两个支柱是我们如何在D3中定义数据模型。我们不是每次处理不同的数据集时都要写一个一次性的图表，而是通过传入我们希望D3处理的数据数组中的属性名称来保持事物的可重用性。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lr"><img src="../Images/5735f96f50ba793a3362392e53bfa708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*knJyqpVS2TN06FFeo6NDOg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">The App.vue file hosting our bar chart component</figcaption></figure><h2 id="3a2c" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">条形图组件定义</h2><p id="653a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">创建条形图组件从导入D3模块开始，并定义我们在<code class="du lh li lj lk b">App.vue</code>组件中传递的属性。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ls"><img src="../Images/ff089d859eff5578fa5adb2b8dc50faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxyEMqYD30rjj3DLjpeZNQ.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Defining the bar chart component</figcaption></figure><p id="4c60" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">之后，我们搭建Vue模板来接收SVG元素。注意，我们添加了单独的<code class="du lh li lj lk b">&lt;svg&gt;</code> <code class="du lh li lj lk b">&lt;g&gt;</code>和<code class="du lh li lj lk b">&lt;rect&gt;</code>元素，而不是我们熟悉的<a class="ae kb" href="https://alignedleft.com/tutorials/d3/chaining-methods" rel="noopener ugc nofollow" target="_blank"> D3函数链</a>。这将允许我们动态地将这些元素绑定到Vue组件中的数据，并利用Vue的反应能力。这里要强调的另一个元素是，我们将动态计算<code class="du lh li lj lk b">&lt;svg&gt;</code>元素的宽度和高度属性——这样做是为了在所有可能的屏幕尺寸上保持内容清晰，并消除屏幕渲染。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lt"><img src="../Images/4901a744bc395be78d966ce70a420122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FxXjjC-XtF-jCfjWzcxWA.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Template scaffold</figcaption></figure><h2 id="ba57" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">受关注的属性</h2><p id="9e8e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们在这里将只使用一个被监视的属性，那将用于我们计算的宽度。通常我们会使用computed属性来处理类似的事情，但是我们需要在元素呈现之后从DOM中提取信息，而computed属性在尝试这样做时会抛出错误。对于该属性，我们将获得条形图父级<code class="du lh li lj lk b">&lt;div&gt;</code>的宽度，并将宽度设置为该尺寸的3/4，以在边缘周围提供一些缓冲。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lu"><img src="../Images/19f074f538227af091d6a82c60b2adf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTiqSBfzMLrg70EALvjdIg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Reactive width property</figcaption></figure><h2 id="bf47" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">计算属性</h2><p id="878c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这些属性将是我们组件中最大的部分之一。在这里，我们可以将D3逻辑分解成更容易理解的部分，并在实时发生变化时更新/消耗它。属性的基本功能在下面的代码中进行了注释，但是为了更深入地理解D3功能的作用，请深入参考<a class="ae kb" href="https://github.com/d3/d3/wiki" rel="noopener ugc nofollow" target="_blank"> D3源文档</a>或<a class="ae kb" href="https://www.d3indepth.com/" rel="noopener ugc nofollow" target="_blank">D3</a>。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lu"><img src="../Images/4d700379a97f0d7ec7f0a68154dcadca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*innLVC8EPEADo9NvVZDUBA.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Computed properties</figcaption></figure><h2 id="8740" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">创建酒吧</h2><p id="304d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们已经有了缩放函数和其他计算属性，我们可以开始在模板中添加条形了。我们将通过一个<code class="du lh li lj lk b">v-for</code>指令来实现这一点——遍历数据项数组，并将它们的属性动态分配给DOM中的<code class="du lh li lj lk b">&lt;rect&gt;</code>元素。注意，我们是通过之前传入的<code class="du lh li lj lk b">xKey</code>和<code class="du lh li lj lk b">yKey</code>道具来访问单个物品的。这将允许我们重用相同的组件，而不管下一个项目的数据集是否包含关键字“name”和“amount”。</p><p id="d62a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这里要注意的另一个关键点是，这些条还不会呈现(<code class="du lh li lj lk b">redrawToggle</code>)，当它们呈现时也不会有高度和y位置(<code class="du lh li lj lk b">y</code>和<code class="du lh li lj lk b">height</code>)。我们这样做是因为我们想要动画化图表，这需要在初始渲染后用D3转换添加这些属性。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lv"><img src="../Images/17190f49cfabe65823011931e7aaf0a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*utfo-mr2nrt2BmMisyS-tg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Creating the bars</figcaption></figure><h2 id="6764" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">制作图表动画</h2><p id="b07b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了使图表生动，我们将创建一些方法来包装和模块化我们的转换逻辑。绘制动画包括将正确的<code class="du lh li lj lk b">height</code>和<code class="du lh li lj lk b">y</code>值分配给已经延迟呈现在页面上的<code class="du lh li lj lk b">&lt;rect&gt;</code>元素——创建从x轴“增长”的条形效果。</p><p id="a140" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在<code class="du lh li lj lk b">mounted</code>钩子中，我们将为触发绘制动画的窗口调整事件添加一个监听器，并将<code class="du lh li lj lk b">&lt;svg&gt;</code>大小设置为相对于新的屏幕/窗口尺寸。我们不会立即触发它，而是等待300毫秒，以更加“确定”用户已经完成了调整窗口大小。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lv"><img src="../Images/a02addf1b4c8413f59b7b2a0f3df981a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WVQv0DWUlLCJpKx4TDw-5A.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Implementing the animation methods and dynamic resizing</figcaption></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lw"><img src="../Images/562ea221701edba22ef61f3fc9d892e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IV41wqVpQWNkaTD2PveREg.png"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Methods for animating the drawing of the chart, and redrawing on window resize</figcaption></figure><h2 id="8e97" class="kt ig hi bd ih ku kv kw il kx ky kz ip jo la lb it js lc ld ix jw le lf jb lg bi translated">式样</h2><p id="9633" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">样式完全由您决定，通过Vue的作用域样式语法和D3的低级API，您可以随心所欲地定制内容。您还可以将CSS动画与D3过渡和Vue过渡/动画混合使用，以获得更加动态/反应式的效果。对于这个项目，唯一真正的样式集中在<code class="du lh li lj lk b">&lt;div&gt;</code>元素上，它决定了里面<code class="du lh li lj lk b">&lt;svg&gt;</code>的大小和位置。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lx"><img src="../Images/31b9fff4ae6a66bab0d224c36fd717a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbWb69vguunKa3K53qTxfA.png"/></div></div></figure><h1 id="9246" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">摘要</h1><p id="7ec2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Vue允许我们以一种干净和可重用的方式组织和构建我们的组件。它还创建了一个更易读的代码库，特别是对于初学者或任何不太熟悉D3的API或数据处理工作流的开发人员。适应Vue + D3风格需要一些练习，尤其是大多数在线示例都是传统的D3语法，但是这对耐心的编码人员来说是有好处的。一个动态的、可重用的数据可视化是一件非常强大的事情——它可以在一个数据驱动的世界中产生很大的影响。</p><p id="e649" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kb" href="https://codesandbox.io/s/d3-bar-chart-vuejs-okz1r?fontsize=14" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div></div>    
</body>
</html>