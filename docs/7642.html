<html>
<head>
<title>Why should I write good commit messages?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我应该编写好的提交消息？</h1>
<blockquote>原文：<a href="https://medium.com/swlh/why-should-i-write-good-commit-messages-e15d37bf45cb?source=collection_archive---------10-----------------------#2019-07-05">https://medium.com/swlh/why-should-i-write-good-commit-messages-e15d37bf45cb?source=collection_archive---------10-----------------------#2019-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2e942b7e99639033af4668e7cd257897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RRAWy_etG4K1H-DSZ2W1fQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx"><a class="ae iu" href="https://xkcd.com/1296/" rel="noopener ugc nofollow" target="_blank">https://xkcd.com/1296/</a></figcaption></figure><p id="1654" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为一名应届毕业生，为一个被数百万用户使用的产品编写代码的前景让我兴奋不已。我迫不及待地发送我的第一次公关，并得到它合并。我一点也不知道，我收到的第一条评论不是关于我的代码，而是关于我的提交消息，以及它们需要如何改进。</p><p id="e235" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">年轻的我想，“为什么这很重要？谁在乎消息？重要的是代码。”两年后，在参与了多个项目、审阅了无数的pr和查看了过多的公共软件包后，我意识到我是多么的错误。在本文中，我将描述各种场景，这些场景让我体会到编写好的提交消息的重要性。</p><p id="6065" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有很多好文章和博客(<a class="ae iu" href="https://chris.beams.io/posts/git-commit/" rel="noopener ugc nofollow" target="_blank">在这里</a>)都是关于如何写提交消息，并列出该做和不该做的事情。在这里，我的重点是<strong class="ix jt">为什么</strong>你应该这样做。</p><h1 id="88cf" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated"><strong class="ak"> 1。生产问题</strong></h1><blockquote class="ks kt ku"><p id="cd13" class="iv iw kv ix b iy iz ja jb jc jd je jf kw jh ji jj kx jl jm jn ky jp jq jr js hb bi translated">老软件工程师汤姆</p></blockquote><p id="73da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="kv">星期六，凌晨2点31分——电话铃响了。</em></p><p id="6f95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">汤姆接了电话，发现付费用户无法登录，什么也做不了。一股寒气涌上他的脊梁。在他内心深处，他知道他不应该在星期五部署。然而，他做到了，就在那里。</p><p id="f492" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他打开笔记本电脑，检查服务器警报— <em class="kv">服务器错误增多</em>。为了找出造成这种情况的原因，他打开了服务器错误日志并找到了答案</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="3b81" class="li jv hi le b fi lj lk l ll lm"><strong class="le jt">TypeError</strong>: Cannot read property “id” of undefined</span><span id="21d1" class="li jv hi le b fi ln lk l ll lm"><strong class="le jt">25:13</strong> /api/controllers/LoginController.js<br/><strong class="le jt">192:17</strong> …</span></pre><p id="9162" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“啊哈！”他大声说道。他释放了他选择的武器——git。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="1f44" class="li jv hi le b fi lj lk l ll lm">$ git blame api/controllers/LoginController.js</span></pre><p id="94e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是了</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="a770" class="li jv hi le b fi lj lk l ll lm">...<br/><strong class="le jt">f4f78b31</strong> 25) if (user.team.id &gt; 1)<br/><strong class="le jt">f4f78b31 </strong>26)     return teamLogin();<br/><strong class="le jt">f4f78b31 </strong>26) else<br/><strong class="le jt">f4f78b31 </strong>27)     return userLogin();<br/>...</span></pre><p id="1f9d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">窃听器就在那里。对属性<code class="du lo lp lq le b">id</code>的不安全访问。如果用户不属于某个团队，该怎么办？<code class="du lo lp lq le b">team</code>属性将不存在。因此所有非团队用户都不能登录。</p><p id="4c45" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要解决这个问题，只需用<code class="du lo lp lq le b">user.team &amp;&amp; user.team.id</code>替换<em class="kv">线25 </em>。轻松点。对吗？</p><p id="e64f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">没那么快。ID为1的团队呢？为什么团队登录和用户登录不一样？为什么要做出这样的改变？团队ID <code class="du lo lp lq le b">0</code>可能吗？为了更好地理解这个问题，汤姆决定进一步挖掘。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="80e7" class="li jv hi le b fi lj lk l ll lm">$ git show <strong class="le jt">f4f78b31</strong></span><span id="876d" class="li jv hi le b fi ln lk l ll lm">commit f4f78b319c308600eab015a5d6529add21660dc1<br/>Author: Jerry<br/>Date: Fri Mar 13 10:12:29 2019 +0330</span><span id="d02d" class="li jv hi le b fi ln lk l ll lm"><strong class="le jt">   update login flow         </strong>&lt;- 😩😩😩😩</span><span id="9a83" class="li jv hi le b fi ln lk l ll lm">...</span></pre><p id="5748" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">问题就在这里——提交消息含糊不清，除了实际的代码差异之外，它没有告诉Tom更多的信息。他已经知道登录流被更新了。他正在寻找更多信息来<em class="kv">帮助他理解</em>代码变更。更好的提交消息可能是:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="af0a" class="li jv hi le b fi lj lk l ll lm">Create a new login page for team users</span><span id="60fa" class="li jv hi le b fi ln lk l ll lm">We want to capture team names in the login flow for paid users. This commit shows the new login page for users with a valid team ID.</span></pre><p id="28e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个提交消息传达了更多关于<em class="kv">为什么</em>做出改变的信息？汤姆也知道这个变化是针对谁的。这一点，结合行内评论，将有助于他做出更明智的决定。</p><h1 id="6ae9" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">2.了解原因</h1><blockquote class="ks kt ku"><p id="bdee" class="iv iw kv ix b iy iz ja jb jc jd je jf kw jh ji jj kx jl jm jn ky jp jq jr js hb bi translated">卡尔文，实习生</p></blockquote><p id="4f5b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">星期一，上午8点36分</p><p id="00e5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Calvin被分配了一个类似aps的项目的入门问题。他的任务是为杂货店添加一个配置。他要利用这个机会熟悉代码库。</p><p id="2d7f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他从<code class="du lo lp lq le b">README.md</code>和<code class="du lo lp lq le b">IMPLEMENTATION.md</code>文件开始了解项目概况。挖了一会儿后，他发现这些变化是在<code class="du lo lp lq le b">config/maps/elements.js</code>对我做的。他必须为键<code class="du lo lp lq le b">grocery-store</code>添加一个JSON配置。有趣的是，他看到了这段代码</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="2d0c" class="li jv hi le b fi lj lk l ll lm">if (type === 'hospital' || type === 'pharmacy') {<br/>    config = getConfigFromAPI();<br/>}</span></pre><p id="eeb7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“为什么对医院和药店有特殊处理？我需要为杂货店增加特殊处理吗？”，他认为。他查看提交消息。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="d67c" class="li jv hi le b fi lj lk l ll lm">commit f4f78b319c308600eab015a5d6529add21660dc1<br/>Author: Hobbes<br/>Date: Fri Mar 11 10:10:21 2018 +0530</span><span id="6972" class="li jv hi le b fi ln lk l ll lm"><strong class="le jt">add safe checks in element config    </strong>&lt;- 🤔</span><span id="b259" class="li jv hi le b fi ln lk l ll lm">...</span></pre><p id="a069" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然这个消息告诉你这个条件是安全的，但是它仍然没有给你完整的描述。像上一节一样，它没有告诉你<em class="kv">为什么</em>做出了改变。更好的提交消息可能是</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="3cbc" class="li jv hi le b fi lj lk l ll lm">fetch map element config from API for emergency buildings to avoid stale information</span></pre><p id="6e6a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这清楚地传达了代码更改的目的，并为读者做出决定提供了足够的信息。卡尔文可以推断出，特殊处理只适用于紧急建筑，杂货店不需要。</p><p id="3863" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，一个好的提交消息可以帮助一个新开发人员理解部分代码库，而不需要任何人的帮助。在这方面，提交消息是代码文档的第二个字符串。</p><h1 id="758d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">3.审查代码</h1><blockquote class="ks kt ku"><p id="5a6e" class="iv iw kv ix b iy iz ja jb jc jd je jf kw jh ji jj kx jl jm jn ky jp jq jr js hb bi translated">威尔玛，项目负责人</p></blockquote><p id="cc9c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="kv">星期五，下午3点04分</em></p><p id="e697" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Fred要求Wilma对团队管理视图中的重大变更进行代码审查。威尔玛拉动机器上的分支，测试这些变化——它们似乎在工作。她首先检查分支(<code class="du lo lp lq le b">feature/admin-updates</code>)和<code class="du lo lp lq le b">develop</code>(目的地)之间的差异统计。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="0d4b" class="li jv hi le b fi lj lk l ll lm">$ git diff feature/admin-updates develop --stats</span><span id="6387" class="li jv hi le b fi ln lk l ll lm">...</span><span id="de38" class="li jv hi le b fi ln lk l ll lm"><strong class="le jt">45 files changed, 4085 insertions(+), 590 deletions(-)  </strong>&lt;-<strong class="le jt"> 😱</strong></span></pre><p id="3ecb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">差异显示了许多代码变化，包括一堆新的后端API、实用程序、数据流变化和UI变化。她查看提交日志，以确定所有这些更改是否组织得当。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="741a" class="li jv hi le b fi lj lk l ll lm">$ git log --oneline develop..feature/admin-updates</span><span id="8b14" class="li jv hi le b fi ln lk l ll lm">commit f4f78b319c308600eab015a5d6529add21660dc1<br/>Author: Fred<br/>Date: Fri Jun 11 2018 12:35:23 +0000</span><span id="22ec" class="li jv hi le b fi ln lk l ll lm">admin view updates                     &lt;- 😑😑😑</span></pre><p id="d84d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">威尔玛留下以下评论:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="48d3" class="li jv hi le b fi lj lk l ll lm">The changes you made seem to be working fine based on a cursory test. However, there are way too many code changes (~4000 lines) in a single commit. This makes it very difficult to review. It might also cause certain issues to be overlooked just by the sheer size of it.</span><span id="f1f3" class="li jv hi le b fi ln lk l ll lm">You can (and should) split your code into logically independent commits. Example -</span><span id="c3f3" class="li jv hi le b fi ln lk l ll lm">- add API endpoints and tests for billing changes in admin view<br/>- add utilities to validate billing roles for a user<br/>- separate billing and team management sections in team settings<br/>- update UI in team settings view to be design system 3.2 compliant</span></pre><p id="8a1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，重点是将一个大的变更分解成更小的块，由适当的提交消息标识。这允许更有效的代码审查，并减少忽略错误的机会。</p><p id="5cb3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过向较小的提交提供适当的信息，您向评审者传达了您对解决方案的心理模型。这减少了摩擦，并确保开发人员和评审人员在同一页上。</p><h1 id="97d2" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">4.变更日志</h1><blockquote class="ks kt ku"><p id="0d36" class="iv iw kv ix b iy iz ja jb jc jd je jf kw jh ji jj kx jl jm jn ky jp jq jr js hb bi translated">达芙妮，工程经理</p></blockquote><p id="450d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">昨天发布了一个错误修复版本(<code class="du lo lp lq le b">4.1.1</code>)。Daphne想知道修复了哪些bug，做了哪些计划外的代码更改。她拉出最新的<code class="du lo lp lq le b">master</code>并运行以下命令</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="d664" class="li jv hi le b fi lj lk l ll lm">$ git log --oneline v4.1.0..v4.1.1</span><span id="f09f" class="li jv hi le b fi ln lk l ll lm"><strong class="le jt">c1c29526 </strong>Upgrade version to v4.1.1<br/><strong class="le jt">e7f05736 </strong>Fix issue #342               &lt;- #342 of which project?<br/><strong class="le jt">e8ad9e21 </strong>address comments             &lt;- What comments?<br/><strong class="le jt">e3d84047 </strong>fix lint tests               &lt;- Where? What for?<br/><strong class="le jt">fc6b65de </strong>login button bugfix          &lt;- What was the bug?</span></pre><p id="bac6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些提交消息几乎没有传达版本中的内容。它们表示登录错误已修复，问题#342已解决。但是这些问题是什么，又是如何解决的呢？</p><p id="803e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还有，也有像<code class="du lo lp lq le b">address comments</code>和<code class="du lo lp lq le b">fix lint tests</code>这样的流浪犯。这些提交不是独立的，并且不提供任何附加值。相反，它们应该被它们正在修改的提交压扁。</p><p id="af1f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面显示了详细提交消息的一个变体，这将有助于Daphne更好地理解版本中的更改</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="e09e" class="li jv hi le b fi lj lk l ll lm"><strong class="le jt">e1b29221 </strong>Upgrade version to v4.1.1<strong class="le jt"><br/>e8ad9e33 </strong>[GH-342] Fixed issue where header image was not visible in Safari and Internet Explorer<br/><strong class="le jt">ac6b15ae </strong>Fixed an issue where login button was disabled for users on the enterprise plan<br/>   - added e2e tests for this flow<br/>   - added analytics events for login failure</span></pre><p id="bc6b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些消息清楚地解释了这些变化，也去掉了不必要的消息。任何经历过这一过程的人都可以很容易地了解特定版本中的变化。这在开发公共包时非常方便——您的消费者确切地知道发生了什么变化。</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><p id="5f36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着时间的推移，我开始将提交消息视为与我的代码相关联的小便笺，它为读者提供了非常需要的上下文。下一次他们看到我的代码并尖叫“为什么？”，不敢相信，希望我的commit消息能安抚他们。</p></div></div>    
</body>
</html>