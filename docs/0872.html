<html>
<head>
<title>Encrypting column of a spark dataframe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加密火花数据帧的列</h1>
<blockquote>原文：<a href="https://medium.com/swlh/encrypting-column-of-a-spark-dataframe-35d64b0db00f?source=collection_archive---------0-----------------------#2019-02-09">https://medium.com/swlh/encrypting-column-of-a-spark-dataframe-35d64b0db00f?source=collection_archive---------0-----------------------#2019-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6a8c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Pyspark和哈希算法</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/45464188939dfa675cc66c6742fdfdf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6KoKzPizZQ3CRNa4"/></div></div></figure><p id="a2ce" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">加密数据意味着将数据转换为密码，这可能很难破解，而且它允许您安全地保护您不想让任何人访问的数据。</p><p id="26cd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在这篇博客中，我将告诉你如何使用安全散列算法加密一个数据，比如一个手机号码，它是个人数据。</p><p id="3d45" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">假设您有一个. csv文件中的数据。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kf"><img src="../Images/44d40ec1c2a2e18797e31c90f128fd6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*mEGPwpZr18aK9lw_Cb3S5w.jpeg"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">sample.csv</figcaption></figure><blockquote class="kk kl km"><p id="b62d" class="jj jk kn jl b jm jn ij jo jp jq im jr ko jt ju jv kp jx jy jz kq kb kc kd ke hb bi translated">第一步。从csv文件的内容创建一个数据帧。我更喜欢pyspark，你可以用Scala来实现同样的功能。</p></blockquote><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="1900" class="kw kx hi ks b fi ky kz l la lb">from pyspark import SparkConf, SparkContext, SQLContext</span></pre><p id="1a13" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我已经在eclipse-IDE中开发了代码。如果您使用的是shell spark，那么上下文已经作为sc提供了。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="3ec1" class="kw kx hi ks b fi ky kz l la lb">conf = \</span><span id="c99a" class="kw kx hi ks b fi lc kz l la lb">SparkConf().setMaster('local').setAppName('column_encryption')</span><span id="463e" class="kw kx hi ks b fi lc kz l la lb">sc = SparkContext(conf=conf)</span><span id="86ac" class="kw kx hi ks b fi lc kz l la lb">sqlcontext = SQLContext(sc)</span></pre><p id="2677" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">传递给哈希逻辑的字符串格式必须作为bytestring传递，如果不是，我们需要使用。encode()方法将其转换为字节字符串格式。对于csv的默认模式，mobno将被视为整数，对于整数，我们不能使用encode()，因此将mobno的数据类型更改为string，并根据新模式创建dataframe。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="7558" class="kw kx hi ks b fi ky kz l la lb">from pyspark.sql.types import StringType, IntegerType, StructType, StructField</span><span id="dfff" class="kw kx hi ks b fi lc kz l la lb">schema1 = StructType([</span><span id="7d95" class="kw kx hi ks b fi lc kz l la lb">StructField("cust_id", IntegerType(), True),</span><span id="5f7e" class="kw kx hi ks b fi lc kz l la lb">StructField("mobno", StringType(), True),</span><span id="4f70" class="kw kx hi ks b fi lc kz l la lb">])</span><span id="e060" class="kw kx hi ks b fi lc kz l la lb">data = sqlcontext.read.csv('sample.csv', header=True, schema=schema1)</span></pre><blockquote class="kk kl km"><p id="88bb" class="jj jk kn jl b jm jn ij jo jp jq im jr ko jt ju jv kp jx jy jz kq kb kc kd ke hb bi translated">第二步。写一个函数来定义你的加密算法</p></blockquote><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="cb60" class="kw kx hi ks b fi ky kz l la lb">import hashlib</span><span id="ed60" class="kw kx hi ks b fi lc kz l la lb">def encrypt_value(mobno):</span><span id="7168" class="kw kx hi ks b fi lc kz l la lb">sha_value = hashlib.sha256(mobno.encode()).hexdigest()</span><span id="43a9" class="kw kx hi ks b fi lc kz l la lb">return sha_value</span></pre><p id="88d6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">第三步。创建一个UDF，传递定义的函数，并调用UDF，将待加密的列作为参数传递。</p><pre class="iy iz ja jb fd kr ks kt ku aw kv bi"><span id="6acc" class="kw kx hi ks b fi ky kz l la lb">from pyspark.sql.functions import udf</span><span id="ceb6" class="kw kx hi ks b fi lc kz l la lb">spark_udf = udf(encrypt_value, StringType())</span><span id="97ad" class="kw kx hi ks b fi lc kz l la lb">data = data.withColumn('encrypted_value',spark_udf('mobno'))</span><span id="7403" class="kw kx hi ks b fi lc kz l la lb">data.show(truncate=False)</span></pre><p id="6ecd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated"><em class="kn"> withColumn() </em>将向数据帧添加额外的列。如果需要，可以使用drop()删除列<em class="kn"> mobno </em>。</p><p id="34c9" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">嘿！您得到了预期的输出。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ld"><img src="../Images/304872d1c5224e60c6403927c983e536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*43GsNRunmSCBsdKsUWdiwg.png"/></div><figcaption class="kg kh et er es ki kj bd b be z dx">output</figcaption></figure><p id="7298" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">请随意写下你的建议。谢谢！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es le"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="kw kx hi bd lf lg lh li lj lk ll lm ln js lo lp lq jw lr ls lt ka lu lv lw lx bi translated">这篇文章发表在<a class="ae ly" href="https://medium.com/swlh" rel="noopener">《创业</a>》上，这是Medium最大的创业刊物，有+421，678人关注。</h2><h2 id="869c" class="kw kx hi bd lf lg lh li lj lk ll lm ln js lo lp lq jw lr ls lt ka lu lv lw lx bi translated">在这里订阅接收<a class="ae ly" href="https://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es le"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>