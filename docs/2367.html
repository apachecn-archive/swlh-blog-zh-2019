<html>
<head>
<title>Building SPA using React and Contentful</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和Contentful构建SPA</h1>
<blockquote>原文：<a href="https://medium.com/swlh/building-spa-using-react-js-and-contentful-ea3596cbdfba?source=collection_archive---------2-----------------------#2019-04-17">https://medium.com/swlh/building-spa-using-react-js-and-contentful-ea3596cbdfba?source=collection_archive---------2-----------------------#2019-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/412676052fca7cb955b0602811575ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UaopJyj9sTxuKGk0TjjocQ.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">SPA with React &amp; Contentful</figcaption></figure><div class=""/><p id="7eca" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">各位同事好。我关于网络编程的博客从今天开始。我希望这将是有用的和翔实的给你。那么，我们开始吧。</p><p id="06ba" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现代服务是如何处理内容的。对我这个开发者来说，Contentful是单页面应用程序的最佳CMS解决方案。我想告诉大家内容基础设施是如何提升传统内容管理系统的限制的，以及为什么你应该在你的项目中与<strong class="iw js"> React </strong>一起使用它。</p><h2 id="c060" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">知足常乐的主旨</h2><p id="2951" class="pw-post-body-paragraph iu iv hx iw b ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ks jp jq jr hb bi translated">Contentful是CMS解决方案，它使我们能够避免使用SQL数据库，连接到一个网站和托管在一些可怕的服务器上。它的管理仪表板是用户友好的，伟大的API比其他CMS解决方案如Wordpress要快得多。</p><p id="bef0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们的目标是将应用程序内容分成不同的模型，然后基于这些模型创建内容。在Contentful客户端的帮助下，我们可以获取JSON格式的内容，然后将其呈现为<strong class="iw js">反应。组件</strong>。所以不要浪费时间，让我们练习吧！</p><h2 id="925d" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">令人满意的仪表板</h2><p id="2177" class="pw-post-body-paragraph iu iv hx iw b ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ks jp jq jr hb bi translated">首先你应该在<a class="ae kt" href="https://app.contentful.com" rel="noopener ugc nofollow" target="_blank"> <em class="ku">创建账户</em> </a> <em class="ku">。</em>一开始就有一个测试项目给你。但是我们将创建我们自己的内容模型。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kv"><img src="../Images/8f0a4fcec0032c20b708098b74516811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QaTFXUAKYDLVOx7B1Q6G8w.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Content Model <strong class="bd la">Article</strong></figcaption></figure><p id="71f3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上图中，我创建了一个新的内容模型<strong class="iw js"> Article </strong>和字段类型<em class="ku">短文本</em>、<em class="ku">富文本</em>、文本和<em class="ku">媒体。</em></p><p id="e2cf" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">目前，Contentful支持以下类型的字段:</p><ul class=""><li id="7d58" class="lb lc hx iw b ix iy jb jc jf ld jj le jn lf jr lg lh li lj bi translated"><strong class="iw js">短文本</strong> —最多255个字符。将其用于标题、姓名、标签、URL和电子邮件地址</li><li id="33c6" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">富文本</strong> —最多50k个字符。用于描述、文本段落、文章。它可以用标记编辑。例如，您可以使用粗体或斜体字体</li><li id="052f" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">数字</strong> —整数或小数</li><li id="98ba" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">日期</strong> —具有不同时间格式(仅日期，带时区或不带时区)和时间模式(AP/PM，24小时制)的日期字段</li><li id="c40b" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">位置</strong> —位置坐标</li><li id="e7e1" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">媒体</strong> —支持几乎所有类型文件(图像、视频、PDF、docx、代码、档案等)的领域。)</li><li id="3f23" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">布尔型</strong>——由真/假值及其标签组成</li><li id="94dc" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js"> JSON对象</strong>—JSON格式的任何数据</li><li id="2b7d" class="lb lc hx iw b ix lk jb ll jf lm jj ln jn lo jr lg lh li lj bi translated"><strong class="iw js">引用</strong> —链接到另一个内容模型</li></ul><p id="3548" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些字段涵盖了SPA中开发人员的需求。模型完成后，我们得到了一个JSON格式的预览，它将由Contentful客户端获取。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/3be5cbe33a4d89b92440b7d4d92eecc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovYL5Wjyl3_WpIWbq2kP5A.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Article model JSON view</figcaption></figure><p id="9c28" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一步是从Contentful获取数据。对于这个任务，我们应该安装<a class="ae kt" href="https://www.npmjs.com/package/contentful" rel="noopener ugc nofollow" target="_blank"> <em class="ku">内容丰富的客户端</em> </a> <em class="ku"> </em>。</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="50a1" class="jt ju hx lr b fi lv lw l lx ly">npm install --save contentful</span></pre><p id="5623" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一步是使用设置中的<em class="ku">访问令牌</em>和<em class="ku">空间id </em>初始化客户端。</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="cadd" class="jt ju hx lr b fi lv lw l lx ly">// Contentful Client example</span><span id="f9b3" class="jt ju hx lr b fi lz lw l lx ly">import { createClient } <strong class="lr js">from </strong>"contentful";</span><span id="12ac" class="jt ju hx lr b fi lz lw l lx ly">export default class ContentfulClient {<br/>  getClient = async () =&gt; {<br/>    const client = await createClient({<br/>    space: CONTENTFUL_SPACE,<br/>    accessToken: CONTENTFUL_TOKEN,<br/>  });<br/>  return client;<br/>};</span></pre><p id="0dc6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些数据是私有的，所以我不建议用代码来存储它(例如你可以使用<em class="ku">)。env </em>文件)。Contentful提供了令人敬畏的<a class="ae kt" href="https://www.contentful.com/developers/docs/references/content-delivery-api/#/introduction" rel="noopener ugc nofollow" target="_blank"> <em class="ku">交付API </em> </a> <em class="ku"> </em>，但是在示例项目中，我将通过内容id获取数据。您可以直接在这些内容的页面中的<strong class="iw js">信息部分找到内容id。</strong></p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="0f6c" class="jt ju hx lr b fi lv lw l lx ly">// Add method to ContentfulClient class<br/>// getEntry method fetches data by content Id</span><span id="798f" class="jt ju hx lr b fi lz lw l lx ly">getEntry = async id =&gt; {<br/>  const client = await this.getClient();<br/>  const entry = await client.getEntry(id, { include: 10 });<br/>  return entry;<br/>};</span></pre><p id="f626" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们已经准备好为我们的应用程序获取内容丰富的数据，但在此之前，我们需要根据<strong class="iw js">文章</strong>内容模型创建新的内容。</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/26e01990663c2a430d0faec9a21db510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ENh-SgeHybR57nQhARYp3Q.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx">Content based on <strong class="bd la">Article</strong> model.</figcaption></figure><p id="cb72" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该内容的一大优点是，我们可以在这里存储所有媒体文件。只需转到标签<strong class="iw js">媒体</strong>并上传您的文件。</p><p id="d61b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们收到了API的回复。太酷了。但是我们对于富文本字段有一个问题:</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="c141" class="jt ju hx lr b fi lv lw l lx ly">"body": {<br/>  "data": {},<br/>  "content": [<br/>    {<br/>       "data": {},<br/>       "content": [<br/>         {<br/>           "data": {},<br/>           "marks": [],<br/>           "value": "This content is using ",<br/>           "nodeType": "text"<br/>         },<br/>         {<br/>           "data": {},<br/>           "marks": [<br/>             {<br/>               "type": "bold"<br/>             }<br/>          ],<br/>            "value": "Article",<br/>            "nodeType": "text"<br/>          },<br/>          {<br/>            "data": {},<br/>            "marks": [],<br/>            "value": " Content model.",<br/>            "nodeType": "text"<br/>           }<br/>         ],<br/>         "nodeType": "paragraph"<br/>       },<br/>       {<br/>         "data": {},<br/>         "content": [<br/>       {<br/>         "data": {},<br/>         "content": [<br/>           {<br/>             "data": {},<br/>             "marks": [],<br/>             "value": "I was working ...",<br/>             "nodeType": "text"<br/>           }<br/>         ],<br/>           "nodeType": "paragraph"<br/>       },<br/>       {<br/>         "data": {},<br/>         "content": [<br/>           {<br/>             "data": {},<br/>             "marks": [],<br/>             "value": "Sascha KonietzkeCo-Founder &amp; CEO",<br/>             "nodeType": "text"<br/>           }<br/>         ],<br/>         "nodeType": "paragraph"<br/>       }<br/>     ],<br/>    "nodeType": "blockquote"<br/>   },<br/>   {<br/>     "data": {},<br/>     "content": [<br/>   {<br/>     "data": {},<br/>     "marks": [],<br/>     "value": "",<br/>     "nodeType": "text"<br/>   }<br/> ],<br/> "nodeType": "paragraph"<br/>  }<br/> ],<br/>  "nodeType": "document"<br/>}</span></pre><p id="0b31" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我看到的第一个问题是:“<em class="ku">嗯，有什么机会可以渲染这个…？”。</em>而我们这里有一个解决方案<a class="ae kt" href="https://www.google.com/search?q=%40contentful%2Frich-text-react-renderer&amp;oq=%40contentful%2Frich-text-react-renderer&amp;aqs=chrome..69i57j69i58.404j0j7&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank"><em class="ku"/></a><em class="ku">。</em><strong class="iw js">Rich-text-react-renderer</strong>是Contentful developers开发的一个库，用于将富文本字段渲染到React组件中。</p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="b11a" class="jt ju hx lr b fi lv lw l lx ly">npm install --save @contentful/rich-text-react-renderer</span></pre><p id="b1f5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们基于模型<strong class="iw js">文章为所有内容实现React组件文章！</strong></p><pre class="kw kx ky kz fd lq lr ls lt aw lu bi"><span id="dc0e" class="jt ju hx lr b fi lv lw l lx ly">import React from 'react';<br/>import PropTypes from 'prop-types';<br/>import { BLOCKS, MARKS } from '@contentful/rich-text-types';<br/>import { documentToReactComponents } from '@contentful/rich-text-react-renderer';<br/>import './article.css';</span><span id="9fe4" class="jt ju hx lr b fi lz lw l lx ly">const Article = ({<br/>    document: {<br/>      fields: {<br/>        body,<br/>        background,<br/>        title<br/>      }<br/>    }<br/>  }) =&gt; {<br/>  const options = {<br/>    renderNode: {<br/>      [BLOCKS.PARAGRAPH]: (node, children) =&gt; children,        <br/>      [BLOCKS.QUOTE]: (node, children) =&gt; (<br/>        &lt;div className="quotation"&gt;{children}&lt;/div&gt;<br/>     ),<br/>      [MARKS.BOLD]: (node, children) =&gt; (<br/>        &lt;span className="bold-title"&gt;{children}&lt;/span&gt;<br/>     ),<br/>   },<br/>  };</span><span id="ff85" class="jt ju hx lr b fi lz lw l lx ly">  const article = documentToReactComponents(<br/>    body,<br/>    options,<br/>  );</span><span id="6396" class="jt ju hx lr b fi lz lw l lx ly">  return (<br/>    &lt;div<br/>      className="article-wrapper"<br/>      style={{ backgroundImage: `url(${background &amp;&amp;                         <br/>        background.fields.file.url})` }}<br/>    &gt;<br/>      &lt;div className="rich-text-content"&gt;<br/>        &lt;h1&gt;{title}&lt;/h1&gt;<br/>        {article}<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="b60a" class="jt ju hx lr b fi lz lw l lx ly">export default Article;</span></pre><p id="c7e5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="ku">文档</em>对象是我们从Contentful API得到的内容。它存储了我们在内容模型中描述过所有字段。</p><p id="f492" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们已经有了一个用于<strong class="iw js">文章</strong>模型的通用解析器。但是，如果您向富文本字段添加任何其他类型的标记(例如下划线)，您将需要在<strong class="iw js">documentToReactComponents</strong>选项对象中描述这种标记的解析规则。</p><p id="899f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是一个关于如何使用Contentful和<strong class="iw js"> React的简短课程。</strong>项目代码在<a class="ae kt" href="https://github.com/ArteezyCode/ContentfulExample" rel="noopener ugc nofollow" target="_blank"> <em class="ku"> github </em> </a>上。我希望这些信息是有用的，并感谢您在Medium和github上的支持！</p><p id="15dd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我很乐意回答你所有的问题和评论。🤘</p><figure class="kw kx ky kz fd hk er es paragraph-image"><div class="er es mb"><img src="../Images/703c25f1f0d97ed261ec83d230422f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/1*DiACYQpuwM2egYb8nWoB2Q.gif"/></div></figure></div></div>    
</body>
</html>