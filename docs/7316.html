<html>
<head>
<title>Estimating Pi with Monte Carlo in Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Excel中用蒙特卡罗方法估算圆周率</h1>
<blockquote>原文：<a href="https://medium.com/swlh/estimating-pi-with-monte-carlo-in-excel-c47725feaaa7?source=collection_archive---------8-----------------------#2019-07-01">https://medium.com/swlh/estimating-pi-with-monte-carlo-in-excel-c47725feaaa7?source=collection_archive---------8-----------------------#2019-07-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7c38" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">大一几何课终于派上用场了</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/631996e897fa433f5d5291cd9773eaa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*es8Zj0emHUsp_DgTuOybpQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Art created with Pi by color coding each digit. Originally created by <a class="ae jn" href="https://fineartamerica.com/profiles/martin-krzywinski.html?tab=artworkgalleries" rel="noopener ugc nofollow" target="_blank">Martin Krzywinski</a>.</figcaption></figure><p id="e40e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi kk translated">当我在看《副总统》节目时，Kent Davison，Selina竞选团队的民意测验专家和数据处理专家提到他最喜欢的数字是欧拉数，这让我想知道数学家们是如何得出这些日常生活中使用的数字的。我开始阅读这些重要数字的历史，然后偶然发现了圆周率的历史。在阅读了长长的<a class="ae jn" href="https://en.wikipedia.org/wiki/Pi" rel="noopener ugc nofollow" target="_blank">维基百科页面</a>后，我相信圆周率是数学中最迷人的数字之一；在人们能记住圆周率的多少位数方面有比赛，在计算圆周率的多少位数方面有比赛，圆周率之后有一个假期，然而圆周率的准确性与其日常使用并不真正相关。当给圆周率加上额外的数字时，收益会强烈递减，<strong class="jq kt"> 3.14与圆周率的真实值</strong>只相差0.5%。<a class="ae jn" href="https://blogs.scientificamerican.com/observations/how-much-pi-do-you-need/" rel="noopener ugc nofollow" target="_blank">美国宇航局的科学家在开发空间集成全球定位系统/惯性导航系统(SIGI)时，使用圆周率为16位数的圆周率进行计算</a>。我读到的所有这些东西让我想到，如果不是数学家或者没有疯狂的计算机，怎么能估算圆周率。</p><h1 id="f265" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">蒙特卡洛简介</h1><p id="128c" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi kk translated">蒙特卡洛用于通过模拟随机性来解决问题。蒙特卡洛模拟通常用于赌博，以估计概率。海军将使用蒙特卡洛模拟来确定在搜索和救援任务中某人最有可能位于的区域。我用蒙特卡洛模拟法来模拟标准普尔指数的表现，并对投资组合进行随机游走。<strong class="jq kt">简单来说蒙特卡洛基本上只是利用随机性进行模拟猜测和检验。</strong></p><h1 id="c30e" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">如何用蒙特卡罗方法估计圆周率</h1><p id="fd70" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi kk translated"><span class="l kl km kn bm ko kp kq kr ks di"> E </span>估算圆周率是蒙特卡洛模拟中一个常见的例子。最好的部分是，你只需要知道一些基本的几何来估算圆周率。这个想法是圆的面积是:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lr"><img src="../Images/f6f136667d254918460b6397133be360.png" data-original-src="https://miro.medium.com/v2/resize:fit:310/format:webp/1*zQWrIwv5wu0ejGtQuOO99w.png"/></div></figure><blockquote class="ls lt lu"><p id="ce6c" class="jo jp lv jq b jr js ij jt ju jv im jw lw jy jz ka lx kc kd ke ly kg kh ki kj hb bi translated">所以，如果半径是1英寸，那么圆的面积就是π。</p></blockquote><p id="beca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果半径是1英寸，那么圆的直径必须是2英寸。很好，除了<strong class="jq kt">之外，如果你只知道圆的面积是π</strong>，你如何推导π？嗯，因为圆的直径是2英寸，我们也可以把圆放在一个2英寸的正方形里面。圆将接触正方形的边，但是正方形的一部分将不会与圆重叠。</p><blockquote class="lz"><p id="516b" class="ma mb hi hj mc md me mf mg mh mi kj dx translated">下面是推导圆周率的基本逻辑。</p></blockquote><p id="5b8a" class="pw-post-body-paragraph jo jp hi jq b jr mj ij jt ju mk im jw jx ml jz ka kb mm kd ke kf mn kh ki kj hb bi translated">由于正方形的面积是4英寸，圆的面积是π，所以面积比将是<strong class="jq kt">π/4。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mo"><img src="../Images/43caa814386b084646f1e5b5723cfb9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*RM188mJXe71OC6fW3VDtVQ.png"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mp"><img src="../Images/67ba26c9c19baa95c4f5a5d14ba7ecab.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*a971bZ4ZUc4WFb0FdcuuQQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">For the visual learners</figcaption></figure><p id="727f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">假设我们在图上放置一个2英寸的正方形和一个半径为1英寸的圆，其中形状的中心位于x = 0和y = 0处，因此坐标为(0，0)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mq"><img src="../Images/4401cb0fbf566e8e14b1aa69cd31ad6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*B5--TWxrmQ6R9EPrM8z3FA.png"/></div></figure><h2 id="582e" class="mr kv hi bd kw ms mt mu la mv mw mx le jx my mz lg kb na nb li kf nc nd lk ne bi translated">如果我们在正方形内部画出随机的点，数一数圆里有多少个点，正方形里有多少个点，那么比值应该是π/4。所以，如果我们把这个比率乘以4，我们就会得到圆周率。</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nf"><img src="../Images/a31187da8f3277dee005c0ff3028b3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*-3ic9JDG7Ml0cn6oYtfdfg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">All we need to do is find the ratio</figcaption></figure><blockquote class="lz"><p id="3aab" class="ma mb hi hj mc md ng nh ni nj nk kj dx translated">但是，我们怎么知道哪些点在圆里，哪些点在正方形里呢？</p></blockquote><p id="8e51" class="pw-post-body-paragraph jo jp hi jq b jr mj ij jt ju mk im jw jx ml jz ka kb mm kd ke kf mn kh ki kj hb bi translated">容易，<strong class="jq kt">每个点离原点的距离小于或等于1。</strong>利用勾股定理可以求出圆内的点。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nl"><img src="../Images/6ca103a98dd92d4080c7c9ba472a0b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*45EZLV-u-fxMuKw3kvguig.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx">hello old friend</figcaption></figure><p id="f12c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">c的平方是三角形的最长边<strong class="jq kt">，也是圆<em class="lv"/></strong><em class="lv">(1英寸)</em>的半径。</p><blockquote class="lz"><p id="d286" class="ma mb hi hj mc md me mf mg mh mi kj dx translated">所以只要x和y的平方之和小于等于1，<strong class="ak">就一定在圆里面。</strong></p></blockquote><figure class="nn no np nq nr jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/be94552775511ef837aa555cfbb2989a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kabAeLgGMOU31V-fRKBqsQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">The hypotenuse is 1 inch long. Note how the sum of x and y squared is less than or equal to 1 inside the circle.</figcaption></figure><h1 id="5d69" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">Excel中的蒙特卡罗模拟</h1><p id="3210" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi kk translated">你不需要复杂的软件来运行蒙特卡洛模拟。虽然现在我用了很多R，但是我仍然相信Excel是最好的<em class="lv"/>统计软件，因为它的普及和易用。你真的可以推动Excel做更多的事情，不仅仅是数据透视表。</p><h1 id="bfcc" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">创建随机变量和底层逻辑</h1><blockquote class="ls lt lu"><p id="0dd7" class="jo jp lv jq b jr js ij jt ju jv im jw lw jy jz ka lx kc kd ke ly kg kh ki kj hb bi translated">首先创建两列，分别标记为x和y</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ns"><img src="../Images/2698ef10f46d7de77576f47a3b9ae2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*4iRrp0T3_D1Mb8tVILgInQ.png"/></div></figure><p id="6745" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，为了模拟随机性，使用rand函数，在两列中都键入<strong class="jq kt"> =RANDBETWEEN(-1000000，1000000)/1000000 </strong>。这是为了模拟-1和1之间的随机数。我之所以用一百万而不是一，是为了给数字增加额外的小数位数。突出显示这两个函数，单击位于单元格右下角的正方形，并向下拖动到1001行。这将复制公式999次以上。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nt"><img src="../Images/480230671af6fe80c9f40c699b06c52b.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*j7paRhxcuaweAnCZrzYUvw.png"/></div></figure><p id="aa7a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">转到工作表顶部的C列，单击单元格<strong class="jq kt"> C2 </strong>。键入<strong class="jq kt"> =IF( (POWER(A2，2) + POWER(B2，2)) &lt; =1，1，0) </strong>。<strong class="jq kt"> </strong>双击右下角填写剩余行。这是寻找点是否在圆内的基本逻辑。该公式计算x和y的平方，并检查它是否小于或等于1。如果点在圆内，则输出1，如果点在圆外，则输出0。</p><h1 id="aaec" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">进行蒙特卡罗模拟</h1><p id="2f3e" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">分别在单元格<strong class="jq kt"> D2 </strong>和<strong class="jq kt"> D3 </strong>中输入1和2，并高亮显示单元格。双击突出显示的单元格的右下角，以填充其余的单元格。<strong class="jq kt">这产生了蒙特卡洛模拟将进行的迭代次数</strong>。之后，点击单元格<strong class="jq kt"> C1 </strong>，输入<strong class="jq kt">= 4 *总和(C2:C1001) / 1000 </strong>。眼熟吗？这是估算圆周率的公式！总和是计算落在圆内的点数，分母是正方形内的总点数。这是计算圆周率所需的比率，我们需要做的就是把它乘以4，得到圆周率。</p><blockquote class="lz"><p id="5e1c" class="ma mb hi hj mc md me mf mg mh mi kj dx translated">但很可能不像圆周率。</p></blockquote><p id="3adb" class="pw-post-body-paragraph jo jp hi jq b jr mj ij jt ju mk im jw jx ml jz ka kb mm kd ke kf mn kh ki kj hb bi translated">这就是数据表有助于提高精确度的地方。我们只绘制了1000个点，这是一个相对较小的样本。我们需要绘制更多，但我们没有足够的行数来绘制100万个点或运行100万次模拟。创建数据表将对此有所帮助。点击单元格<strong class="jq kt"> E2 </strong>并输入<strong class="jq kt"> =C1。</strong>这是为了引用单元格，将在后续迭代中添加到记录中。高亮显示<strong class="jq kt"> D2 </strong>和<strong class="jq kt"> E2 </strong>并按<strong class="jq kt">shift+control+向下箭头</strong>选择整个表格。转到<strong class="jq kt">数据选项卡</strong>，点击<strong class="jq kt">假设分析</strong>，然后点击<strong class="jq kt">数据表</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nu"><img src="../Images/ed26b6a60220ad371542c003a91e357f.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*JJiC63iofFMux9o3WUp2eg.png"/></div></figure><p id="f68e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在列输入单元中输入<strong class="jq kt"> F2 </strong>。这是一个你其实不需要知道为什么的把戏。(因为我不知道你为什么这么做，你就是这么做)</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nv"><img src="../Images/be0f64e6816921eb4790762df6291162.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*qvGT9SdI1_0yfWr3a7vb_Q.png"/></div></figure><p id="63da" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">单击OK，您将看到表中填充了Pi的估计值。点击<strong class="jq kt"> E2 </strong>并输入<strong class="jq kt">=平均值(E2:E1001)。</strong>这将对圆周率的所有估计值进行平均，以创建一个与圆周率的实际数值非常相似的平均估计值！您已经成功地创建了1，000，000个数据点的比率，并导出和估计了Pi。玩玩它，看看你离圆周率有多近。更改样本大小(A列和B列中的行数)或向数据表中添加更多行以增加迭代次数。</p><p id="4cd0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">添加的迭代次数或样本越多，蒙特卡洛就越精确。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nw"><img src="../Images/dafa7415c89eaaf745cd0099d9c17179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*yCQUl8SXlq-NipPRbbfM2g.png"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nw"><img src="../Images/c90ce039e50a2f4d47d9f9b347358398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*R1xBjBdkGuhK7oXWWsPJWA.png"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nw"><img src="../Images/b39fa51089b4dc21f8b8215fba009d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*8908ViI8WWkxIxK-uapCgQ.png"/></div></figure><p id="face" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果你想用R语言来做这件事，并重新创建上面的图形，我附上了R代码。</p><pre class="iy iz ja jb fd nx ny nz oa aw ob bi"><span id="a332" class="mr kv hi ny b fi oc od l oe of">library(tidyverse)<br/>library(ggthemes)</span><span id="e713" class="mr kv hi ny b fi og od l oe of">#Create an empty data frame<br/>piSimulation &lt;- data.frame("")</span><span id="3148" class="mr kv hi ny b fi og od l oe of">#Adds 1,000,000 random points between -1 and 1<br/>piSimulation &lt;- cbind(piSimulation, x =runif(1000000,-1,1))<br/>piSimulation &lt;- cbind(piSimulation, y =runif(1000000,-1,1))</span><span id="3dd3" class="mr kv hi ny b fi og od l oe of">#Removes the extra column<br/>piSimulation &lt;-  piSimulation[,-1]</span><span id="21d2" class="mr kv hi ny b fi og od l oe of">#Logic for checking if points are inside the circle<br/>piSimulation &lt;-  piSimulation %&gt;% mutate(., inCircle = (piSimulation$x^2 + piSimulation$y^2) &lt;=1)</span><span id="dc94" class="mr kv hi ny b fi og od l oe of">#Estimation of Pi<br/>4 *sum(piSimulation$inCircle, na.rm = TRUE) / 1000000</span><span id="960b" class="mr kv hi ny b fi og od l oe of">#Creates row reference to serve as a point count for graph<br/>piSimulation$ID &lt;- seq.int(nrow(piSimulation))</span><span id="216c" class="mr kv hi ny b fi og od l oe of">#Graphs the points and filters the data to the first 10,000 points<br/>ggplot(data = piSimulation %&gt;% filter(., ID &lt; 10000), mapping = aes( x, y, color = inCircle)) + geom_point() + theme_economist()</span></pre><p id="8c5e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如您所见，用R创建它只需要不到10行代码。</p><h1 id="3e1d" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">整理想法</h1><p id="36b4" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">蒙特卡洛是一个有趣的工具，无论你在哪个领域，它都有很有用的应用。你可能会问<strong class="jq kt">为什么我不只是运行第一象限</strong>的模拟，而是使用rand()函数，其中x和y总是正的。我认为从概念上理解更容易<strong class="jq kt">，然而，只在第一象限绘图更容易实现。蒙特卡罗方法有一些美妙之处。我认为这是由于利用随机性和混沌找到一个解决方案的能力，否则无法找到。或者也许我只是真的想住在<a class="ae jn" href="https://qtxasset.com/styles/breakpoint_sm_default_480px_w/s3/luxurytraveladvisor/1514485016/MonteCarloMonacoCreditXantanaiStockGettyImagesPlusGettyImages_0.jpg/MonteCarloMonacoCreditXantanaiStockGettyImagesPlusGettyImages_0.jpg?HaO_VuTJd_hkgyC2wr5PlKFFCIflUZN7&amp;itok=W9GnCXzh" rel="noopener ugc nofollow" target="_blank">摩纳哥</a>。</strong></p></div></div>    
</body>
</html>