<html>
<head>
<title>The Combination of React and D3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和D3的组合</h1>
<blockquote>原文：<a href="https://medium.com/swlh/combination-of-react-and-d3-1fb07b00fb55#2019-05-04">https://medium.com/swlh/combination-of-react-and-d3-1fb07b00fb55#2019-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f217" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">天作之合</h2></div><p id="bdf6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">目录:</p><ul class=""><li id="bb1e" class="jt ju hi iz b ja jb jd je jg jv jk jw jo jx js jy jz ka kb bi translated"><a class="ae kc" rel="noopener" href="/p/1fb07b00fb55#c156">为什么是</a></li><li id="c8d9" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated"><a class="ae kc" rel="noopener" href="/p/1fb07b00fb55#5e39">如何</a></li><li id="661d" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated"><a class="ae kc" rel="noopener" href="/p/1fb07b00fb55#ac32">什么</a></li></ul><h1 id="3eeb" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">介绍</h1><blockquote class="la lb lc"><p id="ce63" class="ix iy ld iz b ja jb ij jc jd je im jf le jh ji jj lf jl jm jn lg jp jq jr js hb bi translated">这是一系列关于结合<code class="du lh li lj lk b"><em class="hi">React and D3</em></code>的文章。在整个系列中，我们将利用这两种技术的优点构建一个应用程序。在某些时候，将它们结合起来可能会很困难，为了达到最佳效果，你需要对其进行平衡。所以我们要创造一些平衡魔法。<br/> <em class="hi">注意— </em>有些部分可能会觉得自以为是:是的就是！</p></blockquote><h1 id="c156" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">问题</h1><p id="838d" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">React非常适合渲染视图。D3是构建数据驱动应用程序的最丰富的框架。从历史上看，D3提供了一种直接访问DOM的强制性方法。你可能会在<a class="ae kc" href="https://bl.ocks.org/" rel="noopener ugc nofollow" target="_blank">https://bl.ocks.org/</a>上看到很多很棒的例子，但是并没有真正联系到操作视图的反应方式。<strong class="iz lq"> <em class="ld">怎样才能优雅地将它们结合起来？</em>T15】</strong></p><h1 id="5e39" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">React —视图，D3 —数学</h1><p id="1609" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">在<a class="ae kc" href="https://www.captify.co.uk/" rel="noopener ugc nofollow" target="_blank"> Captify </a>中，我们知道向用户展示数据有多重要。洞察力可以驱动你的选择，帮助你更好地理解你的业务。我们使用React和D3来实现这一点。</p><p id="7ee4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们定义了什么对我们真正重要。<br/>我们要实现的主要目标是:</p><ul class=""><li id="95e8" class="jt ju hi iz b ja jb jd je jg jv jk jw jo jx js jy jz ka kb bi translated">一致的视图管理方式</li><li id="2b1a" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">用D3提供的工具操作数据。</li><li id="a5d0" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">最佳开发人员体验</li><li id="d34b" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">元素的详细控制</li></ul><p id="6273" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在对概念进行多次证明后，我们概述了关于这个问题的三种流行观点:</p><ul class=""><li id="ad4e" class="jt ju hi iz b ja jb jd je jg jv jk jw jo jx js jy jz ka kb bi translated">React —视图，D3 —数学</li><li id="5576" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">react——SVG作为根，D3——在生命周期中使用真实DOM</li><li id="3304" class="jt ju hi iz b ja kd jd ke jg kf jk kg jo kh js jy jz ka kb bi translated">React —渲染假DOM，D3 —使用假DOM</li></ul><p id="8733" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<a class="ae kc" rel="noopener" href="/@tibotiber/react-d3-js-balancing-performance-developer-experience-4da35f912484">的文章</a>中，<a class="ae kc" href="http://twitter.com/tibotiber" rel="noopener ugc nofollow" target="_blank"> @tibotibe </a> r很好地描述了提到的方法。</p><p id="2477" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">受到<a class="ae kc" href="http://twitter.com/sxywu" rel="noopener ugc nofollow" target="_blank"> @sxywu </a>的一点启发，我们决定坚持使用<strong class="iz lq"> <em class="ld"> React — View，D3 — math。这种方法给了我们想要的一切。能够用React管理View all。用D3函数进行数据操作。SVG将作为常规组件呈现，这给了我们对每个元素的详细控制和充分的开发者体验。</em></strong></p><h1 id="0f35" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">为什么不react-d3 lib X？</h1><p id="bc60" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">对于使用react和d3以及现有组件构建图表，有很多可用的解决方案。伟大的名单提供<a class="ae kc" href="https://www.smashingmagazine.com/2018/02/react-d3-ecosystem/" rel="noopener ugc nofollow" target="_blank">这里</a>。它们肯定可以帮助你构建不需要很大的样式或渲染灵活性的演示或应用程序。<br/>但是如果你有一个独特的风格需求或者一组组件与默认解决方案不相似，你可能需要自己构建一些东西。</p><h1 id="96a6" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">代码从何而来？</h1><p id="c74e" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">给你。<br/>让我们构建一个简单的静态时间线图表。类似下面的例子，但是图表后面没有轴和网格。</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div class="er es lr"><img src="../Images/29dbcf887d45009b736d989de8de5988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*bRLl6xh9-w3HJhUe"/></div><figcaption class="lz ma et er es mb mc bd b be z dx">example</figcaption></figure><p id="ef37" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">向前跳，你可以在这里找到所有相关的代码。<br/>或者快速演示一下<a class="ae kc" href="https://react-d3.icrosil.now.sh" rel="noopener ugc nofollow" target="_blank">这里部署的</a>。</p><p id="36ed" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">自举之后，我们有了全新的CRA驱动的应用程序<code class="du lh li lj lk b">d3</code>和<code class="du lh li lj lk b">dayjs</code>。出于开发目的，我们添加了完整的<code class="du lh li lj lk b">d3</code>库，但实际上，我们并不需要所有这些。如果你需要<code class="du lh li lj lk b">d3</code>的某些确切功能，像<code class="du lh li lj lk b">d3-scale</code>那样只安装它们会好得多。如果你不知道你的项目会增长多少，只要确保你启用了树摇动。</p><h1 id="ac32" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">时间表</h1><p id="748a" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">我们的图表将由两个基本部分<code class="du lh li lj lk b">D3 calculations</code>和<code class="du lh li lj lk b">Component</code>组成。</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div class="er es md"><img src="../Images/f24743518dd2e47989b59d5d65b08154.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*Tb3k0t6SptTRKnwXcAWfBw.png"/></div><figcaption class="lz ma et er es mb mc bd b be z dx">Structure</figcaption></figure><p id="f051" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们定义了一个带有少量<code class="du lh li lj lk b">util</code>组件的<code class="du lh li lj lk b">TimeLine</code>组件。</p><h2 id="4906" class="me kj hi bd kk mf mg mh ko mi mj mk ks jg ml mm ku jk mn mo kw jo mp mq ky mr bi translated">D3</h2><p id="a830" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">会给我们提供任何我们想要的计算。<br/>在我们的例子中，它们是5个函数:</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es ms"><img src="../Images/a480300836796c38018aadb1deca3824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8YCxl5ucSj2NMpJUq0zqg.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">scales</figcaption></figure><p id="2417" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld"> yScale + xScale </em> —定义数据集边界大小的函数，每次数据改变时都要重新计算。</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es mx"><img src="../Images/516787ee5b3b6c8f7c078fafb9bc478c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTbjXGDURrSgFnuxvaQD0w.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">path and area</figcaption></figure><p id="c345" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld">path+area inside</em>——用于将我们的数据塑造成可视化的形式。<code class="du lh li lj lk b">path</code>用于线条，而<code class="du lh li lj lk b">areaInside</code>用于同一线条，但带有内部部分，用于漂亮的填充样式。</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es my"><img src="../Images/b91102201212cd0648eaf3938ebf45ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wrga2msg_6sQYFEKIyVCyw.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">interface</figcaption></figure><p id="e95d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接口是一个在渲染前使用的函数。我们可以将它用作悬挂或挂钩。对于我们的图表，我们使用挂钩方法。这就是为什么我们在数组中返回计算的数据和函数。</p><p id="1366" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lh li lj lk b">Export default vs named</code>。命名导出让我们能够仔细地对精确的函数进行单元测试，默认导出让我们能够很好地使用组合——这正是我们在单个图表中所需要的。</p><p id="fbc9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lh li lj lk b">Parameter passing</code>。您可能会注意到传递参数的不同风格，对于这一点，我只有一个建议，将scales作为单独的参数，其他的都可以作为聚集的options对象中的最后一个参数。</p><p id="5d8c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lh li lj lk b">defaultMapper</code>是一件有益的事情。有时你想使用相同的比例，但不同形状的数据，在这种情况下，你可以通过不同的映射和重用旧的比例函数。</p><h2 id="fba1" class="me kj hi bd kk mf mg mh ko mi mj mk ks jg ml mm ku jk mn mo kw jo mp mq ky mr bi translated">成分</h2><figure class="ls lt lu lv fd lw er es paragraph-image"><div class="er es mz"><img src="../Images/22c611b023fb672d8e2f0bb0e62a5414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*6WMFOLxGCU2ZuJx7ghq0jw.png"/></div><figcaption class="lz ma et er es mb mc bd b be z dx">View props</figcaption></figure><p id="d997" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld">道具。我们只有一个属性<code class="du lh li lj lk b">viewBox</code>，它描述了我们要寻找的比率和初始大小。</em></p><figure class="ls lt lu lv fd lw er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es na"><img src="../Images/8384f92d38b3bd518cbc2075cd200fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jr3vXWOomGWQJqEIZLWm0Q.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">hooks</figcaption></figure><p id="a180" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld">挂钩。</em>数据是我们想要表示的任何数据集。<em class="ld"> </em>维度不同于属性视图框。Dimension声明了渲染所在的SVG的实际大小。视图框将按尺寸缩放。</p><p id="e5ab" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出于渲染的目的，我们将d3计算封装到<code class="du lh li lj lk b">useMemo</code>中。当视图框和数据不变时，钩子将节省我们重新计算d3函数的时间。</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es nb"><img src="../Images/39c8d79f023b6da159e08a077e170681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AxsSud4SdoNzntr77wlfA.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">render</figcaption></figure><p id="aa95" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ld">逐个渲染</em> —带所有子节点的SVG。SVG中样式的定义。绘制线条和区域的路径。画实际点的圆。</p><p id="8b2d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样。我们刚刚用React元素和D3计算构建了一个自定义图表。让我们看看最后是什么样子。</p><figure class="ls lt lu lv fd lw er es paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="er es nc"><img src="../Images/49db21f80684831e9c182ab177559ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CNRIT1kGtZG3_o9kJ9-MFA.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">chart</figcaption></figure><h1 id="b3be" class="ki kj hi bd kk kl km kn ko kp kq kr ks io kt ip ku ir kv is kw iu kx iv ky kz bi translated">下一步是什么</h1><p id="8d8a" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">我们讨论了基本的集成，但没有提到现实世界中的问题，如<em class="ld">工具提示</em>、<em class="ld">轴</em>、<em class="ld">地图</em>或<em class="ld">动画</em>。这些问题实现起来非常有趣，值得为它们编写单独的故事。</p></div><div class="ab cl nd ne gp nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="hb hc hd he hf"><h1 id="c0bc" class="ki kj hi bd kk kl nk kn ko kp nl kr ks io nm ip ku ir nn is kw iu no iv ky kz bi translated">关于这个话题的更多信息</h1><p id="7599" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated"><strong class="iz lq">只是一个图表库</strong>:<br/>-<a class="ae kc" href="https://www.smashingmagazine.com/2018/02/react-d3-ecosystem/" rel="noopener ugc nofollow" target="_blank">https://www . smashingmagazine . com/2018/02/react-D3-ecosystem/</a></p><p id="7b2a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz lq"> D3第一</strong>:<br/>-<a class="ae kc" href="https://blog.logrocket.com/data-visualization-in-react-using-react-d3-c35835af16d0" rel="noopener ugc nofollow" target="_blank">https://blog . log rocket . com/data-visualization-in-react-using-react-D3-c 35835 af 16d 0</a>-<a class="ae kc" rel="noopener" href="/@Elijah_Meeks/interactive-applications-with-react-d3-f76f7b3ebc71">https://medium . com/@ Elijah _ Meeks/interactive-applications-with-react-D3-f 76 f 7 B3 ebc 71</a></p><p id="b35a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz lq">Faux first</strong>:<br/>-<a class="ae kc" href="https://blog.sicara.com/a-starting-point-on-using-d3-with-react-869fdf3dfaf" rel="noopener ugc nofollow" target="_blank">https://blog . si cara . com/a-starting-point-on-using-D3-with-react-869 fdf 3d faf</a>-<a class="ae kc" rel="noopener" href="/@tibotiber/react-d3-js-balancing-performance-developer-experience-4da35f912484">https://medium . com/@ tibo Tiber/react-D3-js-balancing-performance-developer-experience-4 da 35 f 912484</a></p></div></div>    
</body>
</html>