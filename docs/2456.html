<html>
<head>
<title>How to run TensorFlow Object Detection model on Jetson Nano</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Jetson Nano上运行TensorFlow对象检测模型</h1>
<blockquote>原文：<a href="https://medium.com/swlh/how-to-run-tensorflow-object-detection-model-on-jetson-nano-8f8c6d4352e8#2019-04-22">https://medium.com/swlh/how-to-run-tensorflow-object-detection-model-on-jetson-nano-8f8c6d4352e8#2019-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/25a3d536f2e33ddc30cf7e5d683017bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ouQXvIZ2sVBsLnDW.png"/></div></div></figure><p id="69a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之前，您已经学习了如何在Jetson Nano上运行Keras图像分类模型，这次您将了解如何在其上运行Tensorflow对象检测模型。它可以是<a class="ae jo" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="noopener ugc nofollow" target="_blank"> Tensorflow检测模型动物园</a>中的预训练模型，用于检测人/车/狗等日常对象，也可以是自定义训练的对象检测模型，用于检测您的自定义对象。</p><p id="2e28" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将转换在coco数据集上训练的SSD MobileNet V1模型，用于常见对象检测。</p><p id="832d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个分解如何让它发生，略有不同，从以前的图像分类教程。</p><ol class=""><li id="5bba" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">下载预先训练好的模型检查点，建立TensorFlow检测图，然后用TensorRT创建推理图。</li><li id="2630" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">在Jetson Nano上加载传感器推理图并进行预测。</li></ol><p id="ee27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这两个步骤将在两个独立的Jupyter笔记本上处理，第一个在开发机器上运行，第二个在Jetson Nano上运行。</p><p id="4344" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在继续之前，请确保您已经<a class="ae jo" href="https://www.dlology.com/blog/how-to-run-keras-model-on-jetson-nano/" rel="noopener ugc nofollow" target="_blank">设置了</a> Jetson Nano并安装了Tensorflow。</p><h1 id="ca4f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤1:创建TensorRT模型</h1><p id="09db" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在带有<a class="ae jo" href="https://github.com/tensorflow/tensorrt#installing-tf-trt" rel="noopener ugc nofollow" target="_blank"> Tensorflow nightly builds </a>的开发机器上运行这个步骤，默认情况下它包含TF-TRT，或者你可以在<a class="ae jo" href="https://colab.research.google.com/github/Tony607/tf_jetson_nano/blob/master/Step1_Object_detection_Colab_TensorRT.ipynb" rel="noopener ugc nofollow" target="_blank">这个Colab笔记本</a>的免费GPU上运行。</p><p id="670e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在笔记本中，您将从安装Tensorflow对象检测API和设置相关路径开始。它的<a class="ae jo" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/installation.md" rel="noopener ugc nofollow" target="_blank">官方安装文档</a>对于初学者来说可能看起来令人望而生畏，但是你也可以通过运行一个笔记本电池来完成。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="65f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，您将从预先训练的<strong class="is lm"> ssd_mobilenet_v1_coco </strong>检查点下载并构建检测图，或者从笔记本提供的列表中选择另一个检查点。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="d4ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初，默认Tensorflow对象检测模型采用可变批量大小，现在固定为1，因为Jetson Nano是资源受限的设备。在<code class="du ln lo lp lq b">build_detection_graph</code>调用中，其他几个变化也适用于Tensorflow图，</p><ul class=""><li id="0c71" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn lr jv jw jx bi translated">分数阈值设置为0.3，因此模型将删除置信度分数低于阈值的任何预测结果。</li><li id="a7ef" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lr jv jw jx bi translated">IoU(并集上的交集)阈值被设置为0.5，使得任何检测到的具有相同类别重叠的对象都将被移除。你可以阅读更多关于IoU(交集超过并集)和非最大抑制<a class="ae jo" href="https://www.dlology.com/blog/gentle-guide-on-how-yolo-object-localization-works-with-keras-part-2/" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="b09a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn lr jv jw jx bi translated">对冻结对象检测图形应用修改，以提高速度并减少内存消耗。</li></ul><p id="4c36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们创建一个TensorRT推理图，就像图像分类模型。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="3166" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你有了TensorRT推理图，你可以把它保存为<strong class="is lm"> pb </strong>文件，并根据需要从Colab或你的本地机器下载到你的Jetson Nano中。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><h1 id="f940" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤2:加载TensorRT图并进行预测</h1><p id="7e9d" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在您的Jetson Nano上，使用命令<code class="du ln lo lp lq b">jupyter notebook --ip=0.0.0.0</code>启动Jupyter笔记本，您已经将下载的图形文件保存到了<code class="du ln lo lp lq b">./model/trt_graph.pb</code>。下面的代码将加载TensorRT图，并为推理做好准备。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="a14b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以使用图像进行预测，并查看模型是否正确。请注意，我们将图像的大小调整为300 x 300，但是，您可以尝试其他大小或保持大小不变，因为图形可以处理可变大小的输入。但是请记住，因为与台式机相比，Jetson的内存非常小，所以它几乎不能拍摄大图像。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="2017" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您以前玩过Tensorflow对象检测API，这些输出应该看起来很熟悉。</p><p id="9cd8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，结果可能仍然包含具有不同类别标签的重叠预测。例如，同一对象可以在两个重叠的边界框中标记两个类。</p><p id="4380" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用自定义的非最大值抑制函数来移除具有较低预测分数的重叠边界框。</p><p id="3369" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过绘制边界框和标签叠加来可视化结果。</p><p id="bb45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是创建覆盖图并显示在Jetson Nano笔记本上的代码。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div></figure><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/80a5e45b06327900483a900d663e5af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*CJsXv2pQAEq4z7Gy.png"/></div></figure><p id="67d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在coco标签图中，18级代表一只狗，23级代表一只熊。坐在那里的两只狗被错误地归类为熊。也许在coco数据集中，坐着的熊比站着的狗多。</p><p id="d81f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">进行了类似的速度基准测试，Jetson Nano使用SSD MobileNet V1模型和300 x 300输入图像实现了<strong class="is lm"> 11.54 FPS </strong>。</p><h1 id="5b7d" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论和进一步阅读</h1><p id="afe8" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">在本教程中，您学习了如何转换Tensorflow对象检测模型并在Jetson Nano上运行推理。</p><h2 id="eff7" class="lt ke hi bd kf lu lv lw kj lx ly lz kn jb ma mb kr jf mc md kv jj me mf kz mg bi translated">查看更新的<a class="ae jo" href="https://github.com/Tony607/tf_jetson_nano" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>获取源代码。</h2><p id="2bfc" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">如果你对结果不满意，还有其他预训练的模型供你看看，我建议你从SSD MobileNet V2(SSD _ MobileNet _ v2 _ coco)开始，或者如果你喜欢冒险，尝试<strong class="is lm"> ssd_inception_v2_coco </strong>，这可能会推动Jetson Nano的内存极限。</p><p id="e3c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在<a class="ae jo" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="noopener ugc nofollow" target="_blank"> Tensorflow检测模型动物园</a>中找到这些模型，“速度(毫秒)”度量将为您提供关于模型复杂性的指南。</p><p id="6818" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">考虑使用免费的数据中心GPU训练您的自定义对象检测模型，请查看我以前的教程— <a class="ae jo" href="https://www.dlology.com/blog/how-to-train-an-object-detection-model-easy-for-free/" rel="noopener ugc nofollow" target="_blank">如何免费轻松训练对象检测模型</a>。</p></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><p id="af5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mo">原载于</em><a class="ae jo" href="https://www.dlology.com/blog/how-to-run-tensorflow-object-detection-model-on-jetson-nano/" rel="noopener ugc nofollow" target="_blank"><em class="mo">https://www.dlology.com</em></a><em class="mo">。</em></p><div class="mp mq ez fb mr ms"><a href="https://github.com/Tony607/tf_jetson_nano" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab dw"><div class="mu ab mv cl cj mw"><h2 class="hj b fi z dy mx ea eb my ed ef hh bi translated">Tony607/tf_jetson_nano</h2><div class="mz l"><h3 class="bd b fi z dy mx ea eb my ed ef dx translated">如何在Jetson Nano上运行Keras模型？通过在…上创建帐户，为Tony607/tf_jetson_nano开发做出贡献</h3></div><div class="na l"><p class="bd b fp z dy mx ea eb my ed ef dx translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng io ms"/></div></div></a></div><figure class="lg lh li lj fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es nh"><img src="../Images/308a8d84fb9b2fab43d66c117fcc4bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqDjlKFwScoQYQ62DWEdig.png"/></div></a></figure><h2 id="c148" class="lt ke hi bd kf lu lv lw kj lx ly lz kn jb ma mb kr jf mc md kv jj me mf kz mg bi translated">这篇文章发表在<a class="ae jo" href="https://medium.com/swlh" rel="noopener"> The Startup </a>上，这是Medium最大的创业刊物，拥有+445，678名读者。</h2><h2 id="869c" class="lt ke hi bd kf lu lv lw kj lx ly lz kn jb ma mb kr jf mc md kv jj me mf kz mg bi translated">在这里订阅接收<a class="ae jo" href="https://growthsupply.com/the-startup-newsletter/" rel="noopener ugc nofollow" target="_blank">我们的头条新闻</a>。</h2><figure class="lg lh li lj fd ij er es paragraph-image"><a href="https://medium.com/swlh"><div class="er es nh"><img src="../Images/b0164736ea17a63403e660de5dedf91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouK9XR4xuNWtCes-TIUNAw.png"/></div></a></figure></div></div>    
</body>
</html>