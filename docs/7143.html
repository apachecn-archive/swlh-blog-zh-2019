<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/swlh/axiomising-risc-v-processors-through-formal-verification-fc96d4fe0258?source=collection_archive---------28-----------------------#2019-06-28">https://medium.com/swlh/axiomising-risc-v-processors-through-formal-verification-fc96d4fe0258?source=collection_archive---------28-----------------------#2019-06-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><p id="6e11" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">RISC-V处理器的民主化形式验证</p><h1 id="1605" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">通过形式验证公理化RISC-V处理器</h1><p id="3fc3" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">使用您选择的正式工具证明RISC-V处理器没有错误</p></div><div class="ab cl ji jj gp jk" role="separator"><span class="jl bw bk jm jn jo"/><span class="jl bw bk jm jn jo"/><span class="jl bw bk jm jn"/></div><div class="hb hc hd he hf"><figure class="jq jr js jt fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jp"><img src="../Images/13702d4653a4e8d0c1ca747911e9b229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Skm_j6CPRmU0kPLSnwOR6w.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx">RISC-V formal verification flow using Axiomise ISA formal proof kit</figcaption></figure><blockquote class="kf kg kh"><p id="d891" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">随着开源处理器架构如RISC-V的出现，芯片设计变得越来越大众化；越来越多的组织敢于进入处理器设计领域——从嵌入式微控制器到高端台式机和服务器级CPU、人工智能和机器学习设计。而由于开源架构，设计新的微处理器在经济上已经变得可行；测试和验证仍然是主要的障碍，有人估计它占芯片开发总成本的70%左右。这一成本不包括芯片被发现有功能性缺陷(缺陷)时遗漏缺陷和重新旋转的成本，这些缺陷在制造前没有被发现。人们只需看看安全漏洞的后果，Spectre和Meltdown几乎影响了地球上的每一个处理器，无论供应商是谁，其中一些是Arm、Intel和AMD等知名公司。</p><p id="9876" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">那么，我们如何期望未来的芯片设计能够安全地抵御这些恶意的错误，使芯片容易受到黑客攻击呢？我们如何知道芯片将继续在航空航天和国防领域按预期工作，并且不会由于在测试和验证期间没有发现的有意和无意的错误而行为不当？</p></blockquote><p id="558c" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">主要的挑战是基于模拟的传统验证技术不足以保证构建安全可靠的系统。即使速度更快、成本高几个数量级的验证方法(如仿真)也无法发现所有的缺陷，而这些缺陷可以为安全性提供急需的保证。形式验证是唯一的验证技术，可以提供不存在缺陷的“证据”,也可以提供设计和规范中缺陷的可证明证据。</p><blockquote class="kf kg kh"><p id="bdb6" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">但是，在我们开始检查需求是否是设计的有效公理之前，我们如何着手形式化需求呢？</p></blockquote><h1 id="b13b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">公理化正确性</h1><p id="cd0b" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">我们开发了一个新的正式证明套件，它使用行业标准、非专有的SystemVerilog断言(SVA)来根据已发布的<a class="ae km" href="https://content.riscv.org/wp-content/uploads/2017/05/riscv-spec-v2.2.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="hj kn"> RISC-V ISA </strong> </a>建立ISA合规性，并使用它来确定给定的处理器实现是否符合ISA语义。我们的解决方案完全不受正式工具供应商的限制，不需要修改设计，只需要最终用户熟悉Verilog/VHDL。此外，我们的方法可重复用于其他RISC-V处理器。我们的<em class="ki">“公理化”</em>方法是使用SystemVerilog断言(SVA)的开放标准构建的，并通过我们的抽象和问题简化工具包增强了性能。我们已经在实践中部署了我们的方法，以确保我们可以确定处理器的所有功能/安全性/安全性/功耗要求都转化为设计实现的可证明有效的公理(属性)。</p><h1 id="b944" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">方法学</h1><p id="054e" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">检查的一般策略依赖于使用观察模型来观察所有指令从发布点到完成点的路径，其中非确定性允许其他指令残留散布在被检查的特定指令的发布和完成之间。这确保了我们可以捕捉到各种由控制和并发控制的错误，这些错误可能会导致错误的结果。</p><blockquote class="kf kg kh"><p id="6749" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">需要强调的是，必须对每条具有不确定性的指令进行端到端的检查，因为在实践中，由于测试的非常直接的性质，大多数bug都会被遗漏，在测试中，它们专门探索从发布到完成的直接路径，而不一定允许其他指令的干扰。</p></blockquote><p id="8f1e" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">对于大多数指令，我们通常围绕观察因果关系编写一个检查。对加载和存储的检查是通过一个完整的内存接口构建的，通过该接口，我们可以检查加载和存储的所有变体，包括字节、字、半字、对齐和未对齐。这允许我们检查不同类型的加载和存储之间所有可能的依赖关系，尤其是当你有一系列指向相同地址的加载和存储时。</p><p id="0ba0" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在某些情况下，在开发过程中，我们还会发现我们在测试开发阶段引入的bug。其中大部分是由于我们对RISC-V ISA理解上的错误。谢天谢地，有了设计者的反馈，我们能够将这与ISA的要求保持一致。</p><h1 id="22f2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">表演</h1><p id="93bc" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">我们所有的验证检查都是一致的——这意味着它们要么产生通过的结果，要么产生失败的结果。当结果是通过时，意味着给定的检查在输入和状态的所有可能组合下对于实现都是有效的。在失败的情况下，它表明在设计模型和我们的checker模型之间存在不匹配，然后对其进行调试以找出问题的根本原因。我们能够使用Cadence Design Systems、Synopsys Inc .、Mentor(西门子业务和OneSpin解决方案)提供的任何现成正式验证工具，针对来自纸浆平台集团<strong class="hj kn"/><a class="ae km" href="https://pulp-platform.org/" rel="noopener ugc nofollow" target="_blank"><strong class="hj kn"/></a>的RISC-V处理器家族的RISC-V ISA的RV32IC子集，详尽地证明设计实现的一致性。</p><blockquote class="kf kg kh"><p id="1a3d" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">一些工具能够在几个小时内产生结果，其他一些工具需要大约72个小时，但所有工具的结果都是一样的——在一个工具中证明的在另一个工具中证明，在一个工具中失败的在另一个工具中仍然失败。在一个小时内，我们可以得到证据来收敛除加载/存储之外的所有检查，超过75%的非加载/存储检查在7分钟的挂钟时间内完成。</p></blockquote><h1 id="28c0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">bug和证明</h1><blockquote class="kf kg kh"><p id="8592" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">当我们将我们的方法应用于众所周知的32位低功耗处理器zeroriscy和microriscy [13]时，我们发现了66个错误，并彻底证明了一系列端到端功能特性，这些特性证明了处理器的正确性。</p><p id="e8c8" class="hg hh ki hj b hk hl hm hn ho hp hq hr kj ht hu hv kk hx hy hz kl ib ic id ie hb bi translated">许多这些错误是由于一个错误的调试单元，根据我们的理解，这个单元是计划重新设计的。我们还发现了与故障接口相关的错误，发现了干扰加载指令正常运行的意外逻辑，以及与故障调试单元无关的冗余时钟相关的一些电源问题。在某些情况下，我们分析了活锁的设计，并能够确定它没有任何活锁。我们在设计中发现了一些错误，加载指令实现了非标准版本的加载，导致标准ISA指定的行为失败。我们观察到存储指令的标准解释在没有规范说明的情况下针对特定的微拱实现进行了更改。</p></blockquote><p id="fc1b" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">我们最近分析了lowRISC为符合ISA而开发的另一个核心ibex [14]。使用我们的证明工具包，到目前为止，我们已经发现了与六个分支指令相关的六个新错误。我们花了一个小时来设置它，找到丢失的设计文件，几个小时后，我们就有了所有的结果。仔细一看，它们似乎都与调试单元有关，该单元仍在开发中。通过在我们的测试环境中引入一个假设来屏蔽设计中的调试逻辑，我们可以证明这些错误消失了，并且以前失败的检查现在完全成立。在这种情况下，ISA的所有特性都得到了充分的证明。</p><h1 id="195f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">覆盖面和完整性</h1><p id="b717" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">我们使用了一系列覆盖技术，利用我们使用的工具中的机制，并用我们的技术对其进行补充，以确保我们构建了一个完整的解决方案。能够使用来自不同供应商的不同覆盖解决方案提供了发现任何差异的好处，如果您只使用一个特定的工具，您可能会错过这些差异。我们在设计中引入了手动突变(bug ),以检查我们的属性是否对它们敏感。通过这种方式，我们确定了我们的检查确实在做正确的事情。就运行时性能而言，使用testbench发现问题是一种非常有效、高效且经济的方法。我们大量利用了这项技术。然后，我们检查我们是否已经将所有的指令映射到测试环境中的检查，这样我们就可以确定我们是否完成了ISA。结构和功能覆盖度量表明我们的验证模型中是否存在任何带有过度约束的盲点。</p><h1 id="438c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">相关著作</h1><p id="3182" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">在处理器验证的背景下，形式验证的使用已经存在了至少三十年。最早的应用利用了定理证明器，重点主要是建立以底层证明工具的语言设计的处理器模型的功能正确性。Ken McMillan设计了先进的问题简化技术，并展示了当处理器设计在形式化工具SMV [4]中编码时，如何使用形式化验证无序处理器实现。然而，形式验证在商业层面的广泛应用在很大程度上受到了限制，值得注意的例外是Boyer Moore使用ACL2定理证明器[3]验证AMD处理器浮点单元的开创性工作，Intel使用其专有工具Forte [5]，IBM使用其专有工具Rulebase Sixth Sense [6]，以及最近Arm [7]报告开发了一种工具来验证其实施是否符合ISA。Alglave等人关于宽松记忆模型的工作[16]和我们关于使用Event-B对HSA记忆模型进行形式建模、测试和验证的工作[15]是形式方法和处理器验证环境中的其他重要工作。</p><p id="ca52" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在RISC处理器的背景下，S. Tahar在第一代RISC处理器的形式验证方面的工作[2]很重要。他设计了一个正确性框架，并在HOL 4定理证明中将其形式化。对于RISC-V，在应用形式验证方面已经开始了大量的工作。一方面，使用Coq和Bluespec等正式工具对RISC-V [8]的ISA进行建模，目的是发现一致性问题；另一方面，基于属性检查的解决方案已经被用于寻找微架构错误以及建立与ISA [9，10]的一致性。尽管Chilipala在[8]中所做的工作确实很有价值，但不清楚有多少不熟悉Coq和BlueSpec的用户可以使用它。许多硬件设计都是使用标准VHDL/Verilog完成的，如果不投入大量资金让人们能够用BlueSpec编写处理器设计，并且至少对Coq形式有一个基本的了解，目前还不清楚[8]中的工作如何能够直接用于验证此类设计。</p><p id="778f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">我们认为Hummenberger等人在[9]和OneSpin解决方案[10]中所做的工作似乎是直接有用的，但是这两种解决方案都要求最终用户被锁定在各自的专有工具中。虽然Hummenberger等人[9]在公共领域确实有其工具的开源版本，但这需要某种程度的侵入性设置，需要使用测试平台接口信号对RISC-V设计进行测试，并且在某些情况下还需要进行修改以适应工具的局限性，正如他们的一些用户所证明的那样[11]。</p><p id="55d0" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">至于OneSpin Solutions的解决方案，它是围绕OneSpin专有断言语言(称为操作断言)开发的，供应商声称，通过使用这种语言，他们可以保证无缺口的正式验证解决方案。然而，为了利用这种无间隙特性，用户必须使用OneSpin的正式工具(DV-Verify和DV-Certify)。任何其他正式工具都不支持操作性断言。OneSpin Solutions确实提到了SVA的用法，并且有一个将操作断言翻译成SVA的翻译器；然而，他们的出版物[12]清楚地表明，要获得无缺口的解决方案，必须使用操作断言，而不是标准的SVA来建模需求。</p><h1 id="cb68" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="c557" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">我们的目标是进行端到端的正式验证，但有以下限制:(a)我们的工作是在访问受限的设计人员之外进行的;( b)我们没有设计微体系结构的先验知识，也没有描述接口和内部状态机的全面、详细的规范。</p><p id="9d7c" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在许多方面，我们的工作代表了现代设计验证的现实，忙碌的设计师通常不会记录详细的微架构规范，第一批验证通常由设计师自己使用模拟在本地进行，或者关于规范的知识通过口碑传递给独立验证设计的验证工程师。</p><p id="62f9" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">据我们所知，这是第一个独立于特定正式验证工具供应商的正式验证解决方案，使用所有工具都支持的SVA开放标准，并且需要最少的设置来保证99%以上的证明收敛。</p><p id="c472" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">您现在就可以使用我们的验证套件，使用您选择的正式验证工具，开始在您的RISC-V设计中查找错误，并构建不存在错误的证明。联系我们请求演示。</p><h1 id="2304" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">参考</h1><p id="c8a3" class="pw-post-body-paragraph hg hh hi hj b hk jd hm hn ho je hq hr hs jf hu hv hw jg hy hz ia jh ic id ie hb bi translated">VIPER微处理器正确性的证明，<em class="ki"> VLSI规范、验证和综合</em>，A. Cohn，1988年。</p><p id="6e7f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[2]RISC处理器形式验证的实用方法学，S. Tahar等人，<em class="ki">系统设计中的形式方法</em>，1998。</p><p id="ed38" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[3]amd5k 86 TM浮点除法程序的机械检查证明，J. Moore等人，<em class="ki"> IEEE计算机汇刊</em>，1998年。</p><p id="5a9a" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[4]通过组合模型检查验证Tomasulo算法的实现，K. McMillan，<em class="ki">CAV会议录</em>，1998年。</p><p id="22fb" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[5]微处理器设计中的实用形式验证，R. Jones等，<em class="ki"> IEEE计算机设计与测试</em>，2001。</p><p id="885f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[6]将FV集成到主流验证中IBM的经验，j .鲍姆加特纳，2006。</p><p id="78e9" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[7]用ISA-Formal对ARM处理器进行端到端验证，A. Reid等，<em class="ki">CAV论文集</em>，2016。</p><p id="12e1" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[8]RISC-V的强形式验证，A Chilipala，RISC-V Workshop，2017。</p><p id="1c0f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[9]RISC-V处理器实现的形式化验证，Humenberger等人，RISC-V峰会，2018。</p><p id="59f8" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[10]完成无木马可信集成电路RISC-V处理器IP的形式化验证，<em class="ki"> GOMAC </em>，2019。</p><p id="7b3f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[11]用Yosys合成Ibex，Github注释。，<a class="ae km" href="https://github.com/lowRISC/ibex/issues/60" rel="noopener ugc nofollow" target="_blank">https://github.com/lowRISC/ibex/issues/60</a></p><p id="9de1" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[12]tricore 2和其他处理器的完整形式验证，Bormann等人，<em class="ki"> DVCon </em> 2007。</p><p id="2807" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[13]稳扎稳打赢得比赛？面向物联网应用的超低功耗RISC-V内核比较。P D. Schivaone等<em class="ki">功率与时序建模、优化与仿真国际研讨会(PATMOS)，2017。</em></p><p id="12bb" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[14] lowRISC/ibex。<a class="ae km" href="https://github.com/lowRISC/ibex" rel="noopener ugc nofollow" target="_blank">https://github.com/lowRISC/ibex</a></p><p id="2465" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[15]使用事件B对HSA记忆模型进行正式建模、测试和验证，A. Darbari等人，<em class="ki"> ArXiV </em>，2016。</p><p id="f18a" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">[16]Power和ARM多处理器机器代码的语义，Alglave等人，<em class="ki"> DAMP </em> 2009。</p><p id="7fb4" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">据我们所知，这是第一个独立于特定正式验证工具供应商的正式验证解决方案，使用所有工具都支持的SVA开放标准，并且需要最少的设置来保证99%以上的证明收敛。</p><p id="b1a8" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">您现在就可以使用我们的验证套件，使用您选择的正式验证工具，开始在您的RISC-V设计中查找错误，并构建不存在错误的证明。联系我们请求演示。</p></div></div>    
</body>
</html>