<html>
<head>
<title>A guide to using WebdriverIO with iOS 13</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 13上使用WebdriverIO的指南</h1>
<blockquote>原文：<a href="https://medium.com/swlh/a-guide-to-using-webdriverio-with-ios-13-ba0a24420ff8?source=collection_archive---------7-----------------------#2019-07-14">https://medium.com/swlh/a-guide-to-using-webdriverio-with-ios-13-ba0a24420ff8?source=collection_archive---------7-----------------------#2019-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f8a6" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">探索最新safaridriver中的新功能</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/c4b188bfb654e8e58b891f576a431ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3X6GkXVV-Lb7cHu8ab62TQ.png"/></div></div></figure></div><div class="ab cl jj jk gp jl" role="separator"><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo jp"/><span class="jm bw bk jn jo"/></div><div class="hb hc hd he hf"><p id="912a" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Safari 10早在2016年就引入了原生WebDriver支持，从iOS 13开始，他们将这种支持扩展到了苹果浏览器的移动版本。本指南将带你了解我使用WebdriverIO(实际上没那么多)所必须采取的所有步骤。我们将完成一些基本的设置，创建一个页面对象和一个示例测试，最后我们将进行连接到iOS Safari所需的更改。</p><h1 id="376b" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">重要的事情先来</h1><p id="917d" class="pw-post-body-paragraph jq jr hi js b jt le ij jv jw lf im jy jz lg kb kc kd lh kf kg kh li kj kk kl hb bi translated">目前这个功能只在macOS Catalina和iOS 13上可用，遗憾的是这两个版本都还在测试中。如果你觉得自己很勇敢，你可以通过https://beta.apple.com的<a class="ae lj" href="https://beta.apple.com/" rel="noopener ugc nofollow" target="_blank">安装公测版，如果不是，你仍然可以继续学习如何使用Safari自带的safaridriver在macOS版本的Safari上设置WebdriverIO。</a></p><p id="a52d" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">因为我们使用的是WebdriverIO，所以你需要同时拥有NodeJS和npm(节点包管理器)。您可以通过在您的终端中运行<code class="du lk ll lm ln b">node -v</code>和<code class="du lk ll lm ln b">npm -v</code>来检查您是否已经安装了这些。最新版本的WebdriverIO至少需要节点版本8。</p><p id="dd52" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">最后但同样重要的是，您至少需要安装Java 8 JDK。我更喜欢用<a class="ae lj" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>软件包管理器安装这些，但是你可以用你喜欢的任何方式。</p><h2 id="7eb3" class="lo kn hi bd ko lp lq lr ks ls lt lu kw jz lv lw ky kd lx ly la kh lz ma lc mb bi translated">安装软件包</h2><p id="4705" class="pw-post-body-paragraph jq jr hi js b jt le ij jv jw lf im jy jz lg kb kc kd lh kf kg kh li kj kk kl hb bi translated">为您的项目创建一个目录，并在终端中导航到该目录。运行<code class="du lk ll lm ln b">npm init -y</code>用默认值创建一个package.json文件。现在我们可以用下面的命令安装wdio命令行接口包。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="26e7" class="lo kn hi ln b fi mg mh l mi mj">npm i --save-dev @wdio/cli</span></pre><p id="aca0" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果要使用特定版本的WebdriverIO，可以单独安装。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="1231" class="lo kn hi ln b fi mg mh l mi mj">npm i --save-dev webdriverio@&lt;version&gt;</span></pre><p id="9427" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">下一步是为wdio创建一个配置文件。这可以很容易地通过在你的终端中输入<code class="du lk ll lm ln b">./node_modules/.bin/wdio config</code>来完成。这将带你通过一个交互式助手，你可以选择你需要的所有设置和服务。你可以按<em class="mk"> &lt;键输入&gt; </em>直到关于服务的问题添加到你的测试设置中。取消选择<em class="mk"> chromedriver </em>与<em class="mk"> &lt;空格&gt; </em>并选择<em class="mk"> selenium-standalone </em>，然后再次按<em class="mk"> &lt;回车&gt; </em>直到交互助手结束。您现在应该会看到以下消息。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="c2b8" class="lo kn hi ln b fi mg mh l mi mj">Configuration file was created successfully!<br/>To run your tests, execute:<br/>$ wdio wdio.conf.js</span></pre><p id="0b13" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在设置过程中，我们选择了selenium-standalone和mocha服务，这将自动为我们安装@wdio/mocha-framework和@ wdio/selenium-standalone-service包。</p><p id="6a6a" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">最后，我们安装可选的Babel编译器，它允许我们使用新的JavaScript特性。</p><pre class="iy iz ja jb fd mc ln md me aw mf bi"><span id="aee4" class="lo kn hi ln b fi mg mh l mi mj">npm install --save-dev @babel/core @babel/cli @babel/preset-env @babel/register</span></pre><h1 id="2897" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">安装</h1><p id="549e" class="pw-post-body-paragraph jq jr hi js b jt le ij jv jw lf im jy jz lg kb kc kd lh kf kg kh li kj kk kl hb bi translated">如果你以前从未使用过safaridriver，你需要在终端中输入<code class="du lk ll lm ln b">safaridriver --enable</code>来启用它。</p><p id="7ce7" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">打开您最喜欢的代码编辑器，替换<code class="du lk ll lm ln b">package.json</code>文件中的测试命令。这将确保我们在运行测试时调用我们的wdio配置。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="3e66" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在您的项目根目录下，创建一个名为<code class="du lk ll lm ln b">babel.config.js</code>的文件，内容如下。这只是一个基本的巴别塔配置，以帮助我们开始。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="edd6" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">接下来，我们必须告诉我们的测试框架Mocha使用Babel编译器。打开<code class="du lk ll lm ln b">wdio.conf.js</code>并搜索mochaOpts属性，将其更改为。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="e327" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">配置文件中默认的浏览器功能设置为Firefox，因为这篇文章是关于Safari的，我们必须改变它。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="e2fe" class="lo kn hi bd ko lp lq lr ks ls lt lu kw jz lv lw ky kd lx ly la kh lz ma lc mb bi translated"><strong class="ak">创建页面对象</strong></h2><p id="7518" class="pw-post-body-paragraph jq jr hi js b jt le ij jv jw lf im jy jz lg kb kc kd lh kf kg kh li kj kk kl hb bi translated">我喜欢使用页面对象，所以我们将创建一个简单的页面对象。在项目根目录下创建一个名为<code class="du lk ll lm ln b">test</code>的目录。然后，在<code class="du lk ll lm ln b">test</code>中创建一个<code class="du lk ll lm ln b">pages</code>目录。用下面的代码创建一个名为<code class="du lk ll lm ln b">Page.js</code>的新文件。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="193f" class="lo kn hi bd ko lp lq lr ks ls lt lu kw jz lv lw ky kd lx ly la kh lz ma lc mb bi translated">编写测试</h2><p id="b669" class="pw-post-body-paragraph jq jr hi js b jt le ij jv jw lf im jy jz lg kb kc kd lh kf kg kh li kj kk kl hb bi translated">为了简单起见，我们将创建一个小样本测试。在<code class="du lk ll lm ln b">test</code>目录中创建一个<code class="du lk ll lm ln b">specs</code>目录，并用下面的代码将一个名为<code class="du lk ll lm ln b">sample.spec.js</code>的文件放入其中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="6e15" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在这个测试中，我们创建了Page对象的一个新实例，导航到页面，最后检查title属性是否包含文本“Google”。很直接，对吧？现在让我们通过在您的终端中键入<code class="du lk ll lm ln b">npm run test</code>来运行您的测试，如果一切顺利，您将在您的终端中看到一个成功的测试结果。</p><h1 id="3672" class="km kn hi bd ko kp kq kr ks kt ku kv kw io kx ip ky ir kz is la iu lb iv lc ld bi translated">但是iOS呢？</h1><p id="4afc" class="pw-post-body-paragraph jq jr hi js b jt le ij jv jw lf im jy jz lg kb kc kd lh kf kg kh li kj kk kl hb bi translated">你可能已经注意到，测试启动了桌面Safari，而不是iOS。这是因为我们仍然需要设置一些东西。打开您的<code class="du lk ll lm ln b">wdio.conf.js</code>，将平台名称iOS添加到您的浏览器功能中。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2599" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在拿起你运行iOS 13的iPhone或iPad，通过USB连接到你的电脑。进入<em class="mk">设置&gt; Safari &gt;高级&gt;远程自动化，启用远程自动化。</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/149ed697a97614629f52fcfad8fc7505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PNleZygMDcjJ8P1XYOFBjQ.jpeg"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx">iOS 13 Safari remote automation settings</figcaption></figure><p id="3919" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">下一步是“信任”你的电脑。当你第一次将iPhone或iPad连接到电脑上时，点击弹出菜单上的“信任”即可。如果您没有看到此弹出窗口，您可以打开一个Finder窗口，并在“位置”下的右侧栏中单击您的设备。您应该会看到一个配对按钮，点击它，然后在您的设备上点击“信任”。输入您的密码，您就可以开始了！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/6cb636cc92adfcc6751fd855aa1a8d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*glWaKogiGEKbtjOzYcX2rw.png"/></div></div></figure><p id="c9fc" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在保持你的iPhone或iPad解锁，在你的终端中输入<code class="du lk ll lm ln b">npm run test</code>。您应该会看到Safari在您的设备上弹出。等待几秒钟后，顶栏将变成橙色，这意味着浏览器正由远程自动化控制。</p><p id="089b" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">对我来说，如果我在Safari中没有打开任何额外的标签页，自动化会启动得更快。自动化完成后，浏览器将关闭，您将在终端中看到一个通过的测试。您刚刚在运行iOS 13的设备上运行了您的第一个测试！</p><p id="bcf0" class="pw-post-body-paragraph jq jr hi js b jt ju ij jv jw jx im jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">稍后，当iOS 13正式发布时，您也可以在iOS模拟器中运行您的测试，只需将<code class="du lk ll lm ln b">'safari:useSimulator': true</code>添加到您的浏览器功能中。一旦iOS模拟器对公众开放，我将创建一个关于使用它的单独的故事。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/b1002b9cff2e1fd12708e531fec642bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OdkQQNfaSEcGLn56RVVV0A.png"/></div></div></figure></div></div>    
</body>
</html>