<html>
<head>
<title>JSON Web Signature (JWS) and JWS Detached for a five-year-old.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JSON网页签名(JWS)和五岁的JWS分开了。</h1>
<blockquote>原文：<a href="https://medium.com/swlh/json-web-signature-jws-and-jws-detached-for-a-five-year-old-88729b7b1a68?source=collection_archive---------2-----------------------#2019-07-05">https://medium.com/swlh/json-web-signature-jws-and-jws-detached-for-a-five-year-old-88729b7b1a68?source=collection_archive---------2-----------------------#2019-07-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e4219e2a4e990501ccb41bcae3f0c39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IRhTxk3BZtQvnS9c9SiINQ.jpeg"/></div></div></figure><p id="21a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用JSON Web Signature (JWS)一段时间后，我得出结论，许多开发人员不理解它是什么以及它是如何工作的。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="33dc" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">JSON Web Signature (JWS)代表使用基于JSON的数据结构通过数字签名或消息认证码(MAC)保护的内容。</h2><p id="ea79" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">JWSs有两个已定义的序列化:一个compact(在本文中有描述)和一个JSON。</p><p id="bffb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">紧凑的序列化JWS是一个包含三个部分(按顺序)的字符串，用一个点("."):</p><ul class=""><li id="959b" class="kv kw hi is b it iu ix iy jb kx jf ky jj kz jn la lb lc ld bi translated">标题，</li><li id="06df" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">有效载荷，</li><li id="f13a" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">签名。</li></ul><p id="155e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lj">紧凑序列化JWS字符串的例子:</em> <code class="du lk ll lm ln b">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<strong class="is lo">.</strong>eyJleHAiOjIyMTgyMzkwMjIsIm5hbWUiOiJUb21hc3ogWndpZXJ6Y2hvxYQifQ.t3VhQ7QsILDuV_HNFSMI-Fb2FoT7fuzalpS5AH8A9c0<br/></code>每一部分都被<em class="lj"> BASE64URL </em> <strong class="is lo"> </strong>编码。</p><p id="56ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lo">报头</strong>描述了应用于有效载荷的数字签名或消息认证码(MAC)以及JWS的可选附加属性。</p><p id="e0ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编码前的头部分是一个JSON结构(如下例):</p><pre class="lp lq lr ls fd lt ln lu lv aw lw bi"><span id="3b00" class="jv jw hi ln b fi lx ly l lz ma">{<br/>  "alg": "HS256",<br/>  "typ": "JWT"<br/>}</span></pre><p id="d10b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">标题<strong class="is lo">中的标题参数名(对象键)必须</strong>唯一。有注册的头参数名:</p><ul class=""><li id="91c9" class="kv kw hi is b it iu ix iy jb kx jf ky jj kz jn la lb lc ld bi translated">“alg”(<strong class="is lo">必需的</strong> ) —算法，标识用于保护JWS的加密<br/>算法；<br/> <em class="lj">可以设置为‘none’，表示签名必须是空字符串！</em></li><li id="e134" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“jku”(可选)JWK Set URL是一个URI，它引用一组JSON编码的公钥的资源，其中一个对应于用于对JWS进行数字签名的密钥；</li><li id="c7bc" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“jwk”(可选)JSON Web Key是与用于对JWS进行数字签名的私钥相对应的公钥。这个公钥表示为一个JSON Web Key[JWK]；</li><li id="f334" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“kid”(可选)密钥id是指示哪个密钥用于保护JWS的提示。它可用于通知接收方密钥已更改；</li><li id="bfbf" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“x5u”(可选)X.509 URL是一个URI，它指向X.509公钥证书或证书链的资源，该证书链对应于用于对JWS进行数字签名的私钥；</li><li id="7f3d" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“x5c”—X.509证书链(可选)包含x . 509公钥证书或证书链，对应于用于对JWS进行数字签名的私钥；</li><li id="66c0" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“x5t”-X.509证书SHA-1指纹(指纹)(可选)是x . 509公共证书[RFC5280]的DER <br/>编码的<br/> base64url编码的SHA-1指纹(也称为摘要),对应于用于对JWS进行数字签名的私钥；</li><li id="c9d8" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“x5t # S256”——(可选)X.509证书SHA-256指纹(指纹)是对应于用于对JWS进行数字签名的私钥的X.509公共证书的DER编码的base64url编码的SHA-256指纹(也称为摘要)<br/>；</li><li id="33eb" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“typ”(可选)类型由JWS应用程序用来声明完整JWS的媒体类型；</li><li id="32a7" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“cty”(可选)内容类型由JWS应用程序<br/>用来声明有效负载的媒体类型。</li></ul><p id="c13d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的示例头中，我们可以看到JWS类型是JSON Web Token (JWT ),有效载荷由HS256 ( <a class="ae mb" href="https://en.wikipedia.org/wiki/HMAC" rel="noopener ugc nofollow" target="_blank"> HMAC </a>与SHA-256)加密算法保护。</p><p id="952e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lo">有效载荷</strong>可以是任何内容。<em class="lj">可以是JSON但不需要。</em></p><p id="3c2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lo">签名</strong>是根据ASCII(BASE64URL(UTF8(JWS保护标头))|| ' . '中为正在使用的特定算法定义的方式计算的||BASE64URL(JWS有效负载))。</p><p id="bd35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lo">重要提示:不要混淆<em class="lj"> BASE64URL </em>和<em class="lj"> BASE64 </em>！<em class="lj"> BASE64URL </em>中的</strong> <br/>:</p><ul class=""><li id="62aa" class="kv kw hi is b it iu ix iy jb kx jf ky jj kz jn la lb lc ld bi translated">所有尾随的“=”都被删除</li><li id="73aa" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“+”被替换为“-”</li><li id="bea4" class="kv kw hi is b it le ix lf jb lg jf lh jj li jn la lb lc ld bi translated">“/”被替换为“_”。</li></ul></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h2 id="7b5e" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jb kg kh ki jf kj kk kl jj km kn ko kp bi translated">JWS分离是JWS的一个变种，它允许你在不修改的情况下对HTTP请求或响应的内容(主体)进行签名。</h2><p id="e168" class="pw-post-body-paragraph iq ir hi is b it kq iv iw ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn hb bi translated">添加了HTTP头“x-jws签名”,它包含允许检查消息在从发送者到接收者的途中是否没有被改变的数据。</p><p id="bb37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">JWS分离生成算法非常简单:<br/> a)使用HTTP主体作为有效载荷，使用紧凑序列化生成标准JWS，<br/> b)将中间部分(有效载荷)变成空字符串，<br/> c)将最终字符串放入HTTP头“x-jws签名”</p><p id="8601" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lj">JWS脱弦的例子:</em> <code class="du lk ll lm ln b">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<strong class="is lo">.</strong>.t3VhQ7QsILDuV_HNFSMI-Fb2FoT7fuzalpS5AH8A9c0</code></p><p id="1a3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">验证jws分离的HTTP消息也很简单:<br/> a)获取HTTP头“x-jws签名”，<br/> b)获取BASE64URL HTTP主体<br/> c)将生成的字符串b)放入有效载荷部分<br/> d)验证JWS</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="c5a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is lo"> JWS </strong>经常与<strong class="is lo"> JSON Web Token (JWT) </strong>、<strong class="is lo"> JSON Web Encryption (JWE) </strong>或<strong class="is lo">JSON Object Signing and Encryption(荷西)</strong>。很多类似的捷径可能会导致混乱。</p></div></div>    
</body>
</html>