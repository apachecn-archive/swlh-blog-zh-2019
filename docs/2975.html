<html>
<head>
<title>How to create a custom keyboard with Xamarin Forms (Android)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Xamarin Forms创建自定义键盘(Android)</h1>
<blockquote>原文：<a href="https://medium.com/swlh/how-to-create-a-custom-keyboard-with-xamarin-forms-android-4fa3b83dad1d#2019-05-13">https://medium.com/swlh/how-to-create-a-custom-keyboard-with-xamarin-forms-android-4fa3b83dad1d#2019-05-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2271190dc0039b43d3b17c8424bed510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7iBZmrkKcpTn8sLoXGLY6g.jpeg"/></div></div></figure><p id="d83e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢用西班牙语阅读这篇文章，请点击这个<a class="ae jo" rel="noopener" href="/@fabricio.bertani/cómo-crear-un-teclado-custom-con-xamarin-forms-android-dc9fd8bdd2cd">链接</a></p><p id="e6d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">前一段时间，一个客户要求为他的应用程序提供一个特殊的键盘，这个键盘必须具备常规Android键盘所不具备的某些条件。</p><h1 id="50c6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">正在研究</strong></h1><p id="7307" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我想到的第一个选择是添加一个禁用的<code class="du ks kt ku kv b">Entry</code>和一个<code class="du ks kt ku kv b">GestureRecognizer</code>来显示一个带有动画的控件，以模拟键盘的外观，但很快就放弃了这个想法，因为它不可重用。最好的选择是走本地道路，所以我花了很多时间研究，但我只找到了创建键盘即服务的解决方案。我知道我们的客户不会喜欢必须下载一个单独的键盘以便只在应用程序中使用的想法，我需要一个能够处理Xamarin表单的解决方案！<br/>由于我不得不考虑它在Xamarin表单中的实现，我决定最好的选择是尝试使用入口控件的<a class="ae jo" href="https://docs.microsoft.com/en-us/xamarin/xamarin-forms/app-fundamentals/custom-renderer/" rel="noopener ugc nofollow" target="_blank">自定义渲染器</a>，因为它使用<em class="kw"> EditText </em>作为本机控件的基础，并尝试应用我之前在其中读到的所有解决方案。幸运的是，我不是一个人在完成这项任务，我得到了尼科·米尔科夫和费德里科·马卡罗尼的帮助，谢谢你们！</p><h1 id="d710" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">让我们开始工作吧！</h1><p id="80d4" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><strong class="is kz">注意:</strong>为了正确实现自定义键盘，我们需要Xamarin Forms版本为<code class="du ks kt ku kv b">3.6.0.135200-pre1</code>或更高版本，因为我们需要<a class="ae jo" href="https://github.com/xamarin/Xamarin.Forms/blob/release-3.6.0-rc1/Xamarin.Forms.Platform.Android/Renderers/EntryRenderer.cs#L113" rel="noopener ugc nofollow" target="_blank"> OnFocusChangeRequest </a>方法，该方法仅在该版本中可用。</p><p id="19a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将创建自定义控件，它将具有下一个可绑定属性:</p><ul class=""><li id="3490" class="la lb hi is b it iu ix iy jb lc jf ld jj le jn lf lg lh li bi translated"><code class="du ks kt ku kv b">EnterCommand</code>:键入<code class="du ks kt ku kv b">ICommand</code>，绑定<em class="kw">回车k </em> ey按键动作。</li></ul><p id="7d62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的自定义控件将是这样的:</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="d8f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们转移到我们的Android项目，并继续在那里工作(稍后我们将返回到我们的Xamarin Forms项目)。<br/>在我们继续之前，请确保准备好所有必需的Android软件包:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/091a7f4311b41535b8f668f6c1ca44ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*IxuJW3X6d347SfjvuDhtgQ.jpeg"/></div></figure><p id="9a4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来我们将编辑我们的Android <code class="du ks kt ku kv b">MainActivity</code>以避免显示本机键盘，为此我们将使用<code class="du ks kt ku kv b">SoftInputMode.StateAlwaysHidden</code>属性</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="29da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们接下来要做的是开始定义我们的自定义键盘。<br/>在<em class="kw">资源/布局</em>文件夹中，我们将创建一个名为<code class="du ks kt ku kv b">CustomKeyboard</code>类型的<code class="du ks kt ku kv b"><em class="kw">InputMethodService.Keyboard</em></code>的Android布局</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="9f22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将<code class="du ks kt ku kv b">alignParentBottom</code>属性设置为<em class="kw"> true </em>，因为我们希望我们的键盘从屏幕底部可见。<br/>其次，我们将<code class="du ks kt ku kv b">keyPreviewLayout</code> <em class="kw"> </em>属性设置为<em class="kw"> null </em>，因为在这个示例中，我们不希望在某个键被按下时出现响应布局。<br/>正如你在<code class="du ks kt ku kv b">keyBackground</code>中看到的，属性引用了一个名为<em class="kw"> keyboard_background </em>的drawable，它还不存在，所以我们将在Drawable文件夹中创建它作为一个xml文件，在那里我们将为我们的键可以具有的两种状态定义一个状态选择器:<em class="kw">正常</em>(未按下)和<em class="kw">按下</em>。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="8d4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如你所见，我们将不得不在Drawable文件夹中创建另外两个xml，在其中我们将定义键盘的<em class="kw">外观和感觉</em>以匹配(或不匹配)我们的应用程序主题。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="e897" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在<em class="kw"> values </em>文件夹中，我们将创建一个名为<strong class="is kz"> ids </strong>的xml，我们稍后会用到它。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="ec5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，在<em class="kw"> Resources </em>文件夹中，我们将创建一个名为<em class="kw"> xml </em>的新文件夹。在其中，我们将创建一个xml，我们将在其中定义特殊键盘的键。<br/>在我们的例子中，我们的键盘将被称为<em class="kw"> special_keyboard </em>，它将是<code class="du ks kt ku kv b">Keyboard</code>类型，我们将在其中定义我们的键的水平和垂直尺寸，<code class="du ks kt ku kv b">horizontalGap</code>和<code class="du ks kt ku kv b">verticalGap</code>属性指的是间距和尺寸类型<code class="du ks kt ku kv b">%p</code>(以防你从未见过它)是一种相对于父视图的百分比。<br/>每一行键都将包含在由<code class="du ks kt ku kv b">&lt;Row&gt;&lt;/Row&gt;</code>标签界定的部分中。<br/>我们的第一行将被一条分隔线占据，以标记我们键盘的限制。Row标签的高度为<code class="du ks kt ku kv b">4dp</code>，我们将通过<code class="du ks kt ku kv b">rowEdgeFlags</code>属性表明它位于键盘的顶部。然后我们将在<em class="kw">行</em>标签中添加一行作为<code class="du ks kt ku kv b">Key</code>，它将占据键盘的整个宽度。我们的分隔符只是我们将在Drawable文件夹中创建的另一个xml:</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="5bfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个<em class="kw">键</em>将有两个严格必要的属性:<code class="du ks kt ku kv b"><strong class="is kz">codes</strong></code>和<code class="du ks kt ku kv b"><strong class="is kz">keyLabel<em class="kw"><br/></em></strong></code> <strong class="is kz">代码</strong>将是一个数字，告诉操作系统该键对应什么字母或符号。<strong class="is kz">在这一点上，我想澄清一些事情:</strong>我发现了几十个关于为Android创建自定义键盘的示例，他们使用了许多不同的代码来指代某个符号或按键。在我尝试过的所有代码中，已经实现的最好的代码列表如下:<a class="ae jo" href="http://www.temblast.com/ref/akeyscode.htm" rel="noopener ugc nofollow" target="_blank"> Android键码</a>。你也可以看到官方的Android文档，甚至是Xamarin Android文档，但是没有一个是精确的。<br/> <strong class="is kz"> keyLabel </strong>是将要在我们的键中显示的字符串，即使我们不想在我们的键中显示任何文本，放置这个属性也是非常重要的(在那种情况下它将是<code class="du ks kt ku kv b">keyLabel=""</code>)。<br/>为了决定样式，在每一行的开头和结尾，我添加了一个键，其<em class="kw">代码</em>等于0(所以你没有任何动作)，宽度也为0，间距为<code class="du ks kt ku kv b">2%p</code>，这些键也将携带<code class="du ks kt ku kv b"><em class="kw">keyEdgeFlags</em></code>属性，其值为<code class="du ks kt ku kv b">left</code>或<code class="du ks kt ku kv b">right</code>。<br/>这里我们的全键盘:</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="2907" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，在开始使用我们的渲染器之前，我们将在资源中创建另一个文件夹，名为<em class="kw"> anim </em>并带有一个xml，我们称之为<code class="du ks kt ku kv b">slide_in_bottom</code>这将是我们的键盘出现在屏幕上的动画。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="3b8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将在我们的Android项目上创建一个新文件夹，名为<em class="kw"> Renderers </em>，在那里我们将创建我们的渲染器，我们称之为<code class="du ks kt ku kv b">EntryWithCustomKeyboardRenderer</code>，它将从<code class="du ks kt ku kv b">EntryRenderer</code>扩展并实现接口<code class="du ks kt ku kv b">IOnKeyboardActionListener</code>同样在我们的自定义渲染器中，我们将创建一个名为<code class="du ks kt ku kv b">NullListener</code>的私有类，它将从<code class="du ks kt ku kv b">Java.Lang.Object</code>扩展并实现接口<code class="du ks kt ku kv b">IOnKeyboardActionListener</code>，我们将在渲染器中使用它来避免空异常。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="61cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们回到Xamarin Forms项目，实现我们的特殊键盘。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="7d70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们后面的代码中，我们实现了之前创建的<code class="du ks kt ku kv b">EnterCommand</code>,用于我们在自定义键盘上按下<em class="kw"> Enter </em>键时想要发生的动作。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="7d50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是最终结果:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/69c9566d2aa02dc12ade5a525fb8f399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*uQOUSV87TkUnp1HLkunf9A.gif"/></div></figure><p id="067c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在GitHub上看到完整的样本库</p><div class="lr ls ez fb lt lu"><a href="https://github.com/FabriBertani/CustomKeyboardXamarinForms" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="hj b fi z dy lz ea eb ma ed ef hh bi translated">FabriBertani/CustomKeyboardXamarinForms</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">如何使用Xamrain Forms (Android)创建自定义键盘GitHub是超过5000万开发人员的家园…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">github.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi io lu"/></div></div></a></div><p id="fb1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下一篇文章中，我们将看到如何制作一个复杂的自定义键盘！</p><p id="59ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读😁</p></div></div>    
</body>
</html>